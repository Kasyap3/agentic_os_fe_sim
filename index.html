<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>oneOS - One Ecosystem</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* Boot Screen */
        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0f1419 100%);
            z-index: 20000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #a5b4fc;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        .boot-screen.hidden {
            display: none;
        }

        .boot-logo {
            font-size: 64px;
            font-weight: 700;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; transform: scale(1); }
            51%, 100% { opacity: 0.7; transform: scale(1.02); }
        }

        .boot-message {
            font-size: 18px;
            margin: 10px 0;
            opacity: 0;
            color: rgba(165, 180, 252, 0.8);
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .boot-progress {
            width: 300px;
            height: 6px;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 3px;
            margin-top: 30px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
        }

        .boot-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
            width: 0%;
            animation: progress 10s linear forwards;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.6);
        }

        @keyframes progress {
            to { width: 100%; }
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 15000;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-wallpaper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            z-index: 1;
        }
        
        .login-wallpaper::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(99, 102, 241, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.15) 0%, transparent 60%);
            animation: wallpaperShift 20s ease-in-out infinite;
        }

        .login-time-date {
            position: absolute;
            top: 40px;
            right: 40px;
            text-align: right;
            z-index: 20;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .login-time {
            font-size: 64px;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
        }

        .login-date {
            font-size: 24px;
            color: rgba(255, 255, 255, 0.7);
        }

        .login-container {
            position: relative;
            z-index: 20;
            background: transparent;
            padding: 50px 60px;
            min-width: 400px;
        }

        .login-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: center;
            color: #ffffff;
            text-shadow: 
                0 0 20px rgba(255, 255, 255, 0.8),
                0 0 40px rgba(255, 255, 255, 0.6),
                0 0 60px rgba(99, 102, 241, 0.8),
                0 2px 10px rgba(0, 0, 0, 0.8),
                0 4px 20px rgba(0, 0, 0, 0.6);
            letter-spacing: 2px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from {
                text-shadow: 
                    0 0 20px rgba(255, 255, 255, 0.8),
                    0 0 40px rgba(255, 255, 255, 0.6),
                    0 0 60px rgba(99, 102, 241, 0.8),
                    0 2px 10px rgba(0, 0, 0, 0.8),
                    0 4px 20px rgba(0, 0, 0, 0.6);
            }
            to {
                text-shadow: 
                    0 0 30px rgba(255, 255, 255, 1),
                    0 0 50px rgba(255, 255, 255, 0.8),
                    0 0 80px rgba(99, 102, 241, 1),
                    0 2px 10px rgba(0, 0, 0, 0.8),
                    0 4px 20px rgba(0, 0, 0, 0.6);
            }
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .login-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            margin-bottom: 8px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .login-input {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 16px 20px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), 0 0 0 0 rgba(99, 102, 241, 0.3);
        }

        .login-input:focus {
            outline: none;
            border-color: rgba(99, 102, 241, 0.6);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3), 0 0 0 4px rgba(99, 102, 241, 0.2), 0 0 20px rgba(99, 102, 241, 0.3);
            transform: translateY(-2px);
        }

        .login-input:hover {
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.12);
        }

        .login-input.error {
            border-color: #ef4444;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .login-button {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            border-radius: 12px;
            padding: 16px 28px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3), 0 0 0 0 rgba(99, 102, 241, 0.4);
        }

        .login-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5), 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .login-button:active {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .login-error {
            color: #ef4444;
            font-size: 14px;
            text-align: center;
            margin-top: 10px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s;
        }

        .login-error.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Welcome Animation */
        .welcome-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 30000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
        }

        .welcome-animation.show {
            opacity: 1;
            pointer-events: auto;
            animation: welcomeFadeIn 0.6s ease-out forwards;
        }

        .welcome-avatar {
            margin-bottom: 20px;
        }

        .avatar-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.5), 0 0 0 0 rgba(99, 102, 241, 0.7);
            animation: avatarPulse 1.5s ease-in-out infinite, avatarScaleIn 0.6s ease-out;
        }

        .avatar-initial {
            font-size: 36px;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .welcome-text {
            font-size: 28px;
            font-weight: 600;
            color: #fff;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.9) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: welcomeTextSlide 0.8s ease-out 0.3s both;
        }

        @keyframes welcomeFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes avatarScaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes avatarPulse {
            0%, 100% {
                box-shadow: 0 10px 40px rgba(99, 102, 241, 0.5), 0 0 0 0 rgba(99, 102, 241, 0.7);
            }
            50% {
                box-shadow: 0 10px 40px rgba(99, 102, 241, 0.6), 0 0 0 10px rgba(99, 102, 241, 0);
            }
        }

        @keyframes welcomeTextSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-error.show {
            opacity: 1;
        }

        /* Desktop Container */
        .desktop {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0f1419 100%);
            position: relative;
            overflow: hidden;
            display: none;
        }

        .desktop.active {
            display: block;
        }

        /* Desktop Wallpaper with cool animated gradient */
        .wallpaper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            position: relative;
            overflow: hidden;
        }
        
        .wallpaper::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.1) 0%, transparent 60%);
            animation: wallpaperShift 25s ease-in-out infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes wallpaperShift {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        /* Taskbar */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 48px;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 10000;
        }

        .start-button {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 15px;
            font-size: 20px;
            position: relative;
        }

        .start-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        }

        .start-menu {
            position: absolute;
            bottom: 55px;
            left: 0;
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 8px;
            min-width: 200px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            display: none;
            animation: slideUp 0.2s ease-out;
        }

        .start-menu.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .start-menu-item {
            padding: 12px 16px;
            color: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .start-menu-item:hover {
            background: rgba(99, 102, 241, 0.2);
            color: #fff;
        }

        .start-menu-item.logout {
            color: rgba(239, 68, 68, 0.9);
        }

        .start-menu-item.logout:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .start-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 4px 0;
        }

        .shutdown-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            z-index: 99999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        .shutdown-screen.active {
            display: flex;
        }

        .shutdown-logo {
            font-size: 64px;
            font-weight: 700;
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        .shutdown-message {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeIn 0.5s ease-out 0.3s forwards;
        }

        .shutdown-progress {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            opacity: 0;
            animation: fadeIn 0.5s ease-out 0.6s forwards;
        }

        .shutdown-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
            width: 0%;
            animation: shutdownProgress 3s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes shutdownProgress {
            0% {
                width: 0%;
            }
            100% {
                width: 100%;
            }
        }

        .blank-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 999999;
            display: none;
        }

        .blank-screen.active {
            display: block;
        }

        .taskbar-menu-button {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 20px;
            margin: 0 10px;
        }

        .taskbar-menu-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        .app-menu {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            max-height: 500px;
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            padding: 20px;
            display: none;
            flex-direction: column;
            z-index: 10000;
            overflow: hidden;
        }

        .app-menu.active {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }

        .app-menu-header {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .app-menu-search {
            width: 100%;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .app-menu-search::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .app-menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 15px;
            overflow-y: auto;
            flex: 1;
            padding-right: 5px;
        }

        .app-menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .app-menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .app-menu-item-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .app-menu-item-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .taskbar-apps {
            display: flex;
            gap: 8px;
            flex: 1;
            justify-content: center;
        }

        .taskbar-app {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 24px;
            line-height: 1;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .taskbar-app:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.6));
            font-size: 26px;
        }

        .taskbar-app.active {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.6);
            filter: drop-shadow(0 2px 4px rgba(99, 102, 241, 0.4));
        }

        .taskbar-app.minimized {
            opacity: 0.6;
            position: relative;
        }

        .taskbar-app.minimized::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 2px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 1px;
        }

        .system-tray {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 10px;
            font-size: 11px;
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            background: rgba(99, 102, 241, 0.15);
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
        }

        .ai-dot {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            line-height: 1.2;
        }

        .time-date {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.7);
        }

        .system-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            position: relative;
        }

        .system-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .system-icon.active {
            background: rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
        }

        .system-icon.inactive {
            opacity: 0.5;
            color: rgba(255, 255, 255, 0.5);
        }

        .weather-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            font-size: 10px;
        }

        .weather-temp {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
        }

        .agent-status-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            font-size: 9px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .agent-status-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .agent-status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .agent-status-dot.working {
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .agent-status-dot.idle {
            background: #f59e0b;
        }

        .agent-status-dot.disconnected {
            background: #ef4444;
        }

        /* Window System */
        .window {
            position: absolute;
            background: rgba(15, 15, 20, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .window.active {
            display: block;
            animation: windowOpen 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes windowOpen {
            from {
                transform: scale(0.8) translateY(20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .window-header {
            height: 36px;
            background: rgba(20, 20, 30, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            padding: 0 15px;
            cursor: move;
        }

        .window-controls {
            display: flex;
            gap: 8px;
            margin-right: 15px;
        }

        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .window-close {
            background: #ff5f56;
        }

        .window-close:hover {
            background: #ff3f36;
            transform: scale(1.1);
        }

        .window-close:active {
            transform: scale(0.95);
            background: #ff1f16;
        }

        .window-minimize {
            background: #ffbd2e;
        }

        .window-minimize:hover {
            background: #ffa500;
            transform: scale(1.1);
        }

        .window-minimize:active {
            transform: scale(0.95);
            background: #ff9500;
        }

        .window-maximize {
            background: #27c93f;
        }

        .window-maximize:hover {
            background: #1fb832;
            transform: scale(1.1);
        }

        .window-maximize:active {
            transform: scale(0.95);
            background: #17a028;
        }

        /* macOS-like button glow effect */
        .window-control::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .window-control:hover::before {
            width: 20px;
            height: 20px;
        }

        /* Window animations */
        .window {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        width 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        height 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        top 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .window.closing {
            opacity: 0;
            transform: scale(0.9);
            pointer-events: none;
        }

        .window.minimizing {
            transform: translateY(100vh) scale(0.8);
            opacity: 0;
            pointer-events: none;
        }

        .window.maximized {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
            z-index: 1000 !important;
        }

        .window.restoring {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .window-title {
            flex: 1;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
        }

        .window-content {
            height: calc(100% - 36px);
            overflow: auto;
        }

        /* Window Resize Handles */
        .window-resize-handle {
            position: absolute;
            background: transparent;
            z-index: 10;
        }

        .window-resize-handle.nw {
            top: 0;
            left: 0;
            width: 10px;
            height: 10px;
            cursor: nw-resize;
        }

        .window-resize-handle.ne {
            top: 0;
            right: 0;
            width: 10px;
            height: 10px;
            cursor: ne-resize;
        }

        .window-resize-handle.sw {
            bottom: 0;
            left: 0;
            width: 10px;
            height: 10px;
            cursor: sw-resize;
        }

        .window-resize-handle.se {
            bottom: 0;
            right: 0;
            width: 10px;
            height: 10px;
            cursor: se-resize;
        }

        .window-resize-handle.n {
            top: 0;
            left: 10px;
            right: 10px;
            height: 10px;
            cursor: n-resize;
        }

        .window-resize-handle.s {
            bottom: 0;
            left: 10px;
            right: 10px;
            height: 10px;
            cursor: s-resize;
        }

        .window-resize-handle.w {
            left: 0;
            top: 10px;
            bottom: 10px;
            width: 10px;
            cursor: w-resize;
        }

        .window-resize-handle.e {
            right: 0;
            top: 10px;
            bottom: 10px;
            width: 10px;
            cursor: e-resize;
        }

        /* Notepad App */
        #notepad {
            width: 600px;
            height: 400px;
            top: 100px;
            left: 100px;
        }

        .notepad-content {
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.6);
            color: #fff;
            border: none;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
        }

        /* Browser App */
        #browser {
            width: 900px;
            height: 600px;
            top: 150px;
            left: 300px;
        }

        .browser-toolbar {
            height: 40px;
            background: rgba(25, 25, 35, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
        }

        .browser-nav-btn {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .browser-nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .url-bar {
            flex: 1;
            height: 30px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 0 12px;
            color: #fff;
            font-size: 13px;
            outline: none;
        }

        .browser-viewport {
            height: calc(100% - 40px);
            background: #1a1a1a;
            position: relative;
        }

        .browser-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #fff;
        }

        .browser-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            height: 100%;
        }

        .quick-search {
            display: flex;
            gap: 10px;
            padding: 20px;
            flex-wrap: wrap;
        }

        .search-btn {
            padding: 8px 16px;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .search-btn:hover {
            background: rgba(99, 102, 241, 0.3);
            transform: translateY(-2px);
        }

        .ai-agent-btn {
            background: rgba(99, 102, 241, 0.2) !important;
            border-color: rgba(99, 102, 241, 0.4) !important;
        }

        .ai-agent-btn:hover {
            background: rgba(99, 102, 241, 0.3) !important;
            border-color: rgba(99, 102, 241, 0.6) !important;
        }

        /* AI Chatbot */
        .ai-chatbot {
            position: fixed;
            bottom: 60px;
            right: 20px;
            width: 400px;
            height: 500px;
            background: rgba(25, 25, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            display: none;
            flex-direction: column;
            z-index: 15000;
            overflow: hidden;
        }

        .ai-chatbot.active {
            display: flex;
        }

        .ai-chatbot-header {
            height: 50px;
            background: rgba(99, 102, 241, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
        }

        .ai-chatbot-title {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }

        .ai-chatbot-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-chatbot-speak-toggle {
            width: 35px;
            height: 35px;
            background: rgba(99, 102, 241, 0.3);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 8px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .ai-chatbot-speak-toggle:hover {
            background: rgba(99, 102, 241, 0.5);
            border-color: rgba(99, 102, 241, 0.6);
            transform: scale(1.05);
        }

        .ai-chatbot-speak-toggle.active {
            background: rgba(99, 102, 241, 0.6);
            border-color: rgba(99, 102, 241, 0.8);
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.4);
        }

        .ai-chatbot-close {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .ai-chatbot-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .ai-chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            display: flex;
            flex-direction: column;
            max-width: 80%;
        }

        .ai-message-user {
            align-self: flex-end;
        }

        .ai-message-assistant {
            align-self: flex-start;
        }

        .ai-message-content {
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .ai-message-user .ai-message-content {
            background: rgba(99, 102, 241, 0.3);
            color: #fff;
            border-bottom-right-radius: 4px;
        }

        .ai-message-assistant .ai-message-content {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border-bottom-left-radius: 4px;
        }

        .ai-message {
            position: relative;
        }

        .ai-message-speak {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 28px;
            height: 28px;
            background: rgba(99, 102, 241, 0.4);
            border: 1px solid rgba(99, 102, 241, 0.5);
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: all 0.2s;
            z-index: 10;
        }

        .ai-message-assistant:hover .ai-message-speak {
            opacity: 1;
            background: rgba(99, 102, 241, 0.6);
        }

        .ai-message-speak:hover {
            background: rgba(99, 102, 241, 0.5);
            transform: scale(1.1);
        }

        .ai-message-speak.playing {
            background: rgba(99, 102, 241, 0.6);
            animation: pulse 1.5s infinite;
        }

        .ai-chatbot-input-container {
            height: 60px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            padding: 10px 15px;
            gap: 10px;
        }

        .ai-chatbot-input {
            flex: 1;
            height: 35px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0 12px;
            color: #fff;
            font-size: 14px;
            outline: none;
        }

        .ai-chatbot-input:focus {
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(255, 255, 255, 0.08);
        }

        .ai-chatbot-send {
            height: 35px;
            padding: 0 20px;
            background: rgba(99, 102, 241, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.6);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-chatbot-send:hover {
            background: rgba(99, 102, 241, 0.7);
            transform: translateY(-1px);
        }

        .ai-chatbot-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Calendar App */
        #calendar {
            width: 800px;
            height: 500px;
            top: 100px;
            left: 250px;
        }

        .calendar-container {
            padding: 20px;
            height: 100%;
            overflow-y: auto;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .calendar-title {
            font-size: 20px;
            font-weight: 500;
        }

        .calendar-date {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }

        .event-card {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0;
            transform: translateX(-20px);
            animation: slideIn 0.4s ease forwards;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .event-card:hover {
            background: rgba(99, 102, 241, 0.15);
            transform: translateX(5px);
        }

        .event-time {
            font-size: 12px;
            color: rgba(99, 102, 241, 0.8);
            margin-bottom: 5px;
        }

        .event-title {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .event-details {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Boss Message Window */
        .message-window {
            position: fixed;
            top: 80px;
            right: 50px;
            width: 400px;
            max-height: 600px;
            background: rgba(15, 15, 25, 0.98);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            z-index: 20000;
            display: none;
            flex-direction: column;
            opacity: 0;
            transform: translateX(100px);
        }

        .message-window.active {
            display: flex;
            animation: messageWindowSlide 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes messageWindowSlide {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .message-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .message-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .message-sender-info {
            flex: 1;
        }

        .message-sender-name {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .message-sender-role {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
        }

        .message-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
        }

        .message-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .message-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            max-width: 85%;
            word-wrap: break-word;
            animation: messageSlideIn 0.3s ease;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-bubble.boss {
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3);
            align-self: flex-start;
        }

        .message-bubble.agent {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            align-self: flex-end;
        }

        .message-actions {
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
        }

        .ask-agent-btn, .reply-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .ask-agent-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }

        .reply-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .ask-agent-btn:hover, .reply-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .reply-btn:hover {
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }

        .ask-agent-btn:disabled, .reply-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .message-input-area {
            display: none;
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message-input-area.active {
            display: block;
        }

        .message-input-wrapper {
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            outline: none;
        }

        .message-input:focus {
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(255, 255, 255, 0.08);
        }

        .message-send-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .message-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            max-width: 85%;
            align-self: flex-start;
            animation: messageSlideIn 0.3s ease;
        }

        .typing-indicator span {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: rgba(99, 102, 241, 0.6);
            border-radius: 50%;
            animation: typingDot 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingDot {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-8px);
                opacity: 1;
            }
        }


        /* AI Chat Interface */
        .ai-chat {
            position: fixed;
            top: 48px;
            right: 0;
            width: 400px;
            height: calc(100vh - 48px - 48px);
            background: rgba(10, 10, 18, 0.98);
            backdrop-filter: blur(30px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9998;
            display: flex;
            flex-direction: column;
        }

        .ai-chat.active {
            transform: translateX(0);
        }

        .ai-chat.half-sidebar {
            width: 50vw;
            max-width: 400px;
        }

        .ai-chat-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(99, 102, 241, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-speak-toggle {
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            width: 40px;
            height: 40px;
        }

        .ai-speak-toggle:hover {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.6);
            transform: scale(1.05);
        }

        .ai-speak-toggle.active {
            background: rgba(99, 102, 241, 0.5);
            border-color: rgba(99, 102, 241, 0.8);
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.4);
        }

        .ai-speak-toggle.active .speak-icon {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }

        .ai-chat-title {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .ai-chat-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .ai-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ai-message {
            display: flex;
            gap: 12px;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from {
                transform: translateX(20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .ai-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .ai-bubble {
            flex: 1;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            padding: 12px;
            font-size: 13px;
            line-height: 1.6;
        }

        .user-message {
            flex-direction: row-reverse;
        }

        .user-message .ai-avatar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .user-message .ai-bubble {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .ai-thinking {
            padding: 8px 12px;
            background: rgba(99, 102, 241, 0.05);
            border-left: 2px solid rgba(99, 102, 241, 0.5);
            border-radius: 6px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin: 10px 0;
            font-style: italic;
        }

        .ai-input-area {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
        }

        .ai-action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .ai-action-btn {
            padding: 10px 16px;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 8px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 120px;
        }

        .ai-action-btn:hover {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.6);
            transform: translateY(-1px);
        }

        .ai-checklist {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 500px;
            overflow-y: auto;
        }

        .checklist-item-wrapper {
            margin-bottom: 12px;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .checklist-item-wrapper.show {
            opacity: 1;
            transform: translateY(0);
        }

        .checklist-reasoning {
            margin-bottom: 8px;
            padding: 8px 12px;
            background: rgba(99, 102, 241, 0.08);
            border-left: 3px solid rgba(99, 102, 241, 0.4);
            border-radius: 6px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            min-height: 20px;
            max-height: 100px;
            overflow-y: auto;
        }

        .reasoning-step {
            padding: 4px 0;
            opacity: 0;
            transform: translateX(-10px);
            animation: reasoningSlide 0.4s ease forwards;
            color: rgba(255, 255, 255, 0.5);
        }

        .reasoning-step::before {
            content: ' ';
            color: rgba(99, 102, 241, 0.6);
            margin-right: 6px;
        }

        @keyframes reasoningSlide {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .ai-checklist-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 10px 12px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            border-left: 2px solid transparent;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ai-checklist-item.show {
            opacity: 1;
            transform: translateX(0);
            border-left-color: rgba(99, 102, 241, 0.3);
        }

        .ai-checklist-item.completed {
            color: rgba(16, 185, 129, 0.9);
            background: rgba(16, 185, 129, 0.08);
            border-left-color: #10b981;
        }

        .ai-checklist-item.completed::before {
            content: '';
            color: #10b981;
            font-weight: bold;
            margin-right: 8px;
            font-size: 14px;
        }

        .checklist-task {
            flex: 1;
            font-weight: 500;
        }

        .checklist-source {
            font-size: 10px;
            color: rgba(99, 102, 241, 0.6);
            background: rgba(99, 102, 241, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-style: italic;
        }

        .ai-checklist-item.completed .checklist-source {
            color: rgba(16, 185, 129, 0.6);
            background: rgba(16, 185, 129, 0.1);
        }

        .ai-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            font-size: 13px;
            outline: none;
            transition: all 0.2s;
        }

        .ai-input:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .ai-send {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .ai-send:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
        }

        /* Desktop Icons */
        .desktop-icons {
            position: absolute;
            top: 60px;
            left: 20px;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            gap: 30px;
            max-height: calc(100vh - 120px);
            z-index: 1;
        }

        .desktop-icons-right {
            position: absolute;
            top: 60px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 30px;
            z-index: 1;
        }

        .one-ecosystem-section,
        .other-apps-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .ecosystem-label {
            font-size: 14px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(99, 102, 241, 0.2);
            border-left: 3px solid rgba(99, 102, 241, 0.8);
            border-radius: 6px;
            width: fit-content;
        }

        .one-ecosystem-section .ecosystem-label {
            background: rgba(99, 102, 241, 0.3);
            border-left-color: rgba(99, 102, 241, 1);
        }

        .other-apps-section .ecosystem-label {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: rgba(255, 255, 255, 0.4);
        }

        .desktop-icon {
            width: 80px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            padding: 10px 5px;
        }

        .desktop-icon:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .desktop-icon-img {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            flex-shrink: 0;
        }

        .desktop-icon-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 1);
            text-align: center;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8), 0 1px 2px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            margin-top: 4px;
            line-height: 1.2;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(99, 102, 241, 0.9);
            backdrop-filter: blur(20px);
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 30000;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Loading dots */
        .loading-dots {
            display: inline-flex;
            gap: 4px;
        }

        .dot {
            width: 4px;
            height: 4px;
            background: rgba(99, 102, 241, 0.6);
            border-radius: 50%;
            animation: dotPulse 1.4s ease-in-out infinite;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes dotPulse {
            0%, 80%, 100% { transform: scale(1); opacity: 0.5; }
            40% { transform: scale(1.5); opacity: 1; }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* File Explorer */
        #fileExplorer {
            width: 800px;
            height: 500px;
            top: 100px;
            left: 200px;
        }

        .explorer-toolbar {
            height: 40px;
            background: rgba(25, 25, 35, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
        }

        .explorer-btn {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .explorer-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .explorer-path {
            flex: 1;
            height: 30px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 0 12px;
            color: #fff;
            font-size: 13px;
            display: flex;
            align-items: center;
        }

        .explorer-content {
            height: calc(100% - 40px);
            padding: 15px;
            overflow-y: auto;
        }

        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
        }

        .file-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        .file-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .file-name {
            font-size: 11px;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            word-break: break-word;
        }

        /* Gallery App */
        #gallery {
            width: 900px;
            height: 600px;
            top: 100px;
            left: 250px;
        }

        .gallery-toolbar {
            height: 40px;
            background: rgba(25, 25, 35, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 10px;
        }

        .gallery-content {
            height: calc(100% - 40px);
            padding: 15px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .gallery-item {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Calculator App */
        #calculator {
            width: 320px;
            height: 450px;
            top: 150px;
            left: 100px;
        }

        .calculator-display {
            height: 100px;
            background: rgba(10, 10, 15, 0.8);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 20px;
            font-size: 32px;
            font-family: 'Consolas', monospace;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: rgba(255, 255, 255, 0.05);
            padding: 1px;
        }

        .calc-btn {
            height: 70px;
            background: rgba(30, 30, 40, 0.9);
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .calc-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .calc-btn.operator {
            background: rgba(99, 102, 241, 0.3);
        }

        .calc-btn.operator:hover {
            background: rgba(99, 102, 241, 0.5);
        }

        .calc-btn.equals {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }

        .calc-btn.equals:hover {
            opacity: 0.9;
        }

        /* Settings App */
        #settings {
            width: 700px;
            height: 550px;
            top: 100px;
            left: 300px;
        }

        .settings-content {
            padding: 20px;
            height: 100%;
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.9);
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .settings-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .settings-label {
            font-size: 13px;
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-switch.active {
            background: rgba(99, 102, 241, 0.8);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.2s;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        /* Music Player App */
        #musicPlayer {
            width: 400px;
            height: 500px;
            top: 100px;
            left: 150px;
        }

        .music-player-content {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .music-album-art {
            width: 100%;
            aspect-ratio: 1;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            margin-bottom: 20px;
        }

        .music-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .music-title {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .music-artist {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        .music-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .music-btn {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .music-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .music-btn.play {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }

        .music-progress {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-bottom: 10px;
            position: relative;
            cursor: pointer;
        }

        .music-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 2px;
            width: 35%;
        }

        .music-time {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
        }

        .music-playlist {
            flex: 1;
            overflow-y: auto;
            margin-top: 20px;
        }

        .playlist-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .playlist-item.active {
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.4);
        }

        /* VS Code App */
        #vscode {
            width: 1000px;
            height: 700px;
            top: 50px;
            left: 100px;
        }

        .vscode-sidebar {
            width: 200px;
            height: 100%;
            background: #252526;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .vscode-tabs {
            display: flex;
            gap: 2px;
            background: #2d2d30;
            padding: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .vscode-tab {
            padding: 8px 12px;
            background: #2d2d30;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
        }

        .vscode-tab.active {
            background: #1e1e1e;
            color: #fff;
        }

        .vscode-explorer {
            flex: 1;
            padding: 10px;
            font-size: 12px;
        }

        .vscode-file-item {
            padding: 4px 8px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .vscode-file-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .vscode-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
        }

        .vscode-editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .vscode-tab-bar {
            height: 35px;
            background: #2d2d30;
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .vscode-editor-tab {
            padding: 8px 16px;
            background: #2d2d30;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vscode-editor-tab.active {
            background: #1e1e1e;
            color: #fff;
        }

        .vscode-editor-tab-close {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
        }

        .vscode-editor-tab-close:hover {
            background: rgba(255, 255, 255, 0.2);
            opacity: 1;
        }

        .vscode-editor {
            flex: 1;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            padding: 20px;
            overflow: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .vscode-editor:focus {
            outline: none;
        }

        .vscode-statusbar {
            height: 22px;
            background: #007acc;
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 11px;
            color: #fff;
        }

        .code-keyword { color: #569cd6; }
        .code-string { color: #ce9178; }
        .code-function { color: #dcdcaa; }
        .code-comment { color: #6a9955; }
        .code-number { color: #b5cea8; }


        .voice-playback {
            position: fixed;
            top: 100px;
            right: 20px;
            width: 300px;
            background: rgba(15, 15, 25, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 15px;
            z-index: 15000;
            display: none;
        }

        .voice-playback.active {
            display: block;
            animation: slideInRight 0.4s ease;
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .voice-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: rgba(99, 102, 241, 0.3);
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.2s;
        }

        .voice-btn:hover {
            background: rgba(99, 102, 241, 0.5);
            transform: scale(1.1);
        }

        .voice-btn.playing {
            background: rgba(16, 185, 129, 0.3);
            animation: pulse 2s infinite;
        }

        /* Top Bar Chat Agent Option */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 9999;
        }

        .top-bar-item {
            padding: 8px 14px;
            background: rgba(99, 102, 241, 0.25);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 10px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .top-bar-item:hover {
            background: rgba(99, 102, 241, 0.35);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }


        /* Enhanced Calendar Views */
        .calendar-view-tabs {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .calendar-view-tab {
            padding: 6px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-view-tab.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.4);
            color: #fff;
        }

        .calendar-month-view {
            padding: 20px;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .calendar-weekday {
            text-align: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            padding: 8px;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .calendar-day.has-events {
            border-color: rgba(99, 102, 241, 0.4);
        }

        .day-event {
            font-size: 10px;
            color: rgba(99, 102, 241, 0.8);
            margin-top: 4px;
            padding: 2px 4px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 3px;
        }
        /* One Agent Graph Styles */
        .agent-tooltip {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            pointer-events: none;
        }

        .agent-action-btn:hover {
            background: rgba(99, 102, 241, 0.3) !important;
            border-color: rgba(99, 102, 241, 0.6) !important;
        }

        #oneAgentGraph svg {
            width: 100%;
            height: 100%;
        }

        #oneAgentGraph .node {
            cursor: pointer;
        }

        #oneAgentGraph .node circle {
            transition: all 0.3s ease;
        }

        #oneAgentGraph .node:hover circle {
            r: 35;
            filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.8));
        }

        #oneAgentGraph .edge {
            transition: all 0.3s ease;
        }

        #oneAgentGraph .edge:hover {
            stroke-width: 4;
            opacity: 0.8;
        }

        /* One Voice Styles */
        .onevoice-tab {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .onevoice-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }

        .onevoice-tab.active {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
            color: #fff;
        }

        .onevoice-tab-content {
            display: none;
        }

        .onevoice-tab-content.active {
            display: block;
        }

        /* oneData App Styles */
        .onedata-tab {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .onedata-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }

        .onedata-tab.active {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
            color: #fff;
        }

        .onedata-tab-content {
            display: none;
        }

        .onedata-tab-content.active {
            display: block;
        }

        .cloud-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s;
        }

        .cloud-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(99, 102, 241, 0.4);
            transform: translateY(-2px);
        }

        .cloud-card.connected {
            border-left: 4px solid #10b981;
        }

        .cloud-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }

        .cloud-status.connected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .cloud-status.disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .storage-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .storage-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            height: 300px;
            position: relative;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* oneMemory App Styles */
        .onememory-tab {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .onememory-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }

        .onememory-tab.active {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
            color: #fff;
        }

        .onememory-tab-content {
            display: none;
        }

        .onememory-tab-content.active {
            display: flex !important;
        }

        .analytics-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .analytics-chart-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .analytics-chart-card h4 {
            margin: 0 0 15px 0;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
        }

        .analytics-chart-card canvas {
            max-height: 300px;
        }

        /* Memory Popup Styles */
        .memory-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            background: rgba(10, 10, 10, 0.98);
            border: 2px solid rgba(99, 102, 241, 0.5);
            border-radius: 16px;
            z-index: 20000;
            display: none;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            overflow: hidden;
        }

        .memory-popup-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(99, 102, 241, 0.1);
        }

        .memory-popup-header h3 {
            margin: 0;
            color: #fff;
            font-size: 18px;
        }

        .memory-popup-close {
            background: rgba(239, 68, 68, 0.3);
            border: 1px solid rgba(239, 68, 68, 0.5);
            border-radius: 6px;
            color: #fff;
            font-size: 24px;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .memory-popup-close:hover {
            background: rgba(239, 68, 68, 0.5);
        }

        .memory-popup-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(90vh - 100px);
        }

        .memory-popup-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }

        .memory-popup-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .memory-popup-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .memory-popup-tab.active {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
            color: #fff;
        }

        .memory-popup-tab-content {
            display: none;
        }

        .memory-popup-tab-content.active {
            display: block;
        }

        /* Todo App Styles */
        .todo-filter {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .todo-filter:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .todo-filter.active {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
            color: #fff;
        }

        .todo-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }

        .todo-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .todo-item.completed {
            opacity: 0.6;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: rgba(255, 255, 255, 0.5);
        }

        .todo-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .todo-checkbox.checked {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
        }

        .todo-checkbox.checked::after {
            content: '';
            color: #10b981;
            font-size: 14px;
            font-weight: 700;
        }

        .sticky-note {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 15px;
            min-height: 200px;
            width: 250px;
            position: fixed;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 2px 6px rgba(0, 0, 0, 0.2);
            cursor: move;
            z-index: 1000;
            resize: both;
            overflow: auto;
        }

        .sticky-note.dragging {
            opacity: 0.8;
            z-index: 10000;
        }

        .sticky-note textarea {
            width: 100%;
            min-height: 150px;
            background: transparent;
            border: none;
            color: #1f2937;
            font-size: 14px;
            resize: none;
            font-family: inherit;
        }

        .sticky-note .note-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 5px;
        }

        .sticky-note .note-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.1);
            color: #1f2937;
        }

        .reminder-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .reminder-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .reminder-item.past {
            opacity: 0.5;
        }

        .reminder-item.upcoming {
            border-left: 4px solid #f59e0b;
        }

        .note-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
        }

        .note-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .note-item.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.4);
        }

        .alarm-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Boot Screen -->
    <div class="boot-screen" id="bootScreen">
        <div class="boot-logo">oneOS</div>
        <div class="boot-message" id="bootMessage1">Initializing system...</div>
        <div class="boot-message" id="bootMessage2" style="animation-delay: 2s; opacity: 0;">Loading kernel modules...</div>
        <div class="boot-message" id="bootMessage3" style="animation-delay: 4s; opacity: 0;">Connecting to network...</div>
        <div class="boot-message" id="bootMessage4" style="animation-delay: 6s; opacity: 0;">Creating environment...</div>
        <div class="boot-message" id="bootMessage5" style="animation-delay: 8s; opacity: 0;">Setting up ubuntu...</div>
        <div class="boot-message" id="bootMessage6" style="animation-delay: 10s; opacity: 0;">Starting services...</div>
        <div class="boot-progress">
            <div class="boot-progress-bar"></div>
        </div>
    </div>

    <!-- Shutdown Screen -->
    <div class="shutdown-screen" id="shutdownScreen">
        <div class="shutdown-logo">oneOS</div>
        <div class="shutdown-message">Shutting down...</div>
        <div class="shutdown-progress">
            <div class="shutdown-progress-bar"></div>
        </div>
    </div>

    <!-- Blank Screen -->
    <div class="blank-screen" id="blankScreen"></div>

    <!-- Login Screen -->
    <div class="login-screen hidden" id="loginScreen">
        <div class="login-wallpaper"></div>
        <div class="login-time-date">
            <div class="login-time" id="loginTime">12:00 PM</div>
            <div class="login-date" id="loginDate">Mon, Jan 1</div>
        </div>
        <div class="login-container">
            <div class="login-title">oneOS</div>
            <form class="login-form" id="loginForm" onsubmit="handleLogin(event)">
                <div class="login-input-group">
                    <label class="login-label">Username</label>
                    <input type="text" class="login-input" id="loginUsername" placeholder="Enter username" required autofocus>
                </div>
                <div class="login-input-group">
                    <label class="login-label">Password</label>
                    <input type="password" class="login-input" id="loginPassword" placeholder="Enter password" required>
                </div>
                <button type="submit" class="login-button">Sign In</button>
                <div class="login-error" id="loginError">Invalid username or password</div>
            </form>
        </div>
        <!-- Welcome Animation -->
        <div class="welcome-animation hidden" id="welcomeAnimation">
            <div class="welcome-avatar">
                <div class="avatar-circle">
                    <span class="avatar-initial">K</span>
                </div>
            </div>
            <div class="welcome-text">Welcome, Kasyap</div>
        </div>
    </div>

    <!-- Desktop -->
    <div class="desktop" id="desktop">
        <div class="wallpaper"></div>
        
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="top-bar-item" id="goToLoginBtn" onclick="goToLogin()">
                Go to Login
            </div>
            <div class="top-bar-item" id="s1Btn" onclick="startSarahConversation()">
                s1
            </div>
            <div class="top-bar-item" id="chatAgentBtn" onclick="toggleAIChat()">
                Open Chat Agent
            </div>
        </div>
        
        <!-- Desktop Icons - Only Apps Starting with "One", Files, and Trash -->
        <div class="desktop-icons">
            <!-- Apps Starting with "One" -->
            <div class="desktop-icon" onclick="openApp('oneAgent')">
                <div class="desktop-icon-img"></div>
                <div class="desktop-icon-label">One Agent</div>
            </div>
            <div class="desktop-icon" onclick="openApp('oneData')">
                <div class="desktop-icon-img"></div>
                <div class="desktop-icon-label">oneData</div>
            </div>
            <div class="desktop-icon" onclick="openApp('browser')">
                <div class="desktop-icon-img"></div>
                <div class="desktop-icon-label">oneBrowser</div>
            </div>
            <div class="desktop-icon" onclick="openApp('notepad')">
                <div class="desktop-icon-img"></div>
                <div class="desktop-icon-label">onePad</div>
            </div>
            <div class="desktop-icon" onclick="openApp('oneVoice')">
                <div class="desktop-icon-img"></div>
                <div class="desktop-icon-label">One Voice</div>
            </div>
            <div class="desktop-icon" onclick="openApp('oneMemory')">
                <div class="desktop-icon-img"></div>
                <div class="desktop-icon-label">oneMemory</div>
            </div>
        </div>
        
        <!-- Files and Trash on the right side -->
        <div class="desktop-icons-right">
            <!-- Files -->
            <div class="desktop-icon" onclick="openApp('fileExplorer')">
                <div class="desktop-icon-img"></div>
                <div class="desktop-icon-label">Files</div>
            </div>
            <!-- Trash -->
            <div class="desktop-icon" onclick="openTrash()">
                <div class="desktop-icon-img"></div>
                <div class="desktop-icon-label">Trash</div>
            </div>
        </div>

        <!-- Notepad Window -->
        <div class="window" id="notepad">
            <div class="window-header" onmousedown="startDrag(event, 'notepad')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('notepad')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('notepad')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('notepad')"></div>
                </div>
                <div class="window-title">onePad - Project Notes.txt</div>
            </div>
            <div class="window-content">
                <textarea class="notepad-content" id="notepadContent">Project Timeline:
- Q1: Initial research and development
- Q2: Beta testing with select clients
- Q3: Full market launch
- Q4: Expansion to European markets

Key Features to Implement:
1. Real-time collaboration
2. AI-powered suggestions
3. Advanced analytics dashboard
4. Mobile optimization
5. Integration with existing tools

Meeting Notes:
- Review progress with team on Monday
- Client demo scheduled for Thursday
- Budget review with finance on Friday</textarea>
            </div>
        </div>

        <!-- Browser Window -->
        <div class="window" id="browser">
            <div class="window-header" onmousedown="startDrag(event, 'browser')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('browser')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('browser')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('browser')"></div>
                </div>
                <div class="window-title" id="browserTitle">oneBrowser</div>
            </div>
            <div class="window-content">
                <div class="browser-toolbar">
                    <button class="browser-nav-btn" onclick="browserGoBack()"></button>
                    <button class="browser-nav-btn" onclick="browserGoForward()"></button>
                    <button class="browser-nav-btn" onclick="browserReload()"></button>
                    <input type="text" class="url-bar" id="browserUrl" placeholder="Enter URL or search..." onkeypress="handleUrlInput(event)" value="">
                    <button class="browser-nav-btn" onclick="browserNavigate()">Go</button>
                    <button class="browser-nav-btn ai-agent-btn" onclick="toggleAIChatbot()" title="AI Agent"></button>
                </div>
                <div class="browser-viewport" id="browserViewport">
                    <div class="browser-placeholder" id="browserPlaceholder">
                        <div style="text-align: center; width: 100%;">
                            <h2 style="margin-bottom: 20px; color: rgba(255,255,255,0.9);">oneBrowser</h2>
                            <p style="margin-bottom: 30px; color: rgba(255,255,255,0.6);">Enter a URL or click a quick link below</p>
                            <div class="quick-search">
                                <button class="search-btn" onclick="navigateToUrl('https://duckduckgo.com')"> Google</button>
                                <button class="search-btn" onclick="navigateToUrl('https://www.youtube.com')"> YouTube</button>
                                <button class="search-btn" onclick="navigateToUrl('https://www.github.com')"> GitHub</button>
                                <button class="search-btn" onclick="navigateToUrl('https://www.wikipedia.org')"> Wikipedia</button>
                                <button class="search-btn" onclick="navigateToUrl('https://www.reddit.com')"> Reddit</button>
                                <button class="search-btn" onclick="navigateToUrl('https://www.twitter.com')"> Twitter</button>
                                </div>
                                </div>
                                </div>
                    <iframe class="browser-iframe" id="browserIframe" style="display: none;" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation allow-top-navigation-by-user-activation allow-modals" allow="fullscreen" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </div>

        <!-- AI Chatbot -->
        <div class="ai-chatbot" id="aiChatbot">
            <div class="ai-chatbot-header">
                <div class="ai-chatbot-title"> AI Agent</div>
                <div class="ai-chatbot-controls">
                    <button class="ai-chatbot-speak-toggle" id="aiChatbotSpeakToggle" onclick="toggleAIChatbotSpeak()" title="Toggle Auto-speak">
                        <span id="aiChatbotSpeakIcon"></span>
                    </button>
                    <button class="ai-chatbot-close" onclick="toggleAIChatbot()"></button>
                </div>
            </div>
            <div class="ai-chatbot-messages" id="aiChatbotMessages">
                <div class="ai-message ai-message-assistant">
                    <div class="ai-message-content">Hello! I'm your AI assistant. How can I help you today?</div>
                    <button class="ai-message-speak" onclick="speakAIMessage(this)" title="Play audio"></button>
                </div>
            </div>
            <div class="ai-chatbot-input-container">
                <input type="text" class="ai-chatbot-input" id="aiChatbotInput" placeholder="Ask me anything..." onkeypress="handleAIChatbotInput(event)">
                <button class="ai-chatbot-send" onclick="sendAIMessage()">Send</button>
            </div>
        </div>

        <!-- Calendar Window -->
        <div class="window" id="calendar">
            <div class="window-header" onmousedown="startDrag(event, 'calendar')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('calendar')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('calendar')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('calendar')"></div>
                </div>
                <div class="window-title">Calendar</div>
            </div>
            <div class="window-content">
                <div class="calendar-view-tabs">
                    <div class="calendar-view-tab active" onclick="switchCalendarView('month')">Month</div>
                    <div class="calendar-view-tab" onclick="switchCalendarView('week')">Week</div>
                    <div class="calendar-view-tab" onclick="switchCalendarView('day')">Day</div>
                    <div class="calendar-view-tab" onclick="switchCalendarView('agenda')">Agenda</div>
                </div>
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-title" id="calendarTitle">Your Schedule</div>
                        <div class="calendar-date" id="calendarDate">March 2024</div>
                    </div>
                    <div id="calendarMonthView" class="calendar-month-view">
                        <!-- Month view will be rendered here -->
                    </div>
                    <div id="calendarEvents" style="display: none;">
                        <!-- Events list will be added dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- VS Code Window -->
        <div class="window" id="vscode">
            <div class="window-header" onmousedown="startDrag(event, 'vscode')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('vscode')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('vscode')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('vscode')"></div>
                </div>
                <div class="window-title">Visual Studio Code</div>
            </div>
            <div class="window-content" style="display: flex; height: 100%; padding: 0;">
                <div class="vscode-sidebar">
                    <div class="vscode-tabs">
                        <div class="vscode-tab active">Explorer</div>
                        <div class="vscode-tab">Search</div>
                    </div>
                    <div class="vscode-explorer">
                        <div class="vscode-file-item"> src</div>
                        <div class="vscode-file-item" style="margin-left: 20px;"> App.js</div>
                        <div class="vscode-file-item" style="margin-left: 20px;"> components</div>
                        <div class="vscode-file-item" style="margin-left: 40px;"> Header.js</div>
                        <div class="vscode-file-item" style="margin-left: 40px;"> Footer.js</div>
                        <div class="vscode-file-item"> public</div>
                        <div class="vscode-file-item" style="margin-left: 20px;"> index.html</div>
                        <div class="vscode-file-item"> package.json</div>
                        <div class="vscode-file-item"> README.md</div>
                    </div>
                </div>
                <div class="vscode-main">
                    <div class="vscode-editor-container">
                        <div class="vscode-tab-bar">
                            <div class="vscode-editor-tab active">
                                <span>App.js</span>
                                <span class="vscode-editor-tab-close"></span>
                            </div>
                            <div class="vscode-editor-tab">
                                <span>Header.js</span>
                                <span class="vscode-editor-tab-close"></span>
                            </div>
                        </div>
                        <div class="vscode-editor" id="vscodeEditor" contenteditable="true" spellcheck="false" style="user-select: text;">
import React from 'react';
import './App.css';

function App() {
  const [count, setCount] = useState(0);

  return (
    &lt;div className="App"&gt;
      &lt;h1&gt;Welcome to My App&lt;/h1&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Count: {count}
      &lt;/button&gt;
      // This is a comment
    &lt;/div&gt;
  );
}

export default App;
                        </div>
                    </div>
                    <div class="vscode-statusbar">
                        <span>Ln 12, Col 25</span>
                        <span style="margin-left: 20px;">Spaces: 2</span>
                        <span style="margin-left: 20px;">UTF-8</span>
                        <span style="margin-left: 20px;">JavaScript React</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- One Agent Window -->
        <div class="window" id="oneAgent" style="width: 1200px; height: 800px; top: 50px; left: 100px;">
            <div class="window-header" onmousedown="startDrag(event, 'oneAgent')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('oneAgent')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('oneAgent')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('oneAgent')"></div>
                </div>
                <div class="window-title">One Agent - Agent Network</div>
            </div>
            <div class="window-content" style="padding: 0; height: 100%; display: flex; flex-direction: column;">
                <div style="padding: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: rgba(99, 102, 241, 0.05);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 14px; font-weight: 500;">Agent Network Visualization</div>
                        <div id="oneAgentLegend" style="display: flex; gap: 15px; font-size: 11px;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></div>
                                <span>Critical</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%;"></div>
                                <span>High</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 12px; height: 12px; background: #3b82f6; border-radius: 50%;"></div>
                                <span>Medium</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%;"></div>
                                <span>Low</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="display: flex; flex: 1; height: calc(100% - 60px); min-height: 600px;">
                    <div id="oneAgentGraph" style="flex: 1; width: calc(100% - 300px); height: 100%; background: rgba(10, 10, 18, 0.5); position: relative; overflow: visible;"></div>
                    <div id="oneAgentAssistant" style="width: 300px; height: 100%; background: rgba(10, 10, 18, 0.7); border-left: 1px solid rgba(255, 255, 255, 0.1); padding: 15px; display: flex; flex-direction: column;">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 15px; color: rgba(99, 102, 241, 0.9);"> Assistant</div>
                        <div id="assistantMessages" style="flex: 1; overflow-y: auto; font-size: 11px; color: rgba(255, 255, 255, 0.7); line-height: 1.6;">
                            <div style="margin-bottom: 10px; padding: 8px; background: rgba(99, 102, 241, 0.1); border-radius: 6px;">
                                Hello! I'm your assistant. Click on any agent node to see details and perform actions.
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Conversation Summary Panel (shown when conversation is complete) -->
                <div id="conversationSummaryPanel" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 10, 18, 0.98); backdrop-filter: blur(10px); z-index: 1000; padding: 30px; overflow-y: auto;">
                    <div style="max-width: 800px; margin: 0 auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                            <h2 style="color: #fff; font-size: 24px; font-weight: 700; margin: 0;"> Conversation Summary</h2>
                            <button onclick="closeConversationSummary()" style="padding: 8px 16px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;"> Close</button>
            </div>
                        <div id="conversationSummaryContent" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 25px; margin-bottom: 25px;">
                            <!-- Summary will be populated here -->
                        </div>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button onclick="handleSummarizeFromPanel()" style="flex: 1; min-width: 200px; padding: 15px 25px; background: rgba(99, 102, 241, 0.3); border: 1px solid rgba(99, 102, 241, 0.5); border-radius: 10px; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(99, 102, 241, 0.5)'" onmouseout="this.style.background='rgba(99, 102, 241, 0.3)'"> View Full Summary</button>
                            <button onclick="handleGoAheadWithBookingFromPanel()" style="flex: 1; min-width: 200px; padding: 15px 25px; background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.5); border-radius: 10px; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(16, 185, 129, 0.5)'" onmouseout="this.style.background='rgba(16, 185, 129, 0.3)'"> Proceed with Booking</button>
                            <button onclick="handleAddToCalendarFromPanel()" style="flex: 1; min-width: 200px; padding: 15px 25px; background: rgba(245, 158, 11, 0.3); border: 1px solid rgba(245, 158, 11, 0.5); border-radius: 10px; color: #fff; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(245, 158, 11, 0.5)'" onmouseout="this.style.background='rgba(245, 158, 11, 0.3)'"> Add to Calendar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- One Voice Window -->
        <div class="window" id="oneVoice" style="width: 1200px; height: 800px; top: 50px; left: 100px;">
            <div class="window-header" onmousedown="startDrag(event, 'oneVoice')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('oneVoice')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('oneVoice')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('oneVoice')"></div>
                </div>
                <div class="window-title">One Voice - ElevenLabs Voice Studio</div>
            </div>
            <div class="window-content" style="padding: 0; height: 100%; display: flex; flex-direction: column;">
                <div style="padding: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: rgba(99, 102, 241, 0.05);">
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <button class="onevoice-tab active" onclick="switchOneVoiceTab('tts')" id="tab-tts"> Text-to-Speech</button>
                        <button class="onevoice-tab" onclick="switchOneVoiceTab('clone')" id="tab-clone"> Voice Cloning</button>
                        <button class="onevoice-tab" onclick="switchOneVoiceTab('convert')" id="tab-convert"> Voice Conversion</button>
                        <button class="onevoice-tab" onclick="switchOneVoiceTab('music')" id="tab-music"> Music Generation</button>
                        <button class="onevoice-tab" onclick="switchOneVoiceTab('library')" id="tab-library"> Voice Library</button>
                        <button class="onevoice-tab" onclick="switchOneVoiceTab('settings')" id="tab-settings"> Settings</button>
                    </div>
                </div>
                <div style="flex: 1; overflow-y: auto; padding: 20px;">
                    <!-- Text-to-Speech Tab -->
                    <div id="onevoice-tts" class="onevoice-tab-content active">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Text-to-Speech</h3>
                        <div style="display: flex; gap: 20px; height: calc(100% - 100px);">
                            <div style="flex: 1;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Select Voice</label>
                                    <select id="tts-voice-select" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                                        <option value="">Loading voices...</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Enter Text</label>
                                    <textarea id="tts-text-input" placeholder="Enter text to convert to speech..." style="width: 100%; min-height: 200px; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px; resize: vertical;"></textarea>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="generateTTS()" style="flex: 1; padding: 12px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 6px; color: #fff; font-size: 14px; cursor: pointer; transition: all 0.2s;"> Generate Speech</button>
                                    <button onclick="playTTS()" id="tts-play-btn" style="padding: 12px 20px; background: rgba(99, 102, 241, 0.3); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 6px; color: #fff; font-size: 14px; cursor: pointer; transition: all 0.2s;" disabled> Play</button>
                                    <button onclick="downloadTTS()" id="tts-download-btn" style="padding: 12px 20px; background: rgba(99, 102, 241, 0.3); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 6px; color: #fff; font-size: 14px; cursor: pointer; transition: all 0.2s;" disabled> Download</button>
                                </div>
                            </div>
                            <div style="width: 300px; background: rgba(10, 10, 18, 0.5); border-radius: 8px; padding: 15px;">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Voice Settings</h4>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">Stability</label>
                                    <input type="range" id="tts-stability" min="0" max="1" step="0.1" value="0.5" style="width: 100%;">
                                    <span id="tts-stability-value" style="color: rgba(255, 255, 255, 0.5); font-size: 11px;">0.5</span>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">Similarity Boost</label>
                                    <input type="range" id="tts-similarity" min="0" max="1" step="0.1" value="0.75" style="width: 100%;">
                                    <span id="tts-similarity-value" style="color: rgba(255, 255, 255, 0.5); font-size: 11px;">0.75</span>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">Style</label>
                                    <input type="range" id="tts-style" min="0" max="1" step="0.1" value="0.0" style="width: 100%;">
                                    <span id="tts-style-value" style="color: rgba(255, 255, 255, 0.5); font-size: 11px;">0.0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Voice Cloning Tab -->
                    <div id="onevoice-clone" class="onevoice-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Voice Cloning</h3>
                        <div style="max-width: 600px;">
                            <div style="margin-bottom: 20px; padding: 20px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border: 1px dashed rgba(99, 102, 241, 0.3);">
                                <input type="file" id="clone-audio-file" accept="audio/*" style="display: none;" onchange="handleCloneFileSelect(event)">
                                <button onclick="document.getElementById('clone-audio-file').click()" style="width: 100%; padding: 20px; background: rgba(99, 102, 241, 0.2); border: 2px dashed rgba(99, 102, 241, 0.4); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;">
                                     Upload Audio Sample
                                </button>
                                <div id="clone-file-info" style="margin-top: 10px; font-size: 12px; color: rgba(255, 255, 255, 0.6);"></div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Voice Name</label>
                                <input type="text" id="clone-voice-name" placeholder="Enter voice name..." style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Description (Optional)</label>
                                <textarea id="clone-voice-desc" placeholder="Enter description..." style="width: 100%; min-height: 80px; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px; resize: vertical;"></textarea>
                            </div>
                            <button onclick="cloneVoice()" style="width: 100%; padding: 12px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 6px; color: #fff; font-size: 14px; cursor: pointer; transition: all 0.2s;"> Clone Voice</button>
                            <div id="clone-status" style="margin-top: 15px; padding: 10px; border-radius: 6px; font-size: 13px; display: none;"></div>
                        </div>
                    </div>

                    <!-- Voice Conversion Tab -->
                    <div id="onevoice-convert" class="onevoice-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Voice Conversion</h3>
                        <div style="max-width: 600px;">
                            <div style="margin-bottom: 20px; padding: 20px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border: 1px dashed rgba(99, 102, 241, 0.3);">
                                <input type="file" id="convert-audio-file" accept="audio/*" style="display: none;" onchange="handleConvertFileSelect(event)">
                                <button onclick="document.getElementById('convert-audio-file').click()" style="width: 100%; padding: 20px; background: rgba(99, 102, 241, 0.2); border: 2px dashed rgba(99, 102, 241, 0.4); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;">
                                     Upload Audio to Convert
                                </button>
                                <div id="convert-file-info" style="margin-top: 10px; font-size: 12px; color: rgba(255, 255, 255, 0.6);"></div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Select Target Voice</label>
                                <select id="convert-voice-select" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                                    <option value="">Loading voices...</option>
                                </select>
                            </div>
                            <button onclick="convertVoice()" style="width: 100%; padding: 12px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 6px; color: #fff; font-size: 14px; cursor: pointer; transition: all 0.2s;"> Convert Voice</button>
                            <div id="convert-status" style="margin-top: 15px; padding: 10px; border-radius: 6px; font-size: 13px; display: none;"></div>
                            <div id="convert-result" style="margin-top: 15px; display: none;">
                                <audio id="convert-audio-player" controls style="width: 100%; margin-top: 10px;"></audio>
                                <button onclick="downloadConvertedAudio()" style="width: 100%; margin-top: 10px; padding: 10px; background: rgba(99, 102, 241, 0.3); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;"> Download Converted Audio</button>
                            </div>
                        </div>
                    </div>

                    <!-- Music Generation Tab -->
                    <div id="onevoice-music" class="onevoice-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Music Generation</h3>
                        <div style="max-width: 800px;">
                            <div style="margin-bottom: 20px; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.3);">
                                <p style="color: rgba(255, 255, 255, 0.7); font-size: 13px; line-height: 1.6;">
                                    Generate music using text descriptions. This feature uses ElevenLabs voice synthesis to create musical compositions and soundscapes.
                                </p>
                            </div>
                            <div style="display: flex; gap: 20px;">
                                <div style="flex: 1;">
                                    <div style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Music Description</label>
                                        <textarea id="music-prompt" placeholder="Describe the music you want to generate... (e.g., 'Upbeat electronic dance music with synthesizers', 'Calm ambient background music', 'Jazz piano with smooth saxophone')" style="width: 100%; min-height: 150px; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px; resize: vertical;"></textarea>
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Select Voice for Musical Elements</label>
                                        <select id="music-voice-select" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                                            <option value="">Loading voices...</option>
                                        </select>
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Music Style</label>
                                        <select id="music-style" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                                            <option value="ambient">Ambient</option>
                                            <option value="electronic">Electronic</option>
                                            <option value="jazz">Jazz</option>
                                            <option value="classical">Classical</option>
                                            <option value="rock">Rock</option>
                                            <option value="hip-hop">Hip-Hop</option>
                                            <option value="acoustic">Acoustic</option>
                                            <option value="cinematic">Cinematic</option>
                                        </select>
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Duration (seconds)</label>
                                        <input type="number" id="music-duration" min="10" max="120" value="30" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                                    </div>
                                    <button onclick="generateMusic()" style="width: 100%; padding: 12px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 6px; color: #fff; font-size: 14px; cursor: pointer; transition: all 0.2s;"> Generate Music</button>
                                    <div id="music-status" style="margin-top: 15px; padding: 10px; border-radius: 6px; font-size: 13px; display: none;"></div>
                                    <div id="music-result" style="margin-top: 15px; display: none;">
                                        <audio id="music-audio-player" controls style="width: 100%; margin-top: 10px;"></audio>
                                        <button onclick="downloadMusic()" style="width: 100%; margin-top: 10px; padding: 10px; background: rgba(99, 102, 241, 0.3); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;"> Download Music</button>
                                    </div>
                                </div>
                                <div style="width: 300px; background: rgba(10, 10, 18, 0.5); border-radius: 8px; padding: 15px;">
                                    <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Tips</h4>
                                    <ul style="font-size: 12px; color: rgba(255, 255, 255, 0.7); line-height: 1.8; padding-left: 20px;">
                                        <li>Be specific about instruments</li>
                                        <li>Describe the mood and tempo</li>
                                        <li>Mention genre or style</li>
                                        <li>Include tempo (fast/slow)</li>
                                        <li>Note: This uses TTS to create musical descriptions. For full music generation, consider integrating with dedicated music AI services.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Voice Library Tab -->
                    <div id="onevoice-library" class="onevoice-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Voice Library</h3>
                        <div id="voice-library-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                            <div style="padding: 15px; text-align: center; color: rgba(255, 255, 255, 0.6);">Loading voices...</div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="onevoice-settings" class="onevoice-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Voice Settings</h3>
                        <div style="max-width: 600px;">
                            <div style="margin-bottom: 20px; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 8px;">
                                <label style="display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">Select Voice</label>
                                <select id="settings-voice-select" style="width: 100%; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                                    <option value="">Loading voices...</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">Stability</label>
                                <input type="range" id="settings-stability" min="0" max="1" step="0.1" value="0.5" style="width: 100%;">
                                <span id="settings-stability-value" style="color: rgba(255, 255, 255, 0.5); font-size: 11px;">0.5</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">Similarity Boost</label>
                                <input type="range" id="settings-similarity" min="0" max="1" step="0.1" value="0.75" style="width: 100%;">
                                <span id="settings-similarity-value" style="color: rgba(255, 255, 255, 0.5); font-size: 11px;">0.75</span>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">Style</label>
                                <input type="range" id="settings-style" min="0" max="1" step="0.1" value="0.0" style="width: 100%;">
                                <span id="settings-style-value" style="color: rgba(255, 255, 255, 0.5); font-size: 11px;">0.0</span>
                            </div>
                            <button onclick="saveVoiceSettings()" style="width: 100%; padding: 12px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 6px; color: #fff; font-size: 14px; cursor: pointer; transition: all 0.2s;"> Save Settings</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- oneData Window -->
        <div class="window" id="oneData" style="width: 1400px; height: 900px; top: 30px; left: 50px;">
            <div class="window-header" onmousedown="startDrag(event, 'oneData')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('oneData')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('oneData')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('oneData')"></div>
                </div>
                <div class="window-title">oneData - Distributed Cloud Storage</div>
            </div>
            <div class="window-content" style="padding: 0; height: 100%; display: flex; flex-direction: column;">
                <div style="padding: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: rgba(99, 102, 241, 0.05);">
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <button class="onedata-tab active" onclick="switchOneDataTab('clouds')" id="tab-clouds"> Cloud Connections</button>
                        <button class="onedata-tab" onclick="switchOneDataTab('browser')" id="tab-browser"> File Browser</button>
                        <button class="onedata-tab" onclick="switchOneDataTab('analytics')" id="tab-analytics"> Analytics</button>
                        <button class="onedata-tab" onclick="switchOneDataTab('optimization')" id="tab-optimization"> Optimization</button>
                        <button class="onedata-tab" onclick="switchOneDataTab('security')" id="tab-security"> Security</button>
                        <button class="onedata-tab" onclick="switchOneDataTab('settings')" id="tab-settings"> Settings</button>
                    </div>
                </div>
                <div style="flex: 1; overflow-y: auto; padding: 20px;">
                    <!-- Cloud Connections Tab -->
                    <div id="onedata-clouds" class="onedata-tab-content active">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Connected Cloud Services</h3>
                        <div id="clouds-list">
                            <!-- Cloud cards will be populated by JavaScript -->
                        </div>
                        <button onclick="addCloudProvider()" style="margin-top: 20px; padding: 12px 24px; background: rgba(99, 102, 241, 0.3); border: 1px solid rgba(99, 102, 241, 0.5); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer; transition: all 0.2s;">+ Add Cloud Provider</button>
                    </div>

                    <!-- File Browser Tab -->
                    <div id="onedata-browser" class="onedata-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Unified File Browser</h3>
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <select id="browser-cloud-select" style="flex: 1; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                                <option value="all">All Clouds</option>
                            </select>
                            <input type="text" id="browser-search" placeholder="Search files..." style="flex: 2; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                        </div>
                        <div id="files-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                            <!-- Files will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Analytics Tab -->
                    <div id="onedata-analytics" class="onedata-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Storage Analytics & Visualizations</h3>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div class="stat-card">
                                <div class="stat-value" id="stat-total">0 TB</div>
                                <div class="stat-label">Total Storage</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-used">0 TB</div>
                                <div class="stat-label">Used Storage</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-available">0 TB</div>
                                <div class="stat-label">Available</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-clouds">0</div>
                                <div class="stat-label">Connected Clouds</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <div class="chart-container">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Storage Distribution by Cloud</h4>
                                <canvas id="chart-storage-distribution"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">File Type Distribution</h4>
                                <canvas id="chart-file-types"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Storage Usage Over Time</h4>
                                <canvas id="chart-usage-timeline"></canvas>
                            </div>
                            <div class="chart-container">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Cloud Performance Comparison</h4>
                                <canvas id="chart-performance"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Optimization Tab -->
                    <div id="onedata-optimization" class="onedata-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Intelligent Optimization</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px;">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Auto-Scaling Status</h4>
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Scale Up Threshold</span>
                                        <span style="color: #fff; font-size: 12px;">80%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Scale Down Threshold</span>
                                        <span style="color: #fff; font-size: 12px;">30%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Current Status</span>
                                        <span style="color: #10b981; font-size: 12px; font-weight: 600;">Optimized</span>
                                    </div>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px;">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Cleanup & Optimization</h4>
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Duplicate Files</span>
                                        <span style="color: #fff; font-size: 12px;">12 files (2.3 GB)</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Temporary Files</span>
                                        <span style="color: #fff; font-size: 12px;">45 files (1.1 GB)</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Optimization Savings</span>
                                        <span style="color: #10b981; font-size: 12px; font-weight: 600;">3.4 GB</span>
                                    </div>
                                </div>
                                <button onclick="runOptimization()" style="width: 100%; padding: 10px; background: rgba(99, 102, 241, 0.3); border: 1px solid rgba(99, 102, 241, 0.5); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;">Run Optimization</button>
                            </div>
                        </div>
                    </div>

                    <!-- Security Tab -->
                    <div id="onedata-security" class="onedata-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Security & Encryption</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px;">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Encryption Status</h4>
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Data at Rest</span>
                                        <span style="color: #10b981; font-size: 12px; font-weight: 600;"> AES-256</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Data in Transit</span>
                                        <span style="color: #10b981; font-size: 12px; font-weight: 600;"> TLS 1.3</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">End-to-End Encryption</span>
                                        <span style="color: #10b981; font-size: 12px; font-weight: 600;"> Enabled</span>
                                    </div>
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px;">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Access Control</h4>
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Two-Factor Auth</span>
                                        <span style="color: #10b981; font-size: 12px; font-weight: 600;"> Active</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Access Logs</span>
                                        <span style="color: #10b981; font-size: 12px; font-weight: 600;"> Monitored</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="color: rgba(255, 255, 255, 0.7); font-size: 12px;">Security Score</span>
                                        <span style="color: #10b981; font-size: 12px; font-weight: 600;">98/100</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="onedata-settings" class="onedata-tab-content">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">oneData Settings</h3>
                        <div style="max-width: 600px;">
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Auto-Scaling</h4>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: flex; align-items: center; gap: 10px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">
                                        <input type="checkbox" checked style="width: 18px; height: 18px;">
                                        Enable automatic scaling
                                    </label>
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">Scale Up Threshold (%)</label>
                                    <input type="range" min="50" max="95" value="80" style="width: 100%;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.7); font-size: 12px;">Scale Down Threshold (%)</label>
                                    <input type="range" min="10" max="50" value="30" style="width: 100%;">
                                </div>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                                <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Optimization</h4>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: flex; align-items: center; gap: 10px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">
                                        <input type="checkbox" checked style="width: 18px; height: 18px;">
                                        Auto-cleanup duplicate files
                                    </label>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: flex; align-items: center; gap: 10px; color: rgba(255, 255, 255, 0.7); font-size: 13px;">
                                        <input type="checkbox" checked style="width: 18px; height: 18px;">
                                        Auto-optimize storage
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Todo Window -->
        <div class="window" id="todo" style="width: 800px; height: 700px; top: 50px; left: 100px;">
            <div class="window-header" onmousedown="startDrag(event, 'todo')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('todo')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('todo')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('todo')"></div>
                </div>
                <div class="window-title">Todo - AI-Powered Task Manager</div>
            </div>
            <div class="window-content" style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="todo-input" placeholder="Add a new task... (AI can help!)" style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #fff; font-size: 14px;" onkeypress="if(event.key==='Enter') { addTodo(); }">
                    <button onclick="addTodo()" style="padding: 12px 24px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;">Add</button>
                    <button onclick="askAITodo()" style="padding: 12px 24px; background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;" title="Get AI suggestions"> AI</button>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button onclick="askAIToPrioritizeTodos()" style="flex: 1; padding: 10px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; color: #fff; font-size: 12px; cursor: pointer;" title="AI Prioritization"> AI Prioritize</button>
                    <button onclick="askAIToAnalyzeTodos()" style="flex: 1; padding: 10px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; color: #fff; font-size: 12px; cursor: pointer;" title="AI Analysis"> AI Analyze</button>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button onclick="filterTodos('all')" id="filter-all" class="todo-filter active">All</button>
                    <button onclick="filterTodos('active')" id="filter-active" class="todo-filter">Active</button>
                    <button onclick="filterTodos('completed')" id="filter-completed" class="todo-filter">Completed</button>
                </div>
                <div id="todo-list" style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;">
                    <!-- Todos will be populated by JavaScript -->
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: rgba(255, 255, 255, 0.6);">
                    <span id="todo-count">0 tasks</span>
                    <button onclick="clearCompleted()" style="padding: 6px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; color: #ef4444; font-size: 12px; cursor: pointer;">Clear Completed</button>
                </div>
            </div>
        </div>

        <!-- Sticky Notes Window (for creating new notes) -->
        <div class="window" id="stickynotes" style="width: 500px; height: 400px; top: 50px; left: 150px; display: none;">
            <div class="window-header" onmousedown="startDrag(event, 'stickynotes')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('stickynotes')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('stickynotes')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('stickynotes')"></div>
                </div>
                <div class="window-title">Sticky Notes Manager</div>
            </div>
            <div class="window-content" style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button onclick="createStickyNote()" style="flex: 1; padding: 12px 24px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;">+ New Note</button>
                    <button onclick="askAIStickyNote()" style="padding: 12px 24px; background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;" title="AI-powered note suggestions"> AI Note</button>
                </div>
                <div style="flex: 1; overflow-y: auto; padding: 10px; background: rgba(255, 255, 255, 0.02); border-radius: 8px;">
                    <p style="color: rgba(255, 255, 255, 0.6); font-size: 13px; line-height: 1.6;">
                        Sticky notes appear on your desktop. Click "+ New Note" to create one, or use AI to generate a helpful note idea.
                    </p>
                </div>
            </div>
        </div>

        <!-- Reminders Window -->
        <div class="window" id="reminders" style="width: 900px; height: 750px; top: 40px; left: 120px;">
            <div class="window-header" onmousedown="startDrag(event, 'reminders')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('reminders')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('reminders')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('reminders')"></div>
                </div>
                <div class="window-title">Reminders - AI Smart Reminders</div>
            </div>
            <div class="window-content" style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <input type="text" id="reminder-title" placeholder="Reminder title..." style="flex: 1; min-width: 200px; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #fff; font-size: 14px;">
                    <input type="datetime-local" id="reminder-date" style="padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #fff; font-size: 14px;">
                    <button onclick="addReminder()" style="padding: 12px 24px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;">Add</button>
                    <button onclick="askAIReminder()" style="padding: 12px 24px; background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;" title="AI reminder suggestions"> AI</button>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button onclick="askAIToSmartScheduleReminders()" style="flex: 1; padding: 10px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; color: #fff; font-size: 12px; cursor: pointer;" title="AI Schedule Analysis"> AI Schedule</button>
                </div>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button onclick="filterReminders('all')" id="reminder-filter-all" class="todo-filter active">All</button>
                    <button onclick="filterReminders('upcoming')" id="reminder-filter-upcoming" class="todo-filter">Upcoming</button>
                    <button onclick="filterReminders('past')" id="reminder-filter-past" class="todo-filter">Past</button>
                </div>
                <div id="reminders-list" style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;">
                    <!-- Reminders will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Notes Window -->
        <div class="window" id="notes" style="width: 900px; height: 700px; top: 50px; left: 100px;">
            <div class="window-header" onmousedown="startDrag(event, 'notes')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('notes')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('notes')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('notes')"></div>
                </div>
                <div class="window-title">Notes - AI-Powered Notes</div>
            </div>
            <div class="window-content" style="padding: 0; height: 100%; display: flex;">
                <div style="width: 250px; border-right: 1px solid rgba(255, 255, 255, 0.1); padding: 15px; overflow-y: auto; background: rgba(10, 10, 18, 0.5);">
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button onclick="createNote()" style="flex: 1; padding: 10px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;">+ New</button>
                        <button onclick="askAINote()" style="padding: 10px; background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;" title="AI note suggestions"></button>
                    </div>
                    <div id="notes-list" style="display: flex; flex-direction: column; gap: 8px;">
                        <!-- Notes list will be populated by JavaScript -->
                    </div>
                </div>
                <div style="flex: 1; display: flex; flex-direction: column; padding: 20px;">
                    <input type="text" id="note-title" placeholder="Note title..." style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">
                    <textarea id="note-content" placeholder="Start writing your note..." style="flex: 1; width: 100%; padding: 15px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #fff; font-size: 14px; resize: none; font-family: inherit;" oninput="saveCurrentNote()"></textarea>
                    <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
                        <button onclick="deleteCurrentNote()" style="padding: 10px 20px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; color: #ef4444; font-size: 13px; cursor: pointer;">Delete</button>
                        <button onclick="askAIToEnhanceNote()" style="padding: 10px 20px; background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;"> AI Enhance</button>
                        <button onclick="askAIToSummarizeNote()" style="padding: 10px 20px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;" title="AI Summary"> AI Summarize</button>
                        <button onclick="askAIToFormatNote()" style="padding: 10px 20px; background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;" title="AI Format"> AI Format</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weather Window -->
        <div class="window" id="weather" style="width: 500px; height: 600px; top: 80px; left: 200px;">
            <div class="window-header" onmousedown="startDrag(event, 'weather')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('weather')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('weather')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('weather')"></div>
                </div>
                <div class="window-title">Weather - AI Weather Assistant</div>
            </div>
            <div class="window-content" style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="weather-location" placeholder="Enter location..." value="Amherst, MA" style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #fff; font-size: 14px;">
                    <button onclick="getWeather()" style="padding: 12px 24px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;">Search</button>
                    <button onclick="askAIWeather()" style="padding: 12px; background: rgba(16, 185, 129, 0.3); border: 1px solid rgba(16, 185, 129, 0.4); border-radius: 8px; color: #fff; font-size: 14px; cursor: pointer;" title="AI weather insights"></button>
                </div>
                <div id="weather-content" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                    <div style="font-size: 64px; margin-bottom: 20px;"></div>
                    <div style="font-size: 48px; font-weight: 700; color: #fff; margin-bottom: 10px;">72F</div>
                    <div style="font-size: 24px; color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">Partly Cloudy</div>
                    <div style="font-size: 16px; color: rgba(255, 255, 255, 0.6); margin-bottom: 30px;">Amherst, MA</div>
                    <div style="width: 100%; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px;">
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px; text-align: center;">
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">Feels Like</div>
                            <div style="font-size: 20px; font-weight: 600; color: #fff;">75F</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px; text-align: center;">
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">Humidity</div>
                            <div style="font-size: 20px; font-weight: 600; color: #fff;">65%</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px; text-align: center;">
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">Wind</div>
                            <div style="font-size: 20px; font-weight: 600; color: #fff;">8 mph</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clock Window -->
        <div class="window" id="clock" style="width: 600px; height: 500px; top: 80px; left: 200px;">
            <div class="window-header" onmousedown="startDrag(event, 'clock')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('clock')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('clock')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('clock')"></div>
                </div>
                <div class="window-title">Clock - AI Time Assistant</div>
            </div>
            <div class="window-content" style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                    <div id="clock-time" style="font-size: 72px; font-weight: 700; color: #fff; margin-bottom: 20px; font-family: 'Courier New', monospace;">--:--:--</div>
                    <div id="clock-date" style="font-size: 24px; color: rgba(255, 255, 255, 0.7); margin-bottom: 30px;">-- --, ----</div>
                    <div style="display: flex; gap: 20px; margin-top: 30px;">
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 20px; text-align: center; min-width: 120px;">
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">New York</div>
                            <div id="time-ny" style="font-size: 24px; font-weight: 600; color: #fff;">--:--</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 20px; text-align: center; min-width: 120px;">
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">London</div>
                            <div id="time-london" style="font-size: 24px; font-weight: 600; color: #fff;">--:--</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 20px; text-align: center; min-width: 120px;">
                            <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">Tokyo</div>
                            <div id="time-tokyo" style="font-size: 24px; font-weight: 600; color: #fff;">--:--</div>
                        </div>
                    </div>
                </div>
                <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px; margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: rgba(255, 255, 255, 0.9); font-size: 14px;">Alarms</h4>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="time" id="alarm-time" style="flex: 1; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                        <input type="text" id="alarm-label" placeholder="Alarm label..." style="flex: 2; padding: 10px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #fff; font-size: 14px;">
                        <button onclick="addAlarm()" style="padding: 10px 20px; background: rgba(99, 102, 241, 0.5); border: 1px solid rgba(99, 102, 241, 0.6); border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer;">Add</button>
                    </div>
                    <div id="alarms-list" style="display: flex; flex-direction: column; gap: 8px; max-height: 150px; overflow-y: auto;">
                        <!-- Alarms will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- oneMemory Window -->
        <div class="window" id="oneMemory" style="width: 90vw; height: 85vh; top: 5vh; left: 5vw; max-width: 1600px; max-height: 900px;">
            <div class="window-header" onmousedown="startDrag(event, 'oneMemory')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('oneMemory')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('oneMemory')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('oneMemory')"></div>
                </div>
                <div class="window-title">oneMemory - Memory Graph & Analytics</div>
            </div>
            <div class="window-content" style="padding: 0; height: calc(100% - 40px); display: flex; flex-direction: column; overflow: hidden;">
                <div style="padding: 12px 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); background: rgba(99, 102, 241, 0.05); flex-shrink: 0;">
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <button class="onememory-tab active" onclick="switchOneMemoryTab('graph')" id="tab-graph"> Graph View</button>
                        <button class="onememory-tab" onclick="switchOneMemoryTab('analytics')" id="tab-analytics"> Analytics</button>
                    </div>
                </div>
                <div style="flex: 1; overflow: hidden; padding: 15px; display: flex; flex-direction: column;">
                    <!-- Graph View Tab -->
                    <div id="onememory-graph" class="onememory-tab-content active" style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                        <div style="margin-bottom: 10px; flex-shrink: 0;">
                            <h3 style="margin: 0 0 5px 0; color: rgba(255, 255, 255, 0.9); font-size: 16px;">Memory Network Graph</h3>
                            <span style="color: rgba(255, 255, 255, 0.6); font-size: 11px;">Hover to see details  Double-click to open full memory</span>
                        </div>
                        <div id="memoryGraphContainer" style="flex: 1; width: 100%; min-height: 0; background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; position: relative; overflow: hidden;">
                            <!-- Graph will be rendered here by D3.js -->
                        </div>
                    </div>

                    <!-- Analytics Tab -->
                    <div id="onememory-analytics" class="onememory-tab-content" style="flex: 1; display: none; flex-direction: column; overflow-y: auto;">
                        <h3 style="margin-bottom: 20px; color: rgba(255, 255, 255, 0.9);">Memory Analytics Dashboard</h3>
                        <div id="memoryAnalyticsContainer">
                            <!-- Analytics will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Tooltip -->
        <div id="memoryTooltip" style="position: absolute; background: rgba(0, 0, 0, 0.95); border: 1px solid rgba(99, 102, 241, 0.5); border-radius: 8px; padding: 15px; max-width: 500px; max-height: 400px; overflow: auto; z-index: 10000; display: none; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); pointer-events: none;">
            <!-- Tooltip content will be populated by JavaScript -->
        </div>

        <!-- File Explorer Window -->
        <div class="window" id="fileExplorer">
            <div class="window-header" onmousedown="startDrag(event, 'fileExplorer')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('fileExplorer')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('fileExplorer')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('fileExplorer')"></div>
                </div>
                <div class="window-title">File Explorer</div>
            </div>
            <div class="window-content">
                <div class="explorer-toolbar">
                    <button class="explorer-btn" onclick="explorerGoBack()"></button>
                    <button class="explorer-btn" onclick="explorerGoForward()"></button>
                    <button class="explorer-btn" onclick="explorerGoUp()"></button>
                    <div class="explorer-path" id="explorerPath">C:\Users\YourName\Documents</div>
                </div>
                <div class="explorer-content">
                    <div class="file-list" id="fileList">
                        <!-- Files will be added dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery Window -->
        <div class="window" id="gallery">
            <div class="window-header" onmousedown="startDrag(event, 'gallery')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('gallery')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('gallery')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('gallery')"></div>
                </div>
                <div class="window-title">Gallery</div>
            </div>
            <div class="window-content">
                <div class="gallery-toolbar">
                    <span style="font-size: 14px; color: rgba(255,255,255,0.8);">My Photos</span>
                </div>
                <div class="gallery-content" id="galleryContent">
                    <!-- Gallery items will be added dynamically -->
                </div>
            </div>
        </div>

        <!-- Calculator Window -->
        <div class="window" id="calculator">
            <div class="window-header" onmousedown="startDrag(event, 'calculator')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('calculator')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('calculator')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('calculator')"></div>
                </div>
                <div class="window-title">Calculator</div>
            </div>
            <div class="window-content">
                <div class="calculator-display" id="calcDisplay">0</div>
                <div class="calculator-buttons">
                    <button class="calc-btn" onclick="calcInput('C')">C</button>
                    <button class="calc-btn" onclick="calcInput('CE')">CE</button>
                    <button class="calc-btn operator" onclick="calcInput('%')">%</button>
                    <button class="calc-btn operator" onclick="calcInput('/')"></button>
                    <button class="calc-btn" onclick="calcInput('7')">7</button>
                    <button class="calc-btn" onclick="calcInput('8')">8</button>
                    <button class="calc-btn" onclick="calcInput('9')">9</button>
                    <button class="calc-btn operator" onclick="calcInput('*')"></button>
                    <button class="calc-btn" onclick="calcInput('4')">4</button>
                    <button class="calc-btn" onclick="calcInput('5')">5</button>
                    <button class="calc-btn" onclick="calcInput('6')">6</button>
                    <button class="calc-btn operator" onclick="calcInput('-')"></button>
                    <button class="calc-btn" onclick="calcInput('1')">1</button>
                    <button class="calc-btn" onclick="calcInput('2')">2</button>
                    <button class="calc-btn" onclick="calcInput('3')">3</button>
                    <button class="calc-btn operator" onclick="calcInput('+')">+</button>
                    <button class="calc-btn" onclick="calcInput('')"></button>
                    <button class="calc-btn" onclick="calcInput('0')">0</button>
                    <button class="calc-btn" onclick="calcInput('.')">.</button>
                    <button class="calc-btn equals" onclick="calcInput('=')">=</button>
                </div>
            </div>
        </div>

        <!-- Settings Window -->
        <div class="window" id="settings">
            <div class="window-header" onmousedown="startDrag(event, 'settings')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('settings')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('settings')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('settings')"></div>
                </div>
                <div class="window-title">Settings</div>
            </div>
            <div class="window-content">
                <div class="settings-content">
                    <div class="settings-section">
                        <div class="settings-title">System</div>
                        <div class="settings-item">
                            <div class="settings-label">Dark Mode</div>
                            <div class="toggle-switch active" onclick="toggleSetting(this, 'darkMode')"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">Notifications</div>
                            <div class="toggle-switch active" onclick="toggleSetting(this, 'notifications')"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">Auto Updates</div>
                            <div class="toggle-switch" onclick="toggleSetting(this, 'autoUpdates')"></div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-title">Appearance</div>
                        <div class="settings-item">
                            <div class="settings-label">Wallpaper</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.6);">Default</div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">Theme Color</div>
                            <div style="font-size: 12px; color: rgba(255,255,255,0.6);">Purple</div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <div class="settings-title">Privacy</div>
                        <div class="settings-item">
                            <div class="settings-label">Location Services</div>
                            <div class="toggle-switch" onclick="toggleSetting(this, 'location')"></div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">Analytics</div>
                            <div class="toggle-switch active" onclick="toggleSetting(this, 'analytics')"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Music Player Window -->
        <div class="window" id="musicPlayer">
            <div class="window-header" onmousedown="startDrag(event, 'musicPlayer')">
                <div class="window-controls">
                    <div class="window-control window-close" onclick="closeApp('musicPlayer')"></div>
                    <div class="window-control window-minimize" onclick="minimizeApp('musicPlayer')"></div>
                    <div class="window-control window-maximize" onclick="maximizeApp('musicPlayer')"></div>
                </div>
                <div class="window-title">Music Player</div>
            </div>
            <div class="window-content">
                <div class="music-player-content">
                    <div class="music-album-art"></div>
                    <div class="music-info">
                        <div class="music-title" id="musicTitle">Relaxing Beats</div>
                        <div class="music-artist" id="musicArtist">Chill Vibes</div>
                    </div>
                    <div class="music-controls">
                        <button class="music-btn" onclick="musicPrevious()"></button>
                        <button class="music-btn play" onclick="musicToggle()" id="musicPlayBtn"></button>
                        <button class="music-btn" onclick="musicNext()"></button>
                    </div>
                    <div class="music-progress" onclick="musicSeek(event)">
                        <div class="music-progress-bar" id="musicProgress"></div>
                    </div>
                    <div class="music-time">
                        <span id="musicCurrentTime">1:23</span>
                        <span id="musicTotalTime">3:45</span>
                    </div>
                    <div class="music-playlist" id="musicPlaylist">
                        <!-- Playlist will be added dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Boss Message Window -->
        <div class="message-window" id="messageWindow">
            <div class="message-header">
                <div class="message-avatar"></div>
                <div class="message-sender-info">
                    <div class="message-sender-name">Sarah Mitchell</div>
                    <div class="message-sender-role">Boss  Mobile</div>
                </div>
                <button class="message-close" onclick="closeMessageWindow()"></button>
            </div>
            <div class="message-content" id="messageContent">
                <!-- Messages will be added dynamically -->
            </div>
            <div class="message-actions">
                <button class="ask-agent-btn" id="askAgentBtn" onclick="askAgentToReply()">
                     Ask Agent to Reply
                </button>
                <button class="reply-btn" id="replyBtn" onclick="showReplyInput()">
                     Reply
                </button>
            </div>
            <div class="message-input-area" id="messageInputArea">
                <div class="message-input-wrapper">
                    <input type="text" class="message-input" id="messageInput" placeholder="Type your reply..." onkeypress="handleMessageInput(event)">
                    <button class="message-send-btn" onclick="sendUserReply()">Send</button>
                </div>
            </div>
        </div>

        <!-- Voice Playback Window -->
        <div class="voice-playback" id="voicePlayback">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                <div style="font-size: 13px; font-weight: 500;"> Live Transcript</div>
                <button class="voice-btn" onclick="if(window.toggleVoicePlayback) window.toggleVoicePlayback()" id="voicePlayBtn" title="Play audio"></button>
            </div>
            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-bottom: 10px;" id="voiceStatus">Transcribing in real-time...</div>
            <div style="font-size: 11px; color: rgba(255,255,255,0.7); max-height: 100px; overflow-y: auto;" id="voiceCurrentText">
                <!-- Live transcript will appear here -->
            </div>
        </div>


        <!-- AI Chat Sidebar -->
        <div class="ai-chat" id="aiChat">
            <div class="ai-chat-header">
                <div>
                    <div class="ai-chat-title">oneOS Assistant</div>
                <div class="ai-chat-subtitle">Intelligent agent at your service</div>
                </div>
                <button class="ai-speak-toggle" id="aiSpeakToggle" onclick="toggleAISpeak()" title="Toggle speech">
                    <span class="speak-icon"></span>
                </button>
            </div>
            <div class="ai-messages" id="aiMessages">
                <!-- Messages will be added dynamically -->
            </div>
            <div class="ai-input-area">
                <input type="text" class="ai-input" id="aiInput" placeholder="Ask me anything..." onkeypress="handleAIInput(event)" onkeydown="if(event.key==='Enter') { event.preventDefault(); sendOneAgentMessage(); }">
                <button class="ai-send" onclick="sendOneAgentMessage(); return false;"></button>
            </div>
        </div>

        <!-- App Menu -->
        <div class="app-menu" id="appMenu" onclick="event.stopPropagation()">
            <div class="app-menu-header">All Applications</div>
            <input type="text" class="app-menu-search" id="appMenuSearch" placeholder="Search applications..." oninput="filterAppMenu()">
            <div class="app-menu-grid" id="appMenuGrid">
                <!-- Apps will be populated by JavaScript -->
            </div>
        </div>

        <!-- Taskbar -->
        <div class="taskbar">
            <div class="start-button" onclick="toggleStartMenu(event)">
                
                <div class="start-menu" id="startMenu" onclick="event.stopPropagation()">
                    <div class="start-menu-item" onclick="openProfile(); event.stopPropagation();">
                        <span></span>
                        <span>Profile</span>
                    </div>
                    <div class="start-menu-item" onclick="openSettingsFromMenu(); event.stopPropagation();">
                        <span></span>
                        <span>Settings</span>
                    </div>
                    <div class="start-menu-divider"></div>
                    <div class="start-menu-item logout" onclick="logout(); event.stopPropagation();">
                        <span></span>
                        <span>Logout</span>
                    </div>
                </div>
            </div>
            <div class="taskbar-menu-button" onclick="toggleAppMenu(event)" title="Applications Menu">
                
            </div>
            <div class="taskbar-apps">
                <div class="taskbar-app" id="taskbar-notepad" onclick="focusApp('notepad')"></div>
                <div class="taskbar-app" id="taskbar-browser" onclick="focusApp('browser')" style="display: none;"></div>
                <div class="taskbar-app" id="taskbar-calendar" onclick="focusApp('calendar')" style="display: none;" title="Calendar"></div>
                <div class="taskbar-app" id="taskbar-fileExplorer" onclick="focusApp('fileExplorer')" style="display: none;"></div>
                <div class="taskbar-app" id="taskbar-gallery" onclick="focusApp('gallery')" style="display: none;"></div>
                <div class="taskbar-app" id="taskbar-calculator" onclick="focusApp('calculator')" style="display: none;" title="Calculator"></div>
                <div class="taskbar-app" id="taskbar-settings" onclick="focusApp('settings')" style="display: none;"></div>
                <div class="taskbar-app" id="taskbar-musicPlayer" onclick="focusApp('musicPlayer')" style="display: none;" title="Music"></div>
                <div class="taskbar-app" id="taskbar-vscode" onclick="focusApp('vscode')" style="display: none;" title="VS Code"></div>
                <div class="taskbar-app" id="taskbar-oneAgent" onclick="focusApp('oneAgent')" style="display: none;" title="One Agent"></div>
                <div class="taskbar-app" id="taskbar-oneData" onclick="focusApp('oneData')" style="display: none;" title="oneData"></div>
                <div class="taskbar-app" id="taskbar-oneVoice" onclick="focusApp('oneVoice')" style="display: none;" title="One Voice"></div>
                <div class="taskbar-app" id="taskbar-oneMemory" onclick="focusApp('oneMemory')" style="display: none;" title="oneMemory"></div>
                <div class="taskbar-app" id="taskbar-todo" onclick="focusApp('todo')" style="display: none;" title="Todo"></div>
                <div class="taskbar-app" id="taskbar-stickynotes" onclick="focusApp('stickynotes')" style="display: none;" title="Sticky Notes"></div>
                <div class="taskbar-app" id="taskbar-reminders" onclick="focusApp('reminders')" style="display: none;" title="Reminders"></div>
                <div class="taskbar-app" id="taskbar-notes" onclick="focusApp('notes')" style="display: none;" title="Notes"></div>
                <div class="taskbar-app" id="taskbar-weather" onclick="focusApp('weather')" style="display: none;" title="Weather"></div>
                <div class="taskbar-app" id="taskbar-clock" onclick="focusApp('clock')" style="display: none;" title="Clock"></div>
            </div>
            <div class="system-tray">
                <div class="agent-status-bar" id="agentStatusBar">
                    <div class="agent-status-item">
                        <div class="agent-status-dot working"></div>
                        <span id="workingCount">0</span>
                    </div>
                    <div class="agent-status-item">
                        <div class="agent-status-dot idle"></div>
                        <span id="idleCount">0</span>
                    </div>
                    <div class="agent-status-item">
                        <div class="agent-status-dot disconnected"></div>
                        <span id="disconnectedCount">0</span>
                    </div>
                </div>
                <div class="weather-indicator" id="weatherIndicator">
                    <span id="weatherIcon"></span>
                    <span class="weather-temp" id="weatherTemp">72F</span>
                </div>
                <div class="system-icon" id="wifiIcon" onclick="toggleWiFi()" title="WiFi">
                    
                </div>
                <div class="system-icon active" id="bluetoothIcon" onclick="toggleBluetooth()" title="Bluetooth">
                    
                </div>
                <div class="ai-status" onclick="toggleAIChat()">
                    <div class="ai-dot"></div>
                    <span>AI Agent</span>
                </div>
                <div class="time" id="systemTime">
                    <div id="systemTimeDisplay">12:34 PM</div>
                    <div class="time-date" id="systemDate">Mon, Jan 1</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // System Time and Date
        function updateTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit', 
                hour12: true 
            });
            const date = now.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
            document.getElementById('systemTimeDisplay').textContent = time;
            document.getElementById('systemDate').textContent = date;
        }
        setInterval(updateTime, 1000);
        updateTime();

        // WiFi and Bluetooth Toggle
        let wifiConnected = true;
        let bluetoothConnected = true;

        function toggleWiFi() {
            wifiConnected = !wifiConnected;
            const wifiIcon = document.getElementById('wifiIcon');
            if (wifiConnected) {
                wifiIcon.classList.add('active');
                wifiIcon.classList.remove('inactive');
                wifiIcon.textContent = '';
            } else {
                wifiIcon.classList.remove('active');
                wifiIcon.classList.add('inactive');
                wifiIcon.textContent = '';
            }
        }

        function toggleBluetooth() {
            bluetoothConnected = !bluetoothConnected;
            const bluetoothIcon = document.getElementById('bluetoothIcon');
            if (bluetoothConnected) {
                bluetoothIcon.classList.add('active');
                bluetoothIcon.classList.remove('inactive');
                bluetoothIcon.textContent = '';
            } else {
                bluetoothIcon.classList.remove('active');
                bluetoothIcon.classList.add('inactive');
                bluetoothIcon.textContent = '';
            }
        }

        // Weather Update
        function updateWeather() {
            // Simulate weather data (in real app, this would come from an API)
            const weatherData = {
                icon: '',
                temp: '72F',
                condition: 'Partly Cloudy'
            };
            
            // Randomly update weather occasionally
            if (Math.random() > 0.7) {
                const icons = ['', '', '', '', '', ''];
                const temps = ['68F', '70F', '72F', '74F', '76F', '78F'];
                weatherData.icon = icons[Math.floor(Math.random() * icons.length)];
                weatherData.temp = temps[Math.floor(Math.random() * temps.length)];
            }
            
            document.getElementById('weatherIcon').textContent = weatherData.icon;
            document.getElementById('weatherTemp').textContent = weatherData.temp;
        }
        setInterval(updateWeather, 30000); // Update every 30 seconds
        updateWeather();

        // Agent Status Update
        function updateAgentStatus() {
            if (typeof agents === 'undefined') {
                // Agents not loaded yet
                return;
            }
            
            let working = 0;
            let idle = 0;
            let disconnected = 0;
            
            agents.forEach(agent => {
                if (agent.status === 'online' || agent.status === 'charging' || agent.status === 'active') {
                    working++;
                } else if (agent.status === 'idle' || agent.status === 'sleeping' || agent.status === 'standby') {
                    idle++;
                } else if (agent.status === 'offline' || agent.status === 'disconnected' || agent.status === 'error') {
                    disconnected++;
                } else {
                    // Default to working for unknown statuses
                    working++;
                }
            });
            
            document.getElementById('workingCount').textContent = working;
            document.getElementById('idleCount').textContent = idle;
            document.getElementById('disconnectedCount').textContent = disconnected;
        }
        
        // Update agent status every 5 seconds
        setInterval(updateAgentStatus, 5000);
        
        // Initialize agent status on load
        setTimeout(updateAgentStatus, 1000);

        // Fix taskbar icons on load
        function fixTaskbarIcons() {
            const iconMap = {
                'taskbar-notepad': '',
                'taskbar-browser': '',
                'taskbar-fileExplorer': '',
                'taskbar-gallery': '',
                'taskbar-settings': ''
            };
            
            Object.keys(iconMap).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = iconMap[id];
                    if (!element.getAttribute('title')) {
                        const title = id.replace('taskbar-', '').replace(/([A-Z])/g, ' $1').trim();
                        element.setAttribute('title', title.charAt(0).toUpperCase() + title.slice(1));
                    }
                }
            });
        }
        
        // Fix icons when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', fixTaskbarIcons);
        } else {
            fixTaskbarIcons();
        }

        // Window Management
        let activeWindow = null;
        let zIndex = 1000;
        let draggedWindow = null;
        let dragOffset = { x: 0, y: 0 };

        function openApp(appId) {
            const window = document.getElementById(appId);
            window.classList.add('active');
            window.style.zIndex = ++zIndex;
            
            // Show in taskbar
            const taskbarIcon = document.getElementById(`taskbar-${appId}`);
            if (taskbarIcon) {
                taskbarIcon.style.display = 'flex';
                taskbarIcon.classList.add('active');
            }
            
            activeWindow = appId;
            updateTaskbar();
            
            // Update agent status when One Agent is opened
            if (appId === 'oneAgent') {
                setTimeout(updateAgentStatus, 500);
                // Show conversation summary if conversation is complete
                if (window.conversationComplete) {
                    setTimeout(() => {
                        showConversationSummaryPanel();
                    }, 500);
                }
            }
            
            // Fix browser buttons when browser opens
            if (appId === 'browser') {
                setTimeout(fixBrowserButtons, 100);
                // Load DuckDuckGo by default when browser opens (Google blocks iframes)
                setTimeout(() => {
                    if (!document.getElementById('browserUrl').value) {
                        navigateToUrl('https://duckduckgo.com');
                    }
                }, 200);
            }
            
            // Initialize oneData when opened
            if (appId === 'oneData') {
                setTimeout(() => {
                    renderCloudCards();
                    renderFileBrowser();
                }, 200);
            }
            
            // Initialize oneMemory when opened
            if (appId === 'oneMemory') {
                setTimeout(() => {
                    if (typeof initOneMemory === 'function') {
                        initOneMemory();
                    }
                }, 200);
            }
            
            // Initialize default apps when opened
            if (appId === 'todo') {
                setTimeout(() => {
                    renderTodos();
                }, 100);
            } else if (appId === 'stickynotes') {
                // Sticky notes are rendered on desktop, not in window
                setTimeout(() => {
                    renderStickyNotes();
                }, 100);
            } else if (appId === 'reminders') {
                setTimeout(() => {
                    renderReminders();
                }, 100);
            } else if (appId === 'notes') {
                setTimeout(() => {
                    renderNotesList();
                }, 100);
            } else if (appId === 'weather') {
                setTimeout(() => {
                    getWeather();
                }, 100);
            } else if (appId === 'clock') {
                setTimeout(() => {
                    updateClock();
                    if (!clockInterval) {
                        clockInterval = setInterval(updateClock, 1000);
                    }
                    renderAlarms();
                }, 100);
            }
        }

        // Store window states for restore
        const windowStates = {};

        function closeApp(appId) {
            const window = document.getElementById(appId);
            
            // Add closing animation
            window.classList.add('closing');
            
            // Hide from taskbar
            const taskbarIcon = document.getElementById(`taskbar-${appId}`);
            if (taskbarIcon) {
                taskbarIcon.style.display = 'none';
                taskbarIcon.classList.remove('active');
            }
            
            // Remove active class and clean up after animation
            setTimeout(() => {
                window.classList.remove('active', 'closing', 'maximized', 'minimized');
                window.style.transform = '';
                window.style.opacity = '';
                
                // Clear stored state
                delete windowStates[appId];
            }, 300);
        }

        function minimizeApp(appId) {
            const window = document.getElementById(appId);
            
            // Store current state if not already minimized
            if (!window.classList.contains('minimized')) {
                const rect = window.getBoundingClientRect();
                windowStates[appId] = {
                    top: window.style.top || rect.top + 'px',
                    left: window.style.left || rect.left + 'px',
                    width: window.style.width || rect.width + 'px',
                    height: window.style.height || rect.height + 'px',
                    zIndex: window.style.zIndex || windowStates[appId]?.zIndex || zIndex
                };
            }
            
            // Add minimizing animation
            window.classList.add('minimizing', 'minimized');
            
            // Update taskbar icon to show minimized state (keep it visible)
            const taskbarIcon = document.getElementById(`taskbar-${appId}`);
            if (taskbarIcon) {
                taskbarIcon.classList.add('minimized');
                taskbarIcon.classList.remove('active');
                taskbarIcon.style.display = 'flex'; // Keep visible in taskbar
            }
            
            // Hide window after animation
            setTimeout(() => {
                window.classList.remove('active');
                window.classList.remove('minimizing');
            }, 300);
        }

        function maximizeApp(appId) {
            const window = document.getElementById(appId);
            
            if (window.classList.contains('maximized')) {
                // Restore window
                restoreApp(appId);
            } else {
                // Store current state before maximizing
                const rect = window.getBoundingClientRect();
                windowStates[appId] = {
                    top: window.style.top || rect.top + 'px',
                    left: window.style.left || rect.left + 'px',
                    width: window.style.width || rect.width + 'px',
                    height: window.style.height || rect.height + 'px',
                    zIndex: window.style.zIndex || zIndex
                };
                
                // Maximize window
                window.classList.add('maximized', 'restoring');
                window.style.zIndex = ++zIndex;
                
                // Ensure window is active
                window.classList.add('active');
                
                // Update taskbar
                const taskbarIcon = document.getElementById(`taskbar-${appId}`);
                if (taskbarIcon) {
                    taskbarIcon.classList.add('active');
                    taskbarIcon.classList.remove('minimized');
                }
                
                activeWindow = appId;
                updateTaskbar();
                
                // Remove restoring class after animation
                setTimeout(() => {
                    window.classList.remove('restoring');
                }, 300);
            }
        }

        function restoreApp(appId) {
            const window = document.getElementById(appId);
            const state = windowStates[appId];
            
            if (state) {
                window.classList.add('restoring');
                window.classList.remove('maximized');
                
                // Restore original position and size
                window.style.top = state.top;
                window.style.left = state.left;
                window.style.width = state.width;
                window.style.height = state.height;
                window.style.zIndex = state.zIndex || ++zIndex;
                
                // Remove restoring class after animation
                setTimeout(() => {
                    window.classList.remove('restoring');
                }, 300);
            }
        }

        function restoreMinimizedApp(appId) {
            const window = document.getElementById(appId);
            const state = windowStates[appId];
            
            if (state && window.classList.contains('minimized')) {
                // Restore window
                window.classList.remove('minimized', 'minimizing');
                window.classList.add('active', 'restoring');
                
                // Restore original position and size
                if (state.top) window.style.top = state.top;
                if (state.left) window.style.left = state.left;
                if (state.width) window.style.width = state.width;
                if (state.height) window.style.height = state.height;
                window.style.zIndex = ++zIndex;
                
                // Update taskbar
                const taskbarIcon = document.getElementById(`taskbar-${appId}`);
                if (taskbarIcon) {
                    taskbarIcon.classList.remove('minimized');
                    taskbarIcon.classList.add('active');
                }
                
                activeWindow = appId;
                updateTaskbar();
                
                // Remove restoring class after animation
                setTimeout(() => {
                    window.classList.remove('restoring');
                }, 300);
            } else {
                // Just open if not minimized
                openApp(appId);
            }
        }

        function focusApp(appId) {
            // If app is minimized, restore it
            const window = document.getElementById(appId);
            if (window && window.classList.contains('minimized')) {
                restoreMinimizedApp(appId);
                return;
            }
            
            // If app is already open, just bring it to front
            if (window && window.classList.contains('active')) {
                window.style.zIndex = ++zIndex;
                activeWindow = appId;
                updateTaskbar();
                return;
            }
            
            // Otherwise open the app
            openApp(appId);
        }
        
        // Context menu for taskbar apps
        function showTaskbarContextMenu(event, appId) {
            event.preventDefault();
            event.stopPropagation();
            
            // Remove existing context menu
            const existingMenu = document.getElementById('taskbarContextMenu');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            const menu = document.createElement('div');
            menu.id = 'taskbarContextMenu';
            menu.style.cssText = `
                position: fixed;
                left: ${event.clientX}px;
                top: ${event.clientY}px;
                background: rgba(20, 20, 30, 0.95);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                padding: 8px;
                z-index: 10001;
                min-width: 150px;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            `;
            
            const window = document.getElementById(appId);
            const isMinimized = window && window.classList.contains('minimized');
            const isMaximized = window && window.classList.contains('maximized');
            
            menu.innerHTML = `
                <div onclick="focusApp('${appId}'); this.closest('#taskbarContextMenu').remove();" style="padding: 8px 12px; cursor: pointer; border-radius: 4px; color: #fff; font-size: 13px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">${isMinimized ? 'Restore' : 'Bring to Front'}</div>
                <div onclick="${isMaximized ? `restoreApp('${appId}')` : `maximizeApp('${appId}')`}; this.closest('#taskbarContextMenu').remove();" style="padding: 8px 12px; cursor: pointer; border-radius: 4px; color: #fff; font-size: 13px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">${isMaximized ? 'Restore' : 'Maximize'}</div>
                <div onclick="minimizeApp('${appId}'); this.closest('#taskbarContextMenu').remove();" style="padding: 8px 12px; cursor: pointer; border-radius: 4px; color: #fff; font-size: 13px; transition: background 0.2s; ${isMinimized ? 'display: none;' : ''}" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">Minimize</div>
                <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 4px 0;"></div>
                <div onclick="closeApp('${appId}'); this.closest('#taskbarContextMenu').remove();" style="padding: 8px 12px; cursor: pointer; border-radius: 4px; color: #ef4444; font-size: 13px; transition: background 0.2s;" onmouseover="this.style.background='rgba(239,68,68,0.2)'" onmouseout="this.style.background='transparent'">Close</div>
            `;
            
            document.body.appendChild(menu);
            
            // Close menu when clicking outside
            setTimeout(() => {
                const closeMenu = (e) => {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                };
                document.addEventListener('click', closeMenu, { once: true });
            }, 0);
        }

        function updateTaskbar() {
            document.querySelectorAll('.taskbar-app').forEach(icon => {
                icon.classList.remove('active');
            });
            const activeIcon = document.getElementById(`taskbar-${activeWindow}`);
            if (activeIcon) {
                activeIcon.classList.add('active');
            }
        }

        // Window Dragging
        function startDrag(e, windowId) {
            draggedWindow = document.getElementById(windowId);
            draggedWindow.style.zIndex = ++zIndex;
            
            const rect = draggedWindow.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }

        function drag(e) {
            if (!draggedWindow) return;
            
            draggedWindow.style.left = (e.clientX - dragOffset.x) + 'px';
            draggedWindow.style.top = (e.clientY - dragOffset.y) + 'px';
        }

        function stopDrag() {
            draggedWindow = null;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }

        // Window Resizing
        let resizingWindow = null;
        let resizeDirection = '';
        let resizeStartX = 0;
        let resizeStartY = 0;
        let resizeStartWidth = 0;
        let resizeStartHeight = 0;
        let resizeStartLeft = 0;
        let resizeStartTop = 0;

        function startResize(e, windowId, direction) {
            e.stopPropagation();
            resizingWindow = document.getElementById(windowId);
            resizingWindow.style.zIndex = ++zIndex;
            resizeDirection = direction;
            
            const rect = resizingWindow.getBoundingClientRect();
            resizeStartX = e.clientX;
            resizeStartY = e.clientY;
            resizeStartWidth = rect.width;
            resizeStartHeight = rect.height;
            resizeStartLeft = rect.left;
            resizeStartTop = rect.top;
            
            document.addEventListener('mousemove', doResize);
            document.addEventListener('mouseup', stopResize);
        }

        function doResize(e) {
            if (!resizingWindow) return;
            
            const deltaX = e.clientX - resizeStartX;
            const deltaY = e.clientY - resizeStartY;
            
            let newWidth = resizeStartWidth;
            let newHeight = resizeStartHeight;
            let newLeft = resizeStartLeft;
            let newTop = resizeStartTop;
            
            if (resizeDirection.includes('e')) {
                newWidth = Math.max(300, resizeStartWidth + deltaX);
            }
            if (resizeDirection.includes('w')) {
                newWidth = Math.max(300, resizeStartWidth - deltaX);
                newLeft = resizeStartLeft + deltaX;
            }
            if (resizeDirection.includes('s')) {
                newHeight = Math.max(200, resizeStartHeight + deltaY);
            }
            if (resizeDirection.includes('n')) {
                newHeight = Math.max(200, resizeStartHeight - deltaY);
                newTop = resizeStartTop + deltaY;
            }
            
            resizingWindow.style.width = newWidth + 'px';
            resizingWindow.style.height = newHeight + 'px';
            if (resizeDirection.includes('w')) {
                resizingWindow.style.left = newLeft + 'px';
            }
            if (resizeDirection.includes('n')) {
                resizingWindow.style.top = newTop + 'px';
            }
            
            // Reinitialize One Agent graph if it's the One Agent window
            if (resizingWindow.id === 'oneAgent') {
                const graphContainer = document.getElementById('oneAgentGraph');
                if (graphContainer) {
                    setTimeout(() => {
                        if (typeof window.initOneAgent === 'function') {
                            // Clear existing graph
                            d3.select('#oneAgentGraph svg').remove();
                            // Reinitialize
                            window.initOneAgent();
                        }
                    }, 100);
                }
            }
        }

        function stopResize() {
            resizingWindow = null;
            resizeDirection = '';
            document.removeEventListener('mousemove', doResize);
            document.removeEventListener('mouseup', stopResize);
        }

        // Add resize handles to all windows
        function addResizeHandles(windowId) {
            const window = document.getElementById(windowId);
            if (!window || window.querySelector('.window-resize-handle')) return;
            
            const handles = ['nw', 'ne', 'sw', 'se', 'n', 's', 'w', 'e'];
            handles.forEach(direction => {
                const handle = document.createElement('div');
                handle.className = `window-resize-handle ${direction}`;
                handle.onmousedown = (e) => startResize(e, windowId, direction);
                window.appendChild(handle);
            });
        }

        // Boot and Login System
        let bootMessages = [
            { id: 'bootMessage1', text: 'Initializing system...', delay: 0 },
            { id: 'bootMessage2', text: 'Loading kernel modules...', delay: 2000 },
            { id: 'bootMessage3', text: 'Connecting to network...', delay: 4000 },
            { id: 'bootMessage4', text: 'Creating environment...', delay: 6000 },
            { id: 'bootMessage5', text: 'Setting up ubuntu...', delay: 8000 },
            { id: 'bootMessage6', text: 'Starting services...', delay: 10000 }
        ];

        function showBootMessage(index) {
            if (index < bootMessages.length) {
                const msg = bootMessages[index];
                setTimeout(() => {
                    const element = document.getElementById(msg.id);
                    if (element) {
                        element.style.opacity = '1';
                        element.style.animation = 'fadeIn 0.5s forwards';
                    }
                    if (index < bootMessages.length - 1) {
                        showBootMessage(index + 1);
                    }
                }, msg.delay);
            }
        }

        function startBootSequence() {
            showBootMessage(0);
            setTimeout(() => {
                document.getElementById('bootScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                updateLoginTime();
                setInterval(updateLoginTime, 1000);
            }, 12000); // Updated to 12s to account for 6 messages
        }

        function updateLoginTime() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit', 
                hour12: true 
            });
            const date = now.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
            document.getElementById('loginTime').textContent = time;
            document.getElementById('loginDate').textContent = date;
        }

        // Start Menu Functions
        // App Menu Functions
        const allApps = [
            { id: 'calculator', name: 'Calculator', icon: '', category: 'Utilities' },
            { id: 'calendar', name: 'Calendar', icon: '', category: 'Productivity' },
            { id: 'fileExplorer', name: 'Files', icon: '', category: 'System' },
            { id: 'gallery', name: 'Gallery', icon: '', category: 'Media' },
            { id: 'musicPlayer', name: 'Music', icon: '', category: 'Media' },
            { id: 'oneAgent', name: 'One Agent', icon: '', category: 'One Ecosystem' },
            { id: 'oneData', name: 'oneData', icon: '', category: 'One Ecosystem' },
            { id: 'browser', name: 'oneBrowser', icon: '', category: 'One Ecosystem' },
            { id: 'notepad', name: 'onePad', icon: '', category: 'One Ecosystem' },
            { id: 'oneVoice', name: 'One Voice', icon: '', category: 'One Ecosystem' },
            { id: 'oneMemory', name: 'oneMemory', icon: '', category: 'One Ecosystem' },
            { id: 'todo', name: 'Todo', icon: '', category: 'One Ecosystem' },
            { id: 'stickynotes', name: 'Sticky Notes', icon: '', category: 'One Ecosystem' },
            { id: 'reminders', name: 'Reminders', icon: '', category: 'One Ecosystem' },
            { id: 'notes', name: 'Notes', icon: '', category: 'One Ecosystem' },
            { id: 'weather', name: 'Weather', icon: '', category: 'One Ecosystem' },
            { id: 'clock', name: 'Clock', icon: '', category: 'One Ecosystem' },
            { id: 'settings', name: 'Settings', icon: '', category: 'System' },
            { id: 'vscode', name: 'VS Code', icon: '', category: 'Development' },
            { id: 'trash', name: 'Trash', icon: '', category: 'System' }
        ];

        function toggleAppMenu(event) {
            event.stopPropagation();
            const menu = document.getElementById('appMenu');
            menu.classList.toggle('active');
            
            if (menu.classList.contains('active')) {
                renderAppMenu();
                // Close menu when clicking outside
                setTimeout(() => {
                    const closeMenu = (e) => {
                        if (!menu.contains(e.target) && !e.target.closest('.taskbar-menu-button')) {
                            menu.classList.remove('active');
                            document.removeEventListener('click', closeMenu);
                        }
                    };
                    document.addEventListener('click', closeMenu, { once: true });
                }, 0);
            }
        }

        function renderAppMenu() {
            const grid = document.getElementById('appMenuGrid');
            grid.innerHTML = '';
            
            allApps.forEach(app => {
                const item = document.createElement('div');
                item.className = 'app-menu-item';
                item.onclick = () => {
                    if (app.id === 'trash') {
                        openTrash();
                    } else {
                        openApp(app.id);
                    }
                    document.getElementById('appMenu').classList.remove('active');
                };
                item.innerHTML = `
                    <div class="app-menu-item-icon">${app.icon}</div>
                    <div class="app-menu-item-label">${app.name}</div>
                `;
                grid.appendChild(item);
            });
        }

        function filterAppMenu() {
            const search = document.getElementById('appMenuSearch').value.toLowerCase();
            const items = document.querySelectorAll('.app-menu-item');
            
            items.forEach(item => {
                const label = item.querySelector('.app-menu-item-label').textContent.toLowerCase();
                if (label.includes(search)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function openTrash() {
            const trashWindow = document.getElementById('trash');
            if (!trashWindow) {
                // Create trash window if it doesn't exist
                const window = document.createElement('div');
                window.className = 'window';
                window.id = 'trash';
                window.style.width = '600px';
                window.style.height = '500px';
                window.style.top = '50px';
                window.style.left = '100px';
                window.innerHTML = `
                    <div class="window-header" onmousedown="startDrag(event, 'trash')">
                        <div class="window-controls">
                            <div class="window-control window-close" onclick="closeApp('trash')"></div>
                            <div class="window-control window-minimize" onclick="minimizeApp('trash')"></div>
                            <div class="window-control window-maximize" onclick="maximizeApp('trash')"></div>
                        </div>
                        <div class="window-title">Trash</div>
                    </div>
                    <div class="window-content" style="padding: 20px; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                        <div style="font-size: 64px; margin-bottom: 20px;"></div>
                        <div style="font-size: 18px; color: rgba(255, 255, 255, 0.9); margin-bottom: 10px;">Trash is empty</div>
                        <div style="font-size: 14px; color: rgba(255, 255, 255, 0.6);">Deleted items will appear here</div>
                    </div>
                `;
                document.body.appendChild(window);
                addResizeHandles('trash');
            }
            
            openApp('trash');
        }

        function toggleStartMenu(event) {
            event.stopPropagation();
            const menu = document.getElementById('startMenu');
            const isActive = menu.classList.contains('active');
            
            // Close menu if clicking outside
            if (!isActive) {
                menu.classList.add('active');
                // Close menu when clicking outside
                setTimeout(() => {
                    document.addEventListener('click', function closeMenu(e) {
                        if (!menu.contains(e.target) && !e.target.closest('.start-button')) {
                            menu.classList.remove('active');
                            document.removeEventListener('click', closeMenu);
                        }
                    }, { once: true });
                }, 0);
            } else {
                menu.classList.remove('active');
            }
        }

        function openProfile() {
            // Close menu
            document.getElementById('startMenu').classList.remove('active');
            
            // For now, show an alert. You can create a profile window later
            alert('Profile feature coming soon!');
            // TODO: Create profile window/app
        }

        function openSettingsFromMenu() {
            // Close menu
            document.getElementById('startMenu').classList.remove('active');
            
            // Open settings app
            openApp('settings');
        }

        function logout() {
            // Close menu
            document.getElementById('startMenu').classList.remove('active');
            
            // Hide desktop and all windows with transition
            const desktop = document.querySelector('.desktop');
            const windows = document.querySelectorAll('.window');
            const taskbar = document.querySelector('.taskbar');
            const topBar = document.querySelector('.top-bar');
            const aiChatbot = document.getElementById('aiChatbot');
            const aiChat = document.getElementById('aiChat');
            
            // Add transition for smooth fade out
            if (desktop) {
                desktop.style.transition = 'opacity 0.5s ease-out';
                desktop.style.opacity = '0';
            }
            if (taskbar) {
                taskbar.style.transition = 'opacity 0.5s ease-out';
                taskbar.style.opacity = '0';
            }
            if (topBar) {
                topBar.style.transition = 'opacity 0.5s ease-out';
                topBar.style.opacity = '0';
            }
            if (aiChatbot) {
                aiChatbot.style.transition = 'opacity 0.5s ease-out';
                aiChatbot.style.opacity = '0';
            }
            if (aiChat) {
                aiChat.style.transition = 'opacity 0.5s ease-out';
                aiChat.style.opacity = '0';
            }
            windows.forEach(win => {
                win.style.transition = 'opacity 0.5s ease-out';
                win.style.opacity = '0';
            });
            
            // Show shutdown screen after a brief delay
            setTimeout(() => {
                const shutdownScreen = document.getElementById('shutdownScreen');
                shutdownScreen.classList.add('active');
                
                // After shutdown animation completes (3.5 seconds), show blank screen
                setTimeout(() => {
                    shutdownScreen.classList.remove('active');
                    const blankScreen = document.getElementById('blankScreen');
                    blankScreen.classList.add('active');
                }, 3500);
            }, 500);
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const usernameInput = document.getElementById('loginUsername');
            const passwordInput = document.getElementById('loginPassword');

            if (username === 'kasyap' && password === '1234') {
                // Successful login
                errorDiv.classList.remove('show');
                usernameInput.classList.remove('error');
                passwordInput.classList.remove('error');
                
                // Hide login form
                document.getElementById('loginForm').style.opacity = '0';
                document.getElementById('loginForm').style.transform = 'translateY(-20px)';
                document.getElementById('loginForm').style.transition = 'all 0.4s ease';
                
                // Show welcome animation
                setTimeout(() => {
                    const welcomeAnim = document.getElementById('welcomeAnimation');
                    welcomeAnim.classList.remove('hidden');
                    welcomeAnim.classList.add('show');
                }, 300);
                
                // After welcome animation, transition to desktop
                setTimeout(() => {
                    // Fade out login screen
                    document.getElementById('loginScreen').style.opacity = '0';
                    document.getElementById('loginScreen').style.transition = 'opacity 0.5s';
                    
                    setTimeout(() => {
                        document.getElementById('loginScreen').classList.add('hidden');
                        document.getElementById('desktop').classList.add('active');
                        // Start desktop time updates
                        if (typeof updateTime === 'function') {
                            updateTime();
                        }
                    }, 500);
                }, 2000); // Show welcome for 2 seconds
            } else {
                // Failed login
                errorDiv.classList.add('show');
                usernameInput.classList.add('error');
                passwordInput.classList.add('error');
                
                // Shake animation
                setTimeout(() => {
                    usernameInput.classList.remove('error');
                    passwordInput.classList.remove('error');
                }, 500);
                
                // Clear password
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // Initialize on startup
        window.addEventListener('load', () => {
            // Start boot sequence
            startBootSequence();
            
            // Add resize handles to all windows
            document.querySelectorAll('.window').forEach(window => {
                addResizeHandles(window.id);
            });
        });

        // Typing Animation
        let typingInterval;
        let currentText = '';
        const additionalText = '\n\nNotes for today:\n- Finish quarterly report\n- Review team proposals\n- ';

        function startTyping() {
            const notepad = document.getElementById('notepadContent');
            currentText = notepad.value;
            let index = 0;
            
            typingInterval = setInterval(() => {
                if (index < additionalText.length) {
                    notepad.value = currentText + additionalText.substring(0, index + 1);
                    index++;
                } else {
                    clearInterval(typingInterval);
                    // Trigger boss message after typing
                    setTimeout(showBossMessage, 1500);
                }
            }, 50);
        }

        // Message management is now in messages.js


        // AI Chat
        // Track if conversation is complete
        window.conversationComplete = false;
        // Track if s1 button has been clicked
        window.s1Clicked = false;
        // Track if speech is enabled
        window.aiSpeakEnabled = false;
        window.speechSynthesis = window.speechSynthesis || null;
        window.currentUtterance = null;

        // Toggle AI speech
        function toggleAISpeak() {
            const toggle = document.getElementById('aiSpeakToggle');
            window.aiSpeakEnabled = !window.aiSpeakEnabled;
            
            if (window.aiSpeakEnabled) {
                toggle.classList.add('active');
                toggle.querySelector('.speak-icon').textContent = '';
                // Read all current messages
                readAllMessages();
            } else {
                toggle.classList.remove('active');
                toggle.querySelector('.speak-icon').textContent = '';
                // Stop any ongoing speech
                if (window.speechSynthesis && window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }
            }
        }

        // Speak text using Web Speech API
        function speakText(text) {
            if (!window.speechSynthesis) {
                console.warn('Speech synthesis not supported');
                return;
            }
            
            // Cancel any ongoing speech
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
            
            // Clean text (remove emojis and special characters for better speech)
            const cleanText = text.replace(/[^\w\s.,!?;:()\-']/g, ' ').replace(/\s+/g, ' ').trim();
            
            if (cleanText) {
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;
                utterance.lang = 'en-US';
                
                // Use a more natural voice if available
                const voices = window.speechSynthesis.getVoices();
                const preferredVoice = voices.find(voice => 
                    voice.name.includes('Google') || 
                    voice.name.includes('Samantha') || 
                    voice.name.includes('Alex') ||
                    (voice.lang.startsWith('en') && voice.localService === false)
                );
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }
                
                window.currentUtterance = utterance;
                window.speechSynthesis.speak(utterance);
            }
        }

        // Read all messages in the conversation
        function readAllMessages() {
            if (!window.aiSpeakEnabled || !window.speechSynthesis) {
                return;
            }
            
            const messages = document.getElementById('aiMessages');
            const messageElements = messages.querySelectorAll('.ai-message');
            
            if (messageElements.length === 0) {
                return;
            }
            
            // Collect all message texts
            let fullText = '';
            messageElements.forEach(msg => {
                const bubble = msg.querySelector('.ai-bubble');
                if (bubble) {
                    const text = bubble.textContent || bubble.innerText;
                    // Skip action buttons text
                    if (!text.includes('Summarize') && !text.includes('Go Ahead') && !text.includes('Yes') && !text.includes('No')) {
                        fullText += text + '. ';
                    }
                }
            });
            
            if (fullText.trim()) {
                speakText(fullText);
            }
        }

        // Load voices when available
        if (window.speechSynthesis) {
            // Some browsers load voices asynchronously
            if (speechSynthesis.getVoices().length > 0) {
                // Voices already loaded
            } else {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    // Voices loaded
                });
            }
        }

        // Go back to login page
        function goToLogin() {
            // Hide desktop
            document.getElementById('desktop').classList.remove('active');
            
            // Show login screen
            const loginScreen = document.getElementById('loginScreen');
            loginScreen.classList.remove('hidden');
            loginScreen.style.opacity = '1';
            loginScreen.style.transition = 'opacity 0.5s';
            
            // Reset login form
            const loginForm = document.getElementById('loginForm');
            loginForm.style.opacity = '1';
            loginForm.style.transform = 'translateY(0)';
            loginForm.style.transition = 'all 0.4s ease';
            
            // Hide welcome animation if visible
            const welcomeAnim = document.getElementById('welcomeAnimation');
            welcomeAnim.classList.add('hidden');
            welcomeAnim.classList.remove('show');
            
            // Clear input fields
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginError').classList.remove('show');
            document.getElementById('loginUsername').classList.remove('error');
            document.getElementById('loginPassword').classList.remove('error');
            
            // Focus on username field
            setTimeout(() => {
                document.getElementById('loginUsername').focus();
            }, 100);
        }

        // Start Sarah's conversation when s1 button is clicked
        function startSarahConversation() {
            window.s1Clicked = true;
            // Start Sarah's message
            if (typeof showBossMessage === 'function') {
                showBossMessage();
            }
        }

        function toggleAIChat() {
            const chat = document.getElementById('aiChat');
            const isOpening = !chat.classList.contains('active');
            chat.classList.toggle('active');
            
            // If conversation is complete, apply half sidebar class when opening
            if (window.conversationComplete) {
                chat.classList.add('half-sidebar');
            } else {
                chat.classList.remove('half-sidebar');
            }
            
            if (chat.classList.contains('active') && document.getElementById('aiMessages').children.length === 0) {
                if (window.conversationComplete && !postConversationHandled) {
                    // Show action buttons when conversation is complete and not yet handled
                    addAIMessageWithActions('agent', "Great! I've handled your boss's call with Sarah about the Switzerland trip. What would you like me to do?");
                } else if (window.conversationComplete && postConversationHandled) {
                    // Conversation complete and handled - show normal greeting
                    addAIMessage('agent', "Hello! How can I help you today?");
                } else if (window.s1Clicked) {
                    // If s1 was clicked, show normal message
                addAIMessage('agent', "Hello! I see you're working on your project. I'm currently handling your boss's messages about the Switzerland trip. Would you like me to brief you on what's being discussed?");
                } else {
                    // If s1 hasn't been clicked yet, show simple greeting
                    addAIMessage('agent', "Hello! Great to see you!");
                }
            }
        }

        function handleAIInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                sendOneAgentMessage();
            }
        }

        // Track conversation history for One Agent assistant
        let oneAgentChatHistory = [];
        // Track if post-conversation loop has been completed
        let postConversationHandled = localStorage.getItem('postConversationHandled') === 'true';
        
        // Reset post-conversation handled flag when new conversation completes
        // This will be checked when conversationComplete becomes true
        if (typeof window.conversationComplete !== 'undefined' && window.conversationComplete && !postConversationHandled) {
            // New conversation completed, reset the flag
            postConversationHandled = false;
            localStorage.setItem('postConversationHandled', 'false');
        }
        
        async function sendOneAgentMessage() {
            const input = document.getElementById('aiInput');
            if (!input) {
                console.error('aiInput not found');
                return;
            }
            
            const message = input.value.trim();
            
            if (!message) return;
            
            // Disable input and button while processing
            input.disabled = true;
            const sendButton = document.querySelector('.ai-send');
            if (sendButton) sendButton.disabled = true;
            
            addAIMessage('user', message);
            input.value = '';
            
            // Re-enable input and button immediately (processing happens async)
            input.disabled = false;
            if (sendButton) sendButton.disabled = false;
            
            // Add to conversation history
            oneAgentChatHistory.push({ role: 'user', content: message });
            
            // Process message
                const lowerMessage = message.toLowerCase();
                
            // Check if message is related to Sarah/conversation/booking/calendar
            // Only check if post-conversation loop hasn't been completed yet
            const isSarahRelated = !postConversationHandled && (
                                   lowerMessage.includes('sarah') || 
                                   lowerMessage.includes('boss') || 
                                   lowerMessage.includes('conversation') ||
                                   lowerMessage.includes('switzerland') ||
                                   lowerMessage.includes('trip') ||
                                   lowerMessage.includes('booking') ||
                                   lowerMessage.includes('book') ||
                                   lowerMessage.includes('calendar') ||
                                   lowerMessage.includes('summarize') ||
                                   lowerMessage.includes('summary') ||
                                   (lowerMessage.includes('what') && (lowerMessage.includes('happening') || lowerMessage.includes('discussed'))) ||
                                   (typeof window.pendingCalendarUpdate !== 'undefined' && window.pendingCalendarUpdate && (lowerMessage.includes('go ahead') || lowerMessage.includes('proceed') || lowerMessage.includes('yes') || lowerMessage.includes('update')))
                                   );
            
            if (isSarahRelated) {
                // Handle Sarah-related queries with existing logic
                setTimeout(() => {
                // Check if user wants to proceed with calendar update
                if (typeof window.pendingCalendarUpdate !== 'undefined' && window.pendingCalendarUpdate && (lowerMessage.includes('go ahead') || lowerMessage.includes('proceed') || lowerMessage.includes('yes') || lowerMessage.includes('update'))) {
                        // Mark post-conversation as handled
                        postConversationHandled = true;
                        localStorage.setItem('postConversationHandled', 'true');
                        
                    addAIThinking();
                    setTimeout(() => {
                        removeAIThinking();
                        addAIMessage('agent', "Perfect! Updating your calendar with the Switzerland trip itinerary now...");
                        
                        setTimeout(() => {
                            openApp('calendar');
                            updateCalendarWithTrip();
                                addAIMessage('agent', " Calendar updated! All trip details have been added. You can view them in your calendar app.");
                        }, 2000);
                    }, 1500);
                } else if (lowerMessage.includes('what') || lowerMessage.includes('happening') || lowerMessage.includes('summary')) {
                        // Mark as handled when user asks for summary
                        postConversationHandled = true;
                        localStorage.setItem('postConversationHandled', 'true');
                        
                    if (typeof window.messageHistory !== 'undefined' && window.messageHistory.length > 0) {
                        let summary = "Recent messages from your boss:\n";
                        window.messageHistory.forEach(msg => {
                            summary += `\n${msg.sender === 'boss' ? 'Boss' : msg.sender === 'agent' ? 'Agent' : 'You'}: ${msg.text}`;
                        });
                        addAIMessage('agent', summary);
                    } else {
                        addAIMessage('agent', "No recent messages available. Check the message window for conversations.");
                    }
                } else if (typeof window.pendingCalendarUpdate !== 'undefined' && window.pendingCalendarUpdate) {
                        // Mark as handled when user confirms calendar update
                        postConversationHandled = true;
                        localStorage.setItem('postConversationHandled', 'true');
                    addAIMessage('agent', "I'm waiting for your confirmation to update the calendar. Type 'go ahead' to proceed with adding the Switzerland trip to your calendar.");
                } else {
                        // Mark as handled when user interacts with post-conversation options
                        postConversationHandled = true;
                        localStorage.setItem('postConversationHandled', 'true');
                    addAIMessage('agent', "I'm here to help! I can manage your messages, schedule, travel arrangements, and much more. Just let me know what you need.");
                }
            }, 1000);
            } else {
                // Send to LLM for general questions
                addAIThinking();
                
                try {
                    // Call local backend server (which proxies to Claude API)
                    const response = await fetch('http://localhost:5001/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            messages: oneAgentChatHistory
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error || errorData.message || 'Failed to get response from AI');
                    }
                    
                    const data = await response.json();
                    removeAIThinking();
                    
                    // Extract response from Claude API format
                    // Claude API returns: { content: [{ type: 'text', text: '...' }], ... }
                    let responseText = '';
                    if (data.content && Array.isArray(data.content) && data.content.length > 0) {
                        // Claude API format: { content: [{ type: 'text', text: '...' }] }
                        responseText = data.content[0].text || '';
                    } else if (data.response) {
                        // Fallback format (if backend wraps it)
                        responseText = data.response;
                    } else if (typeof data === 'string') {
                        responseText = data;
                    } else {
                        throw new Error('No response from AI');
                    }
                    
                    if (responseText) {
                        addAIMessage('agent', responseText);
                        // Add assistant response to history
                        oneAgentChatHistory.push({ role: 'assistant', content: responseText });
                    } else {
                        throw new Error('No response from AI');
                    }
                } catch (error) {
                    removeAIThinking();
                    console.error('AI Chat error:', error);
                    addAIMessage('agent', `Sorry, I encountered an error: ${error.message}. Please try again.`);
                }
            }
        }

        function addAIMessage(sender, text) {
            const messages = document.getElementById('aiMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'ai-message user-message' : 'ai-message';
            
            messageDiv.innerHTML = `
                <div class="ai-avatar">${sender === 'user' ? '' : ''}</div>
                <div class="ai-bubble">${text}</div>
            `;
            
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
            
            // Speak the message if speech is enabled and it's from the agent
            if (window.aiSpeakEnabled && sender === 'agent' && window.speechSynthesis) {
                speakText(text);
            }
        }

        function addAIMessageWithActions(sender, text) {
            const messages = document.getElementById('aiMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'ai-message user-message' : 'ai-message';
            
            messageDiv.innerHTML = `
                <div class="ai-avatar">${sender === 'user' ? '' : ''}</div>
                <div class="ai-bubble">
                    ${text}
                    <div class="ai-action-buttons">
                        <button class="ai-action-btn" onclick="handleSummarize()"> Summarize Conversation</button>
                        <button class="ai-action-btn" onclick="handleGoAheadWithBooking()"> Go Ahead with Booking</button>
                        <button class="ai-action-btn" onclick="handleAddToCalendarFromChat()"> Add to Calendar</button>
                    </div>
                </div>
            `;
            
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }
        
        function handleAddToCalendarFromChat() {
            // Mark post-conversation as handled
            postConversationHandled = true;
            localStorage.setItem('postConversationHandled', 'true');
            
            addAIMessage('user', 'Add to calendar');
            addAIMessage('agent', "Perfect! Adding all trip events to your calendar now...");
            
            // Set pending calendar update
            window.pendingCalendarUpdate = true;
            
            // Add events to calendar with a loop
            setTimeout(() => {
                openApp('calendar');
                updateCalendarWithTrip();
                addAIMessage('agent', " Calendar updated! All trip details have been added. You can view them in your calendar app.");
            }, 2000);
        }

        function addAIMessageWithYesNo(sender, text) {
            const messages = document.getElementById('aiMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'ai-message user-message' : 'ai-message';
            
            messageDiv.innerHTML = `
                <div class="ai-avatar">${sender === 'user' ? '' : ''}</div>
                <div class="ai-bubble">
                    ${text}
                    <div class="ai-action-buttons">
                        <button class="ai-action-btn" onclick="handleYesBooking()"> Yes, Go Ahead</button>
                        <button class="ai-action-btn" onclick="handleNoBooking()"> No, Leave It</button>
                    </div>
                </div>
            `;
            
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function handleSummarize() {
            // Mark post-conversation as handled
            postConversationHandled = true;
            localStorage.setItem('postConversationHandled', 'true');
            
            let summary = "<strong>Conversation Summary with Boss:</strong><br><br>";
            if (typeof window.messageHistory !== 'undefined' && window.messageHistory.length > 0) {
                window.messageHistory.forEach((msg, index) => {
                    const sender = msg.sender === 'boss' ? 'Boss (Sarah)' : msg.sender === 'agent' ? 'Agent' : 'You';
                    summary += `${index + 1}. <strong>${sender}</strong>: ${msg.text}<br><br>`;
                });
            } else {
                summary += " Boss requested urgent trip to Switzerland for banking consortium meeting<br>";
                summary += " Agent confirmed handling travel arrangements<br>";
                summary += " Hotel near conference center in Zurich requested<br>";
                summary += " Airport transportation arranged<br>";
                summary += " Business class flights confirmed<br>";
            }
            
            summary += "<br><strong>Key Details:</strong><br>";
            summary += " Destination: Zurich, Switzerland<br>";
            summary += " Purpose: Banking consortium meeting<br>";
            summary += " Hotel: Near conference center<br>";
            summary += " Flights: Business class<br>";
            summary += " Transportation: Private car service<br>";
            
            const messages = document.getElementById('aiMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message';
            messageDiv.innerHTML = `
                <div class="ai-avatar"></div>
                <div class="ai-bubble">${summary}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
            
            setTimeout(() => {
                addAIMessageWithYesNo('agent', "Should I go ahead with booking all the arrangements?");
            }, 500);
        }

        function handleYesBooking() {
            // Mark post-conversation as handled
            postConversationHandled = true;
            localStorage.setItem('postConversationHandled', 'true');
            
            addAIMessage('user', 'Yes, go ahead');
            handleGoAheadWithBooking();
        }

        function handleNoBooking() {
            // Mark post-conversation as handled
            postConversationHandled = true;
            localStorage.setItem('postConversationHandled', 'true');
            
            addAIMessage('user', 'No, leave it');
            setTimeout(() => {
                addAIMessage('agent', "Okay, I'll leave it for now. Let me know if you need anything else!");
            }, 500);
        }

        function handleGoAheadWithBooking() {
            // Mark post-conversation as handled
            postConversationHandled = true;
            localStorage.setItem('postConversationHandled', 'true');
            
            // Make sure AI chat is open to show the reasoning chain
            const chat = document.getElementById('aiChat');
            if (!chat.classList.contains('active')) {
                chat.classList.add('active');
                if (window.conversationComplete) {
                    chat.classList.add('half-sidebar');
                }
            }
            
            addAIMessage('agent', "Perfect! I'll proceed with booking all the arrangements. Let me work through the checklist with full reasoning:");
            
            setTimeout(() => {
                showChecklist();
            }, 1000);
        }

        function showChecklist() {
            // Use the sophisticated checklist animation from checklist-animation.js
            // This shows the full reasoning chain of thoughts for each task
            if (typeof showChecklistWithReasoning === 'function') {
                showChecklistWithReasoning();
            } else {
                // Fallback if script not loaded - try loading it
                console.warn('checklist-animation.js not loaded, attempting to load...');
                const script = document.createElement('script');
                script.src = 'checklist-animation.js';
                script.onload = () => {
                    if (typeof showChecklistWithReasoning === 'function') {
                        showChecklistWithReasoning();
                    }
                };
                document.head.appendChild(script);
            }
        }

        function updateCalendarSilently() {
            if (typeof window.pendingCalendarUpdate === 'undefined') {
                window.pendingCalendarUpdate = true;
            }
            
            const today = new Date();
            const daysUntilWednesday = (3 - today.getDay() + 7) % 7 || 7;
            const flightOutDate = new Date(today);
            flightOutDate.setDate(today.getDate() + daysUntilWednesday);
            
            const meetingDate = new Date(flightOutDate);
            meetingDate.setDate(flightOutDate.getDate() + 1);
            
            const workshopDate = new Date(meetingDate);
            workshopDate.setDate(meetingDate.getDate() + 1);
            
            const dinnerDate = new Date(workshopDate);
            dinnerDate.setDate(workshopDate.getDate() + 1);
            
            const returnDate = new Date(dinnerDate);
            returnDate.setDate(dinnerDate.getDate() + 1);
            
            const tripEvents = {
                [getDateString(flightOutDate.getFullYear(), flightOutDate.getMonth(), flightOutDate.getDate())]: [
                    { title: ' Flight to Zurich', time: '7:45 PM', type: 'travel', details: 'Swiss Air LH 1190  Business Class  Terminal 2' },
                    { title: ' Airport Pickup', time: '11:30 AM (Zurich time)', type: 'travel', details: 'Private car service  Hotel transfer' }
                ],
                [getDateString(meetingDate.getFullYear(), meetingDate.getMonth(), meetingDate.getDate())]: [
                    { title: ' Credit Suisse Meeting', time: '9:00 AM', type: 'meeting', details: 'Paradeplatz 8, Zurich  Quarterly Review' },
                    { title: ' UBS Meeting', time: '2:00 PM', type: 'meeting', details: 'Bahnhofstrasse 45, Zurich  Partnership Discussion' }
                ],
                [getDateString(workshopDate.getFullYear(), workshopDate.getMonth(), workshopDate.getDate())]: [
                    { title: ' Workshop Session', time: '10:00 AM', type: 'meeting', details: 'Innovation Lab  Product Roadmap Planning' }
                ],
                [getDateString(dinnerDate.getFullYear(), dinnerDate.getMonth(), dinnerDate.getDate())]: [
                    { title: ' Anniversary Dinner', time: '7:30 PM', type: 'personal', details: 'Kronenhalle Restaurant  Reservation for 2  Special Menu' }
                ],
                [getDateString(returnDate.getFullYear(), returnDate.getMonth(), returnDate.getDate())]: [
                    { title: ' Airport Dropoff', time: '12:00 PM', type: 'travel', details: 'Private car service  Hotel to airport' },
                    { title: ' Return Flight', time: '3:00 PM', type: 'travel', details: 'Swiss Air LH 1191  Business Class' }
                ]
            };
            
            Object.assign(calendarEvents, tripEvents);
            window.pendingCalendarUpdate = false;
            
            if (currentCalendarView === 'month') {
                renderMonthView();
            } else if (currentCalendarView === 'agenda') {
                renderAgendaView();
            }
        }

        function addAIThinking() {
            const messages = document.getElementById('aiMessages');
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'ai-thinking';
            thinkingDiv.id = 'aiThinking';
            thinkingDiv.innerHTML = `
                Analyzing context and planning actions
                <span class="loading-dots">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </span>
            `;
            messages.appendChild(thinkingDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function removeAIThinking() {
            const thinking = document.getElementById('aiThinking');
            if (thinking) thinking.remove();
        }

        // Calendar Functions
        let currentCalendarView = 'month';
        let currentCalendarDate = new Date();
        
        // Generate date string in YYYY-MM-DD format
        function getDateString(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }
        
        // Generate realistic calendar events for current month
        function generateCalendarEvents() {
            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const events = {};
            
            // Add some events spread throughout the month
            const eventTemplates = [
                { title: 'Team Meeting', time: '10:00 AM', type: 'meeting' },
                { title: 'Client Presentation', time: '2:00 PM', type: 'presentation' },
                { title: 'Doctor Appointment', time: '11:00 AM', type: 'personal' },
                { title: 'Project Review', time: '3:00 PM', type: 'meeting' },
                { title: 'Lunch with Team', time: '12:30 PM', type: 'social' },
                { title: 'Conference Call', time: '4:00 PM', type: 'call' },
                { title: 'Gym Session', time: '6:00 AM', type: 'personal' },
                { title: 'Budget Review', time: '10:00 AM', type: 'meeting' },
                { title: 'Client Call', time: '2:00 PM', type: 'call' },
                { title: 'Team Building', time: '5:00 PM', type: 'social' },
                { title: 'Quarterly Planning', time: '9:00 AM', type: 'meeting' },
                { title: 'Dentist', time: '3:00 PM', type: 'personal' }
            ];
            
            // Add 6-8 random events throughout the month
            const numEvents = 7;
            const lastDay = new Date(year, month + 1, 0).getDate();
            for (let i = 0; i < numEvents; i++) {
                const day = Math.floor(Math.random() * lastDay) + 1;
                const dateStr = getDateString(year, month, day);
                const template = eventTemplates[Math.floor(Math.random() * eventTemplates.length)];
                if (!events[dateStr]) events[dateStr] = [];
                events[dateStr].push({...template});
            }
            
            return events;
        }
        
        let calendarEvents = generateCalendarEvents();

        function switchCalendarView(view) {
            currentCalendarView = view;
            
            if (view === 'month') {
                renderMonthView();
            } else if (view === 'week') {
                renderWeekView();
            } else if (view === 'day') {
                renderDayView();
            } else if (view === 'agenda') {
                renderAgendaView();
            }
        }

        function renderMonthView() {
            const monthView = document.getElementById('calendarMonthView');
            const eventsList = document.getElementById('calendarEvents');
            monthView.style.display = 'block';
            eventsList.style.display = 'none';
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('calendarDate').textContent = `${monthNames[month]} ${year}`;
            
            let html = '<div class="calendar-weekdays">';
            weekdays.forEach(day => {
                html += `<div class="calendar-weekday">${day}</div>`;
            });
            html += '</div><div class="calendar-days">';
            
            // Empty cells for days before month starts
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += '<div class="calendar-day other-month"></div>';
            }
            
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = year === today.getFullYear() && month === today.getMonth() && day === today.getDate();
                const hasEvents = calendarEvents[dateStr] && calendarEvents[dateStr].length > 0;
                
                let dayClasses = 'calendar-day';
                if (isToday) dayClasses += ' today';
                if (hasEvents) dayClasses += ' has-events';
                
                html += `<div class="${dayClasses}">${day}`;
                if (hasEvents && calendarEvents[dateStr].length > 0) {
                    html += `<div class="day-event">${calendarEvents[dateStr][0].title}</div>`;
                }
                html += '</div>';
            }
            
            html += '</div>';
            monthView.innerHTML = html;
        }

        function renderWeekView() {
            const monthView = document.getElementById('calendarMonthView');
            const eventsList = document.getElementById('calendarEvents');
            monthView.style.display = 'none';
            eventsList.style.display = 'block';
            eventsList.innerHTML = '<div style="padding: 20px; text-align: center; color: rgba(255,255,255,0.6);">Week view - Coming soon</div>';
        }

        function renderDayView() {
            const monthView = document.getElementById('calendarMonthView');
            const eventsList = document.getElementById('calendarEvents');
            monthView.style.display = 'none';
            eventsList.style.display = 'block';
            eventsList.innerHTML = '<div style="padding: 20px; text-align: center; color: rgba(255,255,255,0.6);">Day view - Coming soon</div>';
        }

        function renderAgendaView() {
            const monthView = document.getElementById('calendarMonthView');
            const eventsList = document.getElementById('calendarEvents');
            monthView.style.display = 'none';
            eventsList.style.display = 'block';
            
            eventsList.innerHTML = '';
            Object.keys(calendarEvents).sort().forEach(date => {
                calendarEvents[date].forEach(event => {
                    const eventCard = document.createElement('div');
                    eventCard.className = 'event-card';
                    eventCard.innerHTML = `
                        <div class="event-time">${date}  ${event.time}</div>
                        <div class="event-title">${event.title}</div>
                        <div class="event-details">${event.type}</div>
                    `;
                    eventsList.appendChild(eventCard);
                });
            });
        }

        // Conversation Summary Panel Functions
        function showConversationSummaryPanel() {
            const panel = document.getElementById('conversationSummaryPanel');
            const content = document.getElementById('conversationSummaryContent');
            
            if (!panel || !content) return;
            
            // Generate summary
            let summary = "<div style='color: rgba(255, 255, 255, 0.9); line-height: 1.8;'>";
            summary += "<h3 style='color: #fff; font-size: 18px; margin-bottom: 15px;'> Conversation Completed with Sarah Mitchell</h3>";
            
            if (typeof window.messageHistory !== 'undefined' && window.messageHistory.length > 0) {
                summary += "<div style='margin-bottom: 20px;'>";
                summary += "<strong style='color: rgba(99, 102, 241, 0.9);'>Key Points Discussed:</strong><br><br>";
                window.messageHistory.forEach((msg, index) => {
                    const sender = msg.sender === 'boss' ? 'Sarah' : msg.sender === 'agent' ? 'Agent' : 'You';
                    const icon = msg.sender === 'boss' ? '' : msg.sender === 'agent' ? '' : '';
                    summary += `<div style='margin-bottom: 12px; padding: 10px; background: rgba(255, 255, 255, 0.03); border-radius: 6px; border-left: 3px solid ${msg.sender === 'boss' ? 'rgba(239, 68, 68, 0.5)' : msg.sender === 'agent' ? 'rgba(99, 102, 241, 0.5)' : 'rgba(16, 185, 129, 0.5)'};'>`;
                    summary += `<strong>${icon} ${sender}:</strong> ${msg.text}`;
                    summary += "</div>";
                });
                summary += "</div>";
            } else {
                summary += "<div style='margin-bottom: 20px; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 8px;'>";
                summary += "<strong>Summary:</strong><br><br>";
                summary += " Sarah requested urgent trip to Switzerland for banking consortium meeting<br>";
                summary += " Agent confirmed handling all travel arrangements<br>";
                summary += " Hotel near conference center in Zurich requested<br>";
                summary += " Airport transportation arranged<br>";
                summary += " Business class flights confirmed<br>";
                summary += "</div>";
            }
            
            summary += "<div style='margin-top: 20px; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 3px solid rgba(16, 185, 129, 0.5);'>";
            summary += "<strong style='color: rgba(16, 185, 129, 0.9);'> Trip Details:</strong><br><br>";
            summary += " <strong>Destination:</strong> Zurich, Switzerland<br>";
            summary += " <strong>Purpose:</strong> Banking consortium meeting<br>";
            summary += " <strong>Hotel:</strong> Near conference center<br>";
            summary += " <strong>Flights:</strong> Business class<br>";
            summary += " <strong>Transportation:</strong> Private car service<br>";
            summary += "</div>";
            
            summary += "</div>";
            content.innerHTML = summary;
            panel.style.display = 'block';
        }
        
        function closeConversationSummary() {
            const panel = document.getElementById('conversationSummaryPanel');
            if (panel) {
                panel.style.display = 'none';
            }
        }
        
        function handleSummarizeFromPanel() {
            // Mark post-conversation as handled
            postConversationHandled = true;
            localStorage.setItem('postConversationHandled', 'true');
            
            closeConversationSummary();
            toggleAIChat();
            setTimeout(() => {
                handleSummarize();
            }, 300);
        }
        
        function handleGoAheadWithBookingFromPanel() {
            // Mark post-conversation as handled
            postConversationHandled = true;
            localStorage.setItem('postConversationHandled', 'true');
            
            closeConversationSummary();
            // Open AI chat sidebar to show the reasoning chain
            const chat = document.getElementById('aiChat');
            if (!chat.classList.contains('active')) {
                chat.classList.add('active');
                // Apply half sidebar class if conversation is complete
                if (window.conversationComplete) {
                    chat.classList.add('half-sidebar');
                }
            }
            setTimeout(() => {
                handleGoAheadWithBooking();
            }, 500);
        }
        
        function handleAddToCalendarFromPanel() {
            // Mark post-conversation as handled
            postConversationHandled = true;
            localStorage.setItem('postConversationHandled', 'true');
            
            closeConversationSummary();
            
            // Show progress message
            const panel = document.getElementById('conversationSummaryPanel');
            const content = document.getElementById('conversationSummaryContent');
            if (content) {
                content.innerHTML = "<div style='text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.9);'><div style='font-size: 48px; margin-bottom: 20px;'></div><div style='font-size: 18px; margin-bottom: 10px;'>Adding events to calendar...</div><div style='font-size: 14px; color: rgba(255, 255, 255, 0.6);'>Please wait while we add all trip details</div></div>";
            }
            
            // Set pending calendar update
            window.pendingCalendarUpdate = true;
            
            // Add events to calendar with a loop
            setTimeout(() => {
                updateCalendarWithTripLoop();
            }, 1000);
        }
        
        function updateCalendarWithTripLoop() {
            // Open calendar app
            openApp('calendar');
            
            // Update calendar
            updateCalendarWithTrip();
            
            // Show success message
            setTimeout(() => {
                const panel = document.getElementById('conversationSummaryPanel');
                const content = document.getElementById('conversationSummaryContent');
                if (content) {
                    content.innerHTML = "<div style='text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.9);'><div style='font-size: 48px; margin-bottom: 20px;'></div><div style='font-size: 18px; margin-bottom: 10px;'>Calendar Updated Successfully!</div><div style='font-size: 14px; color: rgba(255, 255, 255, 0.6); margin-bottom: 20px;'>All trip events have been added to your calendar</div><div style='font-size: 12px; color: rgba(255, 255, 255, 0.5);'> Flight to Zurich<br> Credit Suisse Meeting<br> UBS Meeting<br> Workshop Session<br> Anniversary Dinner<br> Return Flight</div></div>";
                }
                
                // Auto-close after 3 seconds
                setTimeout(() => {
                    closeConversationSummary();
                }, 3000);
            }, 1500);
        }

        function updateCalendarWithTrip() {
            if (typeof window.pendingCalendarUpdate === 'undefined' || !window.pendingCalendarUpdate) return;
            
            // Calculate trip dates (Wednesday = flight out, Thursday = meetings, etc.)
            const today = new Date();
            const daysUntilWednesday = (3 - today.getDay() + 7) % 7 || 7; // Next Wednesday
            const flightOutDate = new Date(today);
            flightOutDate.setDate(today.getDate() + daysUntilWednesday);
            
            const meetingDate = new Date(flightOutDate);
            meetingDate.setDate(flightOutDate.getDate() + 1); // Thursday
            
            const workshopDate = new Date(meetingDate);
            workshopDate.setDate(meetingDate.getDate() + 1); // Friday
            
            const dinnerDate = new Date(workshopDate);
            dinnerDate.setDate(workshopDate.getDate() + 1); // Saturday
            
            const returnDate = new Date(dinnerDate);
            returnDate.setDate(dinnerDate.getDate() + 1); // Sunday
            
            // Add trip events to calendar
            const tripEvents = {
                [getDateString(flightOutDate.getFullYear(), flightOutDate.getMonth(), flightOutDate.getDate())]: [
                    { title: ' Flight to Zurich', time: '7:45 PM', type: 'travel', details: 'Swiss Air LH 1190  Business Class  Terminal 2' }
                ],
                [getDateString(meetingDate.getFullYear(), meetingDate.getMonth(), meetingDate.getDate())]: [
                    { title: ' Credit Suisse Meeting', time: '9:00 AM', type: 'meeting', details: 'Paradeplatz 8, Zurich  Quarterly Review' },
                    { title: ' UBS Meeting', time: '2:00 PM', type: 'meeting', details: 'Bahnhofstrasse 45, Zurich  Partnership Discussion' }
                ],
                [getDateString(workshopDate.getFullYear(), workshopDate.getMonth(), workshopDate.getDate())]: [
                    { title: ' Workshop Session', time: '10:00 AM', type: 'meeting', details: 'Innovation Lab  Product Roadmap Planning' }
                ],
                [getDateString(dinnerDate.getFullYear(), dinnerDate.getMonth(), dinnerDate.getDate())]: [
                    { title: ' Anniversary Dinner', time: '7:30 PM', type: 'personal', details: 'Kronenhalle Restaurant  Reservation for 2  Special Menu' }
                ],
                [getDateString(returnDate.getFullYear(), returnDate.getMonth(), returnDate.getDate())]: [
                    { title: ' Return Flight', time: '3:00 PM', type: 'travel', details: 'Swiss Air LH 1191  Business Class' }
                ]
            };
            
            Object.assign(calendarEvents, tripEvents);
            if (typeof window.pendingCalendarUpdate !== 'undefined') {
                window.pendingCalendarUpdate = false;
            }
            
            // Re-render if month view is active
            if (currentCalendarView === 'month') {
                renderMonthView();
            } else if (currentCalendarView === 'agenda') {
                renderAgendaView();
            }
            
            showNotification(' Calendar updated with complete itinerary');
        }

        // Notification System
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Browser Functions
        let browserHistory = [];
        let browserHistoryIndex = -1;

        function isUrl(input) {
            // Check if input looks like a URL
            const urlPattern = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/i;
            const hasProtocol = input.startsWith('http://') || input.startsWith('https://');
            const hasDomain = /^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9]\.[a-zA-Z]{2,}/.test(input);
            const hasTld = /\.(com|org|net|edu|gov|io|co|uk|de|fr|jp|cn|in|au|ca|us|tv|me|xyz|dev|tech|app|online|site|website|store|shop|blog|info|biz|name|mobi|asia|tel|travel|jobs|pro|xxx|aero|coop|museum|mil|int|arpa|edu|gov|org|net|com)$/i.test(input);
            
            return hasProtocol || (hasDomain && hasTld) || urlPattern.test(input);
        }

        function navigateToUrl(url) {
            console.log(' [DEBUG] navigateToUrl called with:', url);
            const iframe = document.getElementById('browserIframe');
            const placeholder = document.getElementById('browserPlaceholder');
            const urlBar = document.getElementById('browserUrl');
            const title = document.getElementById('browserTitle');
            
            console.log(' [DEBUG] iframe element:', iframe);
            console.log(' [DEBUG] iframe sandbox:', iframe?.getAttribute('sandbox'));
            console.log(' [DEBUG] iframe current src:', iframe?.src);
            
            // If it's not a URL, treat it as a Google search
            if (!isUrl(url)) {
                const searchQuery = encodeURIComponent(url);
                url = `https://www.google.com/search?q=${searchQuery}`;
                console.log(' [DEBUG] Converted to search URL:', url);
            } else {
            // Add https:// if not present
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
                    console.log(' [DEBUG] Added https://:', url);
                }
            }
            
            // For Google.com specifically, try to use a more permissive URL
            // Some Google pages work better than others in iframes
            if (url === 'https://www.google.com/' || url === 'https://www.google.com') {
                // Try Google Search instead, which sometimes works better
                url = 'https://www.google.com/search?q=';
                console.log(' [DEBUG] Changed to search page:', url);
            }
            
            console.log(' [DEBUG] Final URL to load:', url);
            
            try {
                // Show loading state
                console.log(' [DEBUG] Showing loading state');
                placeholder.style.display = 'flex';
                placeholder.innerHTML = `
                    <div style="text-align: center; width: 100%;">
                        <div style="font-size: 18px; margin-bottom: 10px; color: rgba(255,255,255,0.9);">Loading...</div>
                        <div style="color: rgba(255,255,255,0.6);">${url}</div>
                    </div>
                `;
                
                console.log(' [DEBUG] Setting iframe src to:', url);
                iframe.src = url;
                iframe.style.display = 'block';
                urlBar.value = url;
                console.log(' [DEBUG] iframe src after setting:', iframe.src);
                console.log(' [DEBUG] iframe display:', iframe.style.display);
                
                // Add to history
                browserHistory = browserHistory.slice(0, browserHistoryIndex + 1);
                browserHistory.push(url);
                browserHistoryIndex = browserHistory.length - 1;
                
                // Wait for iframe to load
                let loadTimeout;
                let checkInterval;
                
                console.log(' [DEBUG] Setting up iframe onload handler');
                iframe.onload = function() {
                    console.log(' [DEBUG] iframe.onload triggered!');
                    clearTimeout(loadTimeout);
                    clearInterval(checkInterval);
                    
                    // Wait a bit to check if content actually loaded
                    setTimeout(() => {
                        try {
                            // Try to access iframe content to check if it loaded
                            console.log(' [DEBUG] Trying to access iframe.contentDocument');
                            if (iframe.contentDocument && iframe.contentDocument.body) {
                                const bodyContent = iframe.contentDocument.body.innerHTML;
                                console.log(' [DEBUG] Successfully accessed iframe content!');
                                console.log(' [DEBUG] iframe.contentDocument.body:', iframe.contentDocument.body);
                                console.log(' [DEBUG] iframe.contentDocument.body.innerHTML length:', bodyContent?.length);
                                
                                // Check if body is empty or has error content
                                if (bodyContent.trim() === '' || bodyContent.includes('refused to connect') || bodyContent.includes('X-Frame-Options')) {
                                    console.log(' [DEBUG] Body is empty or contains error - likely blocked');
                                    showBlockedError(url);
                                    return;
                                }
                                
                                title.textContent = iframe.contentDocument.title || 'oneBrowser';
                                console.log(' [DEBUG] Page title:', iframe.contentDocument.title);
                                placeholder.style.display = 'none';
                                iframe.style.display = 'block';
                            } else {
                                console.log(' [DEBUG] iframe.contentDocument or body is null - checking if blocked');
                                // Check if iframe has dimensions (might be loaded but cross-origin)
                                if (iframe.offsetWidth === 0 && iframe.offsetHeight === 0) {
                                    console.log(' [DEBUG] Iframe has no dimensions - likely blocked');
                                    showBlockedError(url);
                                } else {
                                    console.log(' [DEBUG] Iframe has dimensions, assuming loaded (cross-origin)');
                                    title.textContent = 'oneBrowser';
                                    placeholder.style.display = 'none';
                                    iframe.style.display = 'block';
                                }
                            }
                        } catch (e) {
                            // Cross-origin - can't access, but might be loaded
                            console.log(' [DEBUG] Cross-origin error accessing iframe:', e.message);
                            console.log(' [DEBUG] Error name:', e.name);
                            console.log(' [DEBUG] Error details:', e);
                            
                            // Check if it's a security error (blocked)
                            if (e.name === 'SecurityError' || e.message.includes('X-Frame-Options') || e.message.includes('frame')) {
                                console.log(' [DEBUG] Security error detected - page is blocked');
                                showBlockedError(url);
                            } else {
                                // Might be loaded but cross-origin
                                console.log(' [DEBUG] Assuming page loaded (cross-origin restriction)');
                                title.textContent = 'oneBrowser';
                                placeholder.style.display = 'none';
                                iframe.style.display = 'block';
                            }
                        }
                    }, 500);
                };
                
                iframe.onerror = function(error) {
                    console.error(' [ERROR] iframe.onerror triggered:', error);
                    console.error(' [ERROR] This usually means the page failed to load or is blocked');
                };
                
                // Also listen for load errors via contentWindow
                try {
                    iframe.contentWindow.addEventListener('error', function(e) {
                        console.error(' [ERROR] Content window error:', e);
                    });
                } catch (e) {
                    console.log(' [DEBUG] Cannot add error listener to contentWindow (cross-origin)');
                }
                
                // Check if iframe is blocked (X-Frame-Options)
                let checkCount = 0;
                checkInterval = setInterval(() => {
                    checkCount++;
                    console.log(` [DEBUG] Check interval #${checkCount}`);
                    try {
                        if (iframe.contentDocument && iframe.contentDocument.body) {
                            // Iframe loaded successfully
                            console.log(' [DEBUG] Iframe content accessible in check interval');
                            clearInterval(checkInterval);
                            placeholder.style.display = 'none';
                            iframe.style.display = 'block';
                        } else {
                            console.log(' [DEBUG] iframe.contentDocument or body not available yet');
                        }
                    } catch (e) {
                        // Cross-origin - might be blocked or might be loading
                        console.log(` [DEBUG] Cross-origin in check #${checkCount}:`, e.message);
                        // Check if we can see the iframe dimensions
                        console.log(' [DEBUG] iframe dimensions:', iframe.offsetWidth, 'x', iframe.offsetHeight);
                        if (iframe.offsetWidth > 0 && iframe.offsetHeight > 0) {
                            // Iframe has dimensions, likely loaded
                            console.log(' [DEBUG] Iframe has dimensions, assuming loaded');
                            clearInterval(checkInterval);
                            placeholder.style.display = 'none';
                            iframe.style.display = 'block';
                        }
                    }
                }, 500);
                
                // Timeout after 5 seconds - show error if still loading
                loadTimeout = setTimeout(() => {
                    console.log(' [DEBUG] Load timeout reached (5 seconds)');
                    clearInterval(checkInterval);
                    try {
                        console.log(' [DEBUG] Checking iframe content in timeout handler');
                        // Check if iframe actually has content
                        if (iframe.contentDocument && iframe.contentDocument.body) {
                            const bodyContent = iframe.contentDocument.body.innerHTML.trim();
                            console.log(' [DEBUG] iframe body content length:', bodyContent.length);
                            console.log(' [DEBUG] iframe body content preview:', bodyContent.substring(0, 200));
                            if (bodyContent === '') {
                                // Empty body - likely blocked
                                console.log(' [DEBUG] Empty body detected - likely blocked');
                                showBlockedError(url);
                            } else {
                                // Has content - hide placeholder
                                console.log(' [DEBUG] Iframe has content, hiding placeholder');
                                placeholder.style.display = 'none';
                                iframe.style.display = 'block';
                            }
                        } else {
                            console.log(' [DEBUG] Cannot access iframe.contentDocument or body');
                            // Can't access - might be blocked or cross-origin
                            // Show helpful message for Google specifically
                            if (url.includes('google.com')) {
                                console.log(' [DEBUG] Google URL detected, showing blocked error');
                                showBlockedError(url);
                            } else {
                                console.log(' [DEBUG] Non-Google URL, hiding placeholder anyway');
                                placeholder.style.display = 'none';
                                iframe.style.display = 'block';
                            }
                        }
                    } catch (e) {
                        // Cross-origin error - likely blocked
                        console.error(' [ERROR] Exception in timeout handler:', e);
                        console.error(' [ERROR] Error message:', e.message);
                        console.error(' [ERROR] Error stack:', e.stack);
                        if (url.includes('google.com') || url.includes('youtube.com') || url.includes('facebook.com')) {
                            console.log(' [DEBUG] Known blocked site, showing error');
                            showBlockedError(url);
                        } else {
                            // Might be loading - hide placeholder and show iframe
                            console.log(' [DEBUG] Unknown site, hiding placeholder anyway');
                            placeholder.style.display = 'none';
                            iframe.style.display = 'block';
                        }
                    }
                }, 5000);
                
                // Update title after a delay
                setTimeout(() => {
                    try {
                        title.textContent = iframe.contentDocument?.title || 'oneBrowser';
                    } catch (e) {
                        title.textContent = 'oneBrowser';
                    }
                }, 1000);
            } catch (e) {
                placeholder.style.display = 'flex';
                placeholder.innerHTML = `
                    <div style="text-align: center; width: 100%; padding: 40px;">
                        <div style="font-size: 24px; margin-bottom: 20px;"></div>
                        <h2 style="margin-bottom: 20px; color: rgba(255,255,255,0.9);">Error loading page</h2>
                        <p style="margin-bottom: 30px; color: rgba(255,255,255,0.6);">${e.message || 'An error occurred'}</p>
                        <button class="search-btn" onclick="navigateToUrl('https://duckduckgo.com')">Go to DuckDuckGo</button>
                    </div>
                `;
                iframe.style.display = 'none';
            }
        }

        // Show blocked error with option to open in new tab
        function showBlockedError(url) {
            console.log(' [DEBUG] showBlockedError called for:', url);
            const placeholder = document.getElementById('browserPlaceholder');
            const iframe = document.getElementById('browserIframe');
            
            console.log(' [DEBUG] iframe current src:', iframe?.src);
            console.log(' [DEBUG] iframe readyState:', iframe?.contentWindow?.document?.readyState);
            
            placeholder.style.display = 'flex';
            placeholder.innerHTML = `
                <div style="text-align: center; width: 100%; padding: 40px;">
                    <div style="font-size: 48px; margin-bottom: 20px;"></div>
                    <h2 style="margin-bottom: 20px; color: rgba(255,255,255,0.9);">Page Blocked by X-Frame-Options</h2>
                    <p style="margin-bottom: 30px; color: rgba(255,255,255,0.6); line-height: 1.6;">
                        This website (${url}) cannot be displayed in an iframe due to security restrictions.<br>
                        This is a common security feature that prevents clickjacking attacks.
                    </p>
                    <div style="margin-bottom: 20px; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.3);">
                        <div style="font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 10px;">Open in a new tab:</div>
                        <a href="${url}" target="_blank" style="color: #a5b4fc; text-decoration: underline; font-size: 14px; word-break: break-all;">${url}</a>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="search-btn" onclick="window.open('${url}', '_blank')" style="margin-top: 10px;">Open in New Tab</button>
                        <button class="search-btn" onclick="navigateToUrl('https://duckduckgo.com')" style="margin-top: 10px; background: rgba(99, 102, 241, 0.3);">Go to DuckDuckGo</button>
                    </div>
                </div>
            `;
            iframe.style.display = 'none';
        }

        function browserNavigate() {
            const urlBar = document.getElementById('browserUrl');
            const url = urlBar.value.trim();
            if (url) {
                navigateToUrl(url);
            }
        }

        function handleUrlInput(event) {
            if (event.key === 'Enter') {
                browserNavigate();
            }
        }

        // Fix browser buttons on load
        function fixBrowserButtons() {
            const backBtn = document.querySelector('.browser-toolbar button[onclick="browserGoBack()"]');
            const forwardBtn = document.querySelector('.browser-toolbar button[onclick="browserGoForward()"]');
            const reloadBtn = document.querySelector('.browser-toolbar button[onclick="browserReload()"]');
            
            if (backBtn) {
                backBtn.textContent = '';
                backBtn.setAttribute('title', 'Back');
            }
            if (forwardBtn) {
                forwardBtn.textContent = '';
                forwardBtn.setAttribute('title', 'Forward');
            }
            if (reloadBtn) {
                reloadBtn.textContent = '';
                reloadBtn.setAttribute('title', 'Reload');
            }
            
            // Fix quick search buttons
            const quickSearchButtons = document.querySelectorAll('.quick-search .search-btn');
            const buttonTexts = [' Google', ' YouTube', ' GitHub', ' Wikipedia', ' Reddit', ' Twitter'];
            quickSearchButtons.forEach((btn, index) => {
                if (index < buttonTexts.length) {
                    btn.textContent = buttonTexts[index];
                }
            });
        }
        
        // Also fix on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', fixBrowserButtons);
        } else {
            fixBrowserButtons();
        }

        function browserGoBack() {
            if (browserHistoryIndex > 0) {
                browserHistoryIndex--;
                navigateToUrl(browserHistory[browserHistoryIndex]);
            }
        }

        function browserGoForward() {
            if (browserHistoryIndex < browserHistory.length - 1) {
                browserHistoryIndex++;
                navigateToUrl(browserHistory[browserHistoryIndex]);
            }
        }

        function browserReload() {
            const iframe = document.getElementById('browserIframe');
            if (iframe.src) {
                iframe.src = iframe.src;
            }
        }

        // AI Chatbot Functions
        let aiChatHistory = [];

        function toggleAIChatbot() {
            const chatbot = document.getElementById('aiChatbot');
            chatbot.classList.toggle('active');
            if (chatbot.classList.contains('active')) {
                document.getElementById('aiChatbotInput').focus();
            }
        }

        function handleAIChatbotInput(event) {
            if (event.key === 'Enter') {
                sendAIMessage();
            }
        }

        async function sendAIMessage() {
            const input = document.getElementById('aiChatbotInput');
            const messagesContainer = document.getElementById('aiChatbotMessages');
            const sendButton = document.querySelector('.ai-chatbot-send');
            const message = input.value.trim();

            if (!message) return;

            // Disable input and button
            input.disabled = true;
            sendButton.disabled = true;

            // Add user message to UI
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'ai-message ai-message-user';
            userMessageDiv.innerHTML = `<div class="ai-message-content">${escapeHtml(message)}</div>`;
            messagesContainer.appendChild(userMessageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Clear input
            input.value = '';

            // Add user message to history
            aiChatHistory.push({ role: 'user', content: message });

            // Show loading indicator
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'ai-message ai-message-assistant';
            loadingDiv.id = 'aiLoadingMessage';
            loadingDiv.innerHTML = '<div class="ai-message-content">Thinking...</div>';
            messagesContainer.appendChild(loadingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                // Call local backend server (which proxies to Claude API)
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: aiChatHistory
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || errorData.message || 'Failed to get response from AI');
                }

                const data = await response.json();
                const assistantMessage = data.content[0].text;

                // Remove loading indicator
                loadingDiv.remove();

                // Add assistant message to UI
                const assistantMessageDiv = document.createElement('div');
                assistantMessageDiv.className = 'ai-message ai-message-assistant';
                assistantMessageDiv.innerHTML = `
                    <div class="ai-message-content">${escapeHtml(assistantMessage)}</div>
                    <button class="ai-message-speak" onclick="speakAIMessage(this)" title="Play audio" data-text="${escapeHtml(assistantMessage)}"></button>
                `;
                messagesContainer.appendChild(assistantMessageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Add assistant message to history
                aiChatHistory.push({ role: 'assistant', content: assistantMessage });

                // Auto-speak if enabled
                if (window.aiChatbotAutoSpeak) {
                    setTimeout(() => {
                        speakTextWithElevenLabs(assistantMessage);
                    }, 500);
                }

            } catch (error) {
                console.error('AI Chatbot Error:', error);
                
                // Remove loading indicator
                loadingDiv.remove();

                // Show error message
                const errorDiv = document.createElement('div');
                errorDiv.className = 'ai-message ai-message-assistant';
                errorDiv.innerHTML = `<div class="ai-message-content" style="color: #ef4444;">Sorry, I encountered an error: ${escapeHtml(error.message)}</div>`;
                messagesContainer.appendChild(errorDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            } finally {
                // Re-enable input and button
                input.disabled = false;
                sendButton.disabled = false;
                input.focus();
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ElevenLabs TTS Functions
        let currentAudio = null;
        window.aiChatbotAutoSpeak = false;

        function toggleAIChatbotSpeak() {
            window.aiChatbotAutoSpeak = !window.aiChatbotAutoSpeak;
            const toggle = document.getElementById('aiChatbotSpeakToggle');
            const icon = document.getElementById('aiChatbotSpeakIcon');
            
            if (window.aiChatbotAutoSpeak) {
                toggle.classList.add('active');
                icon.textContent = '';
                toggle.title = 'Auto-speak: ON';
            } else {
                toggle.classList.remove('active');
                icon.textContent = '';
                toggle.title = 'Auto-speak: OFF';
                // Stop any currently playing audio
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }
            }
        }

        async function speakTextWithElevenLabs(text, voiceId = null) {
            try {
                // Stop any currently playing audio
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }

                // Call ElevenLabs TTS API
                const response = await fetch('http://localhost:5001/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        voice_id: voiceId
                    })
                });

                if (!response.ok) {
                    // Try to get error message
                    try {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Failed to generate speech');
                    } catch (e) {
                        throw new Error('Failed to generate speech');
                    }
                }

                // Get audio blob
                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                
                // Create and play audio
                currentAudio = new Audio(audioUrl);
                currentAudio.play();
                
                // Clean up when done
                currentAudio.addEventListener('ended', () => {
                    URL.revokeObjectURL(audioUrl);
                    currentAudio = null;
                });

                currentAudio.addEventListener('error', (e) => {
                    console.error('Audio playback error:', e);
                    URL.revokeObjectURL(audioUrl);
                    currentAudio = null;
                });

            } catch (error) {
                console.error('ElevenLabs TTS Error:', error);
                // Fallback to browser TTS if ElevenLabs fails
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    speechSynthesis.speak(utterance);
                }
            }
        }

        async function speakAIMessage(button) {
            const messageDiv = button.closest('.ai-message');
            const contentDiv = messageDiv.querySelector('.ai-message-content');
            const text = contentDiv.textContent || button.getAttribute('data-text') || '';
            
            if (!text) return;

            // Stop any currently playing audio
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            // Update button state
            button.classList.add('playing');
            button.textContent = '';

            try {
                // Call ElevenLabs TTS API
                const response = await fetch('http://localhost:5001/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate speech');
                }

                // Get audio blob
                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                
                // Create and play audio
                currentAudio = new Audio(audioUrl);
                currentAudio.play();
                
                // Update button when audio ends
                currentAudio.addEventListener('ended', () => {
                    button.classList.remove('playing');
                    button.textContent = '';
                    URL.revokeObjectURL(audioUrl);
                    currentAudio = null;
                });

                currentAudio.addEventListener('error', (e) => {
                    console.error('Audio playback error:', e);
                    button.classList.remove('playing');
                    button.textContent = '';
                    URL.revokeObjectURL(audioUrl);
                    currentAudio = null;
                });
                
            } catch (error) {
                console.error('ElevenLabs TTS Error:', error);
                button.classList.remove('playing');
                button.textContent = '';
            }
        }

        // File Explorer Functions
        let explorerHistory = [];
        let explorerHistoryIndex = -1;
        let currentPath = 'C:\\Users\\YourName\\Documents';

        const fileSystem = {
            'C:\\Users\\YourName\\Documents': [
                { name: 'Projects', type: 'folder', icon: '' },
                { name: 'Photos', type: 'folder', icon: '' },
                { name: 'Documents', type: 'folder', icon: '' },
                { name: 'Report.pdf', type: 'file', icon: '' },
                { name: 'Presentation.pptx', type: 'file', icon: '' }
            ],
            'C:\\Users\\YourName\\Documents\\Projects': [
                { name: 'Project1', type: 'folder', icon: '' },
                { name: 'Project2', type: 'folder', icon: '' },
                { name: 'README.md', type: 'file', icon: '' }
            ],
            'C:\\Users\\YourName\\Documents\\Photos': [
                { name: 'Vacation', type: 'folder', icon: '' },
                { name: 'Family', type: 'folder', icon: '' }
            ]
        };

        function updateFileExplorer() {
            const fileList = document.getElementById('fileList');
            const pathDisplay = document.getElementById('explorerPath');
            pathDisplay.textContent = currentPath;
            
            fileList.innerHTML = '';
            const files = fileSystem[currentPath] || [];
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.onclick = () => {
                    if (file.type === 'folder') {
                        navigateToFolder(currentPath + '\\' + file.name);
                    } else {
                        openFile(file, currentPath);
                    }
                };
                fileItem.innerHTML = `
                    <div class="file-icon">${file.icon}</div>
                    <div class="file-name">${file.name}</div>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function navigateToFolder(path) {
            explorerHistory = explorerHistory.slice(0, explorerHistoryIndex + 1);
            explorerHistory.push(currentPath);
            explorerHistoryIndex = explorerHistory.length - 1;
            currentPath = path;
            updateFileExplorer();
        }

        function explorerGoBack() {
            if (explorerHistoryIndex >= 0) {
                currentPath = explorerHistory[explorerHistoryIndex];
                explorerHistoryIndex--;
                updateFileExplorer();
            }
        }

        function explorerGoForward() {
            // Simplified - in real app would track forward history
        }

        function explorerGoUp() {
            const parts = currentPath.split('\\');
            if (parts.length > 1) {
                parts.pop();
                navigateToFolder(parts.join('\\'));
            }
        }

        // Open file in viewer
        function openFile(file, path) {
            const fullPath = path + '\\' + file.name;
            
            // Create or update file viewer window
            let viewerWindow = document.getElementById('fileViewer');
            if (!viewerWindow) {
                viewerWindow = document.createElement('div');
                viewerWindow.id = 'fileViewer';
                viewerWindow.className = 'window';
                viewerWindow.style.width = '700px';
                viewerWindow.style.height = '600px';
                viewerWindow.style.top = '100px';
                viewerWindow.style.left = '300px';
                viewerWindow.innerHTML = `
                    <div class="window-header" onmousedown="startDrag(event, 'fileViewer')">
                        <div class="window-controls">
                            <div class="window-control window-close" onclick="closeApp('fileViewer')"></div>
                            <div class="window-control window-minimize" onclick="minimizeApp('fileViewer')"></div>
                            <div class="window-control window-maximize" onclick="maximizeApp('fileViewer')"></div>
                        </div>
                        <div class="window-title" id="fileViewerTitle">File Viewer</div>
                    </div>
                    <div class="window-content" style="padding: 20px; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; line-height: 1.6; white-space: pre-wrap; overflow-y: auto; height: calc(100% - 36px);" id="fileViewerContent"></div>
                `;
                document.body.appendChild(viewerWindow);
                addResizeHandles('fileViewer');
            }
            
            // Update window title and content
            document.getElementById('fileViewerTitle').textContent = file.name;
            const content = document.getElementById('fileViewerContent');
            
            if (file.content) {
                content.textContent = file.content;
            } else {
                content.textContent = `File: ${file.name}\n\nThis file does not have content available.`;
            }
            
            // Show and bring to front
            viewerWindow.classList.add('active');
            viewerWindow.style.zIndex = ++zIndex;
            activeWindow = 'fileViewer';
        }

        // Initialize File Explorer with enhanced file system
        function initializeFileSystem() {
            // Add more folders and files to existing structure
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Work']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Work'] = [
                    { name: 'Reports', type: 'folder', icon: '' },
                    { name: 'Presentations', type: 'folder', icon: '' },
                    { name: 'Meetings', type: 'folder', icon: '' },
                    { name: 'meeting-notes.txt', type: 'file', icon: '', content: 'Meeting Notes - November 8, 2024\n\nAttendees:\n- Sarah Mitchell\n- John Doe\n- Jane Smith\n\nAgenda:\n1. Q4 Planning\n2. Budget Review\n3. Team Updates\n\nAction Items:\n- Complete budget proposal by Friday\n- Schedule follow-up meeting\n- Update project timeline' }
                ];
            }
            
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Work\\Reports']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Work\\Reports'] = [
                    { name: 'Q3-Report.pdf', type: 'file', icon: '', content: 'Q3 Quarterly Report\n\nExecutive Summary:\nThe third quarter showed strong growth across all metrics.\n\nKey Highlights:\n- Revenue: $2.5M (+20%)\n- Users: 50K (+15%)\n- Customer Satisfaction: 94%\n\nNext Steps:\n- Continue growth trajectory\n- Expand to new markets\n- Enhance product features' },
                    { name: 'Sales-Report.xlsx', type: 'file', icon: '', content: 'Sales Report\n\nMonth\tSales\tGrowth\nJan\t$500K\t10%\nFeb\t$550K\t10%\nMar\t$600K\t9%\n\nTotal Q1: $1.65M\nAverage Growth: 9.7%' }
                ];
            }
            
            // Update root Documents folder
            if (fileSystem['C:\\Users\\YourName\\Documents']) {
                const rootFiles = fileSystem['C:\\Users\\YourName\\Documents'];
                // Add Work folder if not exists
                if (!rootFiles.find(f => f.name === 'Work')) {
                    rootFiles.push({ name: 'Work', type: 'folder', icon: '' });
                }
                // Add Personal folder if not exists
                if (!rootFiles.find(f => f.name === 'Personal')) {
                    rootFiles.push({ name: 'Personal', type: 'folder', icon: '' });
                }
                // Add Downloads folder if not exists
                if (!rootFiles.find(f => f.name === 'Downloads')) {
                    rootFiles.push({ name: 'Downloads', type: 'folder', icon: '' });
                }
                // Add Notes.txt if not exists
                if (!rootFiles.find(f => f.name === 'Notes.txt')) {
                    rootFiles.push({ name: 'Notes.txt', type: 'file', icon: '', content: 'Personal Notes\n\n- Meeting with team tomorrow\n- Review quarterly reports\n- Update project timeline\n- Call dentist for appointment' });
                }
            }
            
            // Add WebApp subfolders
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Projects\\WebApp']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Projects\\WebApp'] = [
                    { name: 'src', type: 'folder', icon: '' },
                    { name: 'public', type: 'folder', icon: '' },
                    { name: 'package.json', type: 'file', icon: '', content: '{\n  "name": "webapp",\n  "version": "1.0.0",\n  "description": "Modern web application",\n  "dependencies": {\n    "react": "^18.2.0",\n    "react-dom": "^18.2.0",\n    "express": "^4.18.0"\n  }\n}' },
                    { name: 'README.md', type: 'file', icon: '', content: '# WebApp\n\nA modern web application built with React.\n\n## Installation\n\n```bash\nnpm install\nnpm start\n```\n\n## Features\n\n- User authentication\n- Real-time updates\n- Responsive design' }
                ];
            }
            
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Projects\\WebApp\\src']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Projects\\WebApp\\src'] = [
                    { name: 'components', type: 'folder', icon: '' },
                    { name: 'App.js', type: 'file', icon: '', content: 'import React from \'react\';\nimport Header from \'./components/Header\';\nimport Footer from \'./components/Footer\';\n\nfunction App() {\n  return (\n    <div className="App">\n      <Header />\n      <main>\n        <h1>Welcome to WebApp</h1>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n\nexport default App;' },
                    { name: 'index.js', type: 'file', icon: '', content: 'import React from \'react\';\nimport ReactDOM from \'react-dom/client\';\nimport App from \'./App\';\n\nconst root = ReactDOM.createRoot(document.getElementById(\'root\'));\nroot.render(<App />);' }
                ];
            }
            
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Projects\\WebApp\\src\\components']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Projects\\WebApp\\src\\components'] = [
                    { name: 'Header.js', type: 'file', icon: '', content: 'import React from \'react\';\n\nfunction Header() {\n  return (\n    <header>\n      <h1>WebApp</h1>\n      <nav>\n        <a href="/">Home</a>\n        <a href="/about">About</a>\n      </nav>\n    </header>\n  );\n}\n\nexport default Header;' },
                    { name: 'Footer.js', type: 'file', icon: '', content: 'import React from \'react\';\n\nfunction Footer() {\n  return (\n    <footer>\n      <p>&copy; 2024 WebApp. All rights reserved.</p>\n    </footer>\n  );\n}\n\nexport default Footer;' }
                ];
            }
            
            // Add Personal folders
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Personal']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Personal'] = [
                    { name: 'Photos', type: 'folder', icon: '' },
                    { name: 'Videos', type: 'folder', icon: '' },
                    { name: 'todo.txt', type: 'file', icon: '', content: 'Personal Todo List\n\n- [ ] Buy groceries\n- [ ] Call mom\n- [ ] Schedule dentist appointment\n- [x] Finish project report\n- [ ] Plan weekend trip\n- [ ] Update resume' }
                ];
            }
            
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Personal\\Photos']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Personal\\Photos'] = [
                    { name: 'Vacation', type: 'folder', icon: '' },
                    { name: 'Family', type: 'folder', icon: '' },
                    { name: 'Events', type: 'folder', icon: '' }
                ];
            }
            
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Personal\\Photos\\Vacation']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Personal\\Photos\\Vacation'] = [
                    { name: 'beach.jpg', type: 'file', icon: '', content: 'Image: beach.jpg\n\nA beautiful beach scene from vacation.\n\nLocation: Hawaii\nDate: July 2024\nCamera: iPhone 15 Pro' },
                    { name: 'sunset.png', type: 'file', icon: '', content: 'Image: sunset.png\n\nStunning sunset over the ocean.\n\nLocation: Maui, Hawaii\nDate: July 15, 2024' }
                ];
            }
            
            // Add Downloads
            if (!fileSystem['C:\\Users\\YourName\\Documents\\Downloads']) {
                fileSystem['C:\\Users\\YourName\\Documents\\Downloads'] = [
                    { name: 'document.pdf', type: 'file', icon: '', content: 'Downloaded Document\n\nThis file was downloaded from the internet.\n\nFile size: 2.5 MB\nDownloaded: November 5, 2024' },
                    { name: 'software-installer.exe', type: 'file', icon: '', content: 'Software Installer\n\nApplication installer package.\n\nVersion: 2.1.0\nSize: 45 MB' }
                ];
            }
        }

        // Initialize File Explorer
        window.addEventListener('load', () => {
            initializeFileSystem();
            updateFileExplorer();
        });

        // Gallery Functions
        const galleryImages = [
            '', '', '', '', '', '',
            '', '', '', '', '', '',
            '', '', '', '', '', ''
        ];

        function initializeGallery() {
            const galleryContent = document.getElementById('galleryContent');
            galleryContent.innerHTML = '';
            
            galleryImages.forEach((emoji, index) => {
                const item = document.createElement('div');
                item.className = 'gallery-item';
                item.innerHTML = `<div style="font-size: 64px;">${emoji}</div>`;
                item.onclick = () => showNotification(`Viewing image ${index + 1}`);
                galleryContent.appendChild(item);
            });
        }

        // Calculator Functions
        let calcDisplay = '0';
        let calcPreviousValue = null;
        let calcOperation = null;
        let calcWaitingForOperand = false;

        function updateCalcDisplay() {
            document.getElementById('calcDisplay').textContent = calcDisplay;
        }

        function calcInput(value) {
            if (value >= '0' && value <= '9' || value === '.') {
                if (calcWaitingForOperand) {
                    calcDisplay = value;
                    calcWaitingForOperand = false;
                } else {
                    calcDisplay = calcDisplay === '0' ? value : calcDisplay + value;
                }
            } else if (value === 'C') {
                calcDisplay = '0';
                calcPreviousValue = null;
                calcOperation = null;
                calcWaitingForOperand = false;
            } else if (value === 'CE') {
                calcDisplay = '0';
            } else if (value === '') {
                calcDisplay = String(-parseFloat(calcDisplay));
            } else if (['+', '-', '*', '/', '%'].includes(value)) {
                if (calcPreviousValue === null) {
                    calcPreviousValue = parseFloat(calcDisplay);
                } else if (!calcWaitingForOperand) {
                    const result = performCalculation();
                    calcDisplay = String(result);
                    calcPreviousValue = result;
                }
                calcOperation = value;
                calcWaitingForOperand = true;
            } else if (value === '=') {
                if (calcPreviousValue !== null && !calcWaitingForOperand) {
                    const result = performCalculation();
                    calcDisplay = String(result);
                    calcPreviousValue = null;
                    calcOperation = null;
                    calcWaitingForOperand = true;
                }
            }
            updateCalcDisplay();
        }

        function performCalculation() {
            const current = parseFloat(calcDisplay);
            const previous = calcPreviousValue;
            
            switch (calcOperation) {
                case '+': return previous + current;
                case '-': return previous - current;
                case '*': return previous * current;
                case '/': return previous / current;
                case '%': return previous % current;
                default: return current;
            }
        }

        // Settings Functions
        function toggleSetting(element, setting) {
            element.classList.toggle('active');
            showNotification(`${setting} ${element.classList.contains('active') ? 'enabled' : 'disabled'}`);
        }

        // Music Player Functions
        let musicPlaying = false;
        let currentTrack = 0;
        let musicProgressInterval = null;
        
        const playlist = [
            { title: 'Relaxing Beats', artist: 'Chill Vibes', emoji: '' },
            { title: 'Electronic Dreams', artist: 'Synth Wave', emoji: '' },
            { title: 'Nature Sounds', artist: 'Forest Ambience', emoji: '' },
            { title: 'Lo-Fi Hip Hop', artist: 'Study Mix', emoji: '' },
            { title: 'Jazz Lounge', artist: 'Smooth Jazz', emoji: '' }
        ];

        function initializeMusicPlayer() {
            const playlistElement = document.getElementById('musicPlaylist');
            playlistElement.innerHTML = '';
            
            playlist.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = 'playlist-item' + (index === currentTrack ? ' active' : '');
                item.innerHTML = `
                    <span style="font-size: 20px;">${track.emoji}</span>
                    <div style="flex: 1;">
                        <div style="font-size: 13px;">${track.title}</div>
                        <div style="font-size: 11px; color: rgba(255,255,255,0.6);">${track.artist}</div>
                    </div>
                `;
                item.onclick = () => playTrack(index);
                playlistElement.appendChild(item);
            });
            
            updateMusicDisplay();
        }

        function updateMusicDisplay() {
            const track = playlist[currentTrack];
            document.getElementById('musicTitle').textContent = track.title;
            document.getElementById('musicArtist').textContent = track.artist;
            document.querySelector('.music-album-art').textContent = track.emoji;
            
            // Update active playlist item
            document.querySelectorAll('.playlist-item').forEach((item, index) => {
                item.classList.toggle('active', index === currentTrack);
            });
        }

        function musicToggle() {
            musicPlaying = !musicPlaying;
            const btn = document.getElementById('musicPlayBtn');
            btn.textContent = musicPlaying ? '' : '';
            
            if (musicPlaying) {
                simulateMusicProgress();
            } else {
                if (musicProgressInterval) {
                    clearInterval(musicProgressInterval);
                    musicProgressInterval = null;
                }
            }
        }

        function simulateMusicProgress() {
            if (musicProgressInterval) {
                clearInterval(musicProgressInterval);
            }
            
            const progressBar = document.getElementById('musicProgress');
            let progress = parseFloat(progressBar.style.width) || 0;
            
            musicProgressInterval = setInterval(() => {
                if (!musicPlaying) {
                    clearInterval(musicProgressInterval);
                    musicProgressInterval = null;
                    return;
                }
                progress += 0.5;
                if (progress > 100) {
                    progress = 0;
                    musicNext();
                }
                progressBar.style.width = progress + '%';
            }, 100);
        }

        function musicNext() {
            currentTrack = (currentTrack + 1) % playlist.length;
            updateMusicDisplay();
            document.getElementById('musicProgress').style.width = '0%';
            if (musicPlaying) {
                simulateMusicProgress();
            }
        }

        function musicPrevious() {
            currentTrack = (currentTrack - 1 + playlist.length) % playlist.length;
            updateMusicDisplay();
            document.getElementById('musicProgress').style.width = '0%';
            if (musicPlaying) {
                simulateMusicProgress();
            }
        }

        function musicSeek(event) {
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = (x / rect.width) * 100;
            document.getElementById('musicProgress').style.width = percentage + '%';
        }

        function playTrack(index) {
            currentTrack = index;
            updateMusicDisplay();
            document.getElementById('musicProgress').style.width = '0%';
            if (!musicPlaying) {
                musicPlaying = true;
                const btn = document.getElementById('musicPlayBtn');
                btn.textContent = '';
                simulateMusicProgress();
            } else {
                simulateMusicProgress();
            }
        }

        // Initialize apps on load
        window.addEventListener('load', () => {
            initializeGallery();
            initializeMusicPlayer();
            renderMonthView(); // Initialize calendar with month view
            
            // Fix calendar view tab switching
            document.querySelectorAll('.calendar-view-tab').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    document.querySelectorAll('.calendar-view-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const view = this.textContent.toLowerCase();
                    switchCalendarView(view);
                });
            });
            
            // Load voices for speech synthesis
            if ('speechSynthesis' in window) {
                // Trigger voice loading
                speechSynthesis.getVoices();
                setTimeout(() => speechSynthesis.getVoices(), 100);
            }
        });
    </script>
    
    <!-- Message Management -->
    <script src="messages.js"></script>
    <script src="checklist-animation.js"></script>
    <script src="one-agent.js"></script>
    <script>
        // Initialize One Agent when window opens
        function openApp(appId) {
            const window = document.getElementById(appId);
            window.classList.add('active');
            window.style.zIndex = ++zIndex;
            
            // Show in taskbar
            const taskbarIcon = document.getElementById(`taskbar-${appId}`);
            if (taskbarIcon) {
                taskbarIcon.style.display = 'flex';
                taskbarIcon.classList.add('active');
            }
            
            activeWindow = appId;
            updateTaskbar();
            
            // Initialize One Agent graph if opening One Agent
            if (appId === 'oneAgent') {
                setTimeout(() => {
                    if (typeof initOneAgent === 'function') {
                        try {
                            initOneAgent();
                        } catch (error) {
                            console.error('Error initializing One Agent:', error);
                            const graphContainer = document.getElementById('oneAgentGraph');
                            if (graphContainer) {
                                graphContainer.innerHTML = '<div style="padding: 20px; color: rgba(255, 255, 255, 0.7); text-align: center;">Error loading graph. Please refresh the page.</div>';
                            }
                        }
                    } else {
                        console.error('initOneAgent function not found. Make sure one-agent.js is loaded.');
                    }
                }, 200);
            }
            
            // Initialize One Voice if opening One Voice
            if (appId === 'oneVoice') {
                setTimeout(() => {
                    loadVoices();
                }, 200);
            }
        }

        // One Voice Functions
        let voicesList = [];
        let currentTTSAudio = null;
        let currentTTSBlob = null;

        function switchOneVoiceTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.onevoice-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.onevoice-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`onevoice-${tabName}`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Load voices if needed
            if (tabName === 'library' || tabName === 'tts' || tabName === 'convert' || tabName === 'settings' || tabName === 'music') {
                if (voicesList.length === 0) {
                    loadVoices();
                }
            }
        }

        async function loadVoices() {
            try {
                const response = await fetch('http://localhost:5001/api/voices');
                if (!response.ok) throw new Error('Failed to load voices');
                
                const data = await response.json();
                voicesList = data.voices || [];
                
                // Populate voice selects
                const selects = ['tts-voice-select', 'convert-voice-select', 'settings-voice-select', 'music-voice-select'];
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        select.innerHTML = '<option value="">Select a voice...</option>';
                        voicesList.forEach(voice => {
                            const option = document.createElement('option');
                            option.value = voice.voice_id;
                            option.textContent = voice.name;
                            select.appendChild(option);
                        });
                    }
                });
                
                // Populate voice library
                displayVoiceLibrary();
            } catch (error) {
                console.error('Error loading voices:', error);
            }
        }

        function displayVoiceLibrary() {
            const libraryList = document.getElementById('voice-library-list');
            if (!libraryList) return;
            
            if (voicesList.length === 0) {
                libraryList.innerHTML = '<div style="padding: 15px; text-align: center; color: rgba(255, 255, 255, 0.6);">No voices found</div>';
                return;
            }
            
            libraryList.innerHTML = voicesList.map(voice => `
                <div style="padding: 15px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: rgba(255, 255, 255, 0.9);">${voice.name}</div>
                    <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 10px;">${voice.description || 'No description'}</div>
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <button onclick="testVoice('${voice.voice_id}')" style="flex: 1; padding: 6px; background: rgba(99, 102, 241, 0.3); border: 1px solid rgba(99, 102, 241, 0.4); border-radius: 4px; color: #fff; font-size: 11px; cursor: pointer;"> Test</button>
                        ${voice.category === 'cloned' ? `<button onclick="deleteVoice('${voice.voice_id}')" style="padding: 6px 12px; background: rgba(239, 68, 68, 0.3); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 4px; color: #fff; font-size: 11px; cursor: pointer;"> Delete</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function generateTTS() {
            const text = document.getElementById('tts-text-input').value.trim();
            const voiceId = document.getElementById('tts-voice-select').value;
            
            if (!text) {
                alert('Please enter text to convert');
                return;
            }
            
            if (!voiceId) {
                alert('Please select a voice');
                return;
            }
            
            try {
                const stability = parseFloat(document.getElementById('tts-stability').value);
                const similarity = parseFloat(document.getElementById('tts-similarity').value);
                const style = parseFloat(document.getElementById('tts-style').value);
                
                const response = await fetch('http://localhost:5001/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        voice_id: voiceId,
                        settings: {
                            stability: stability,
                            similarity_boost: similarity,
                            style: style
                        }
                    })
                });
                
                if (!response.ok) throw new Error('Failed to generate speech');
                
                currentTTSBlob = await response.blob();
                document.getElementById('tts-play-btn').disabled = false;
                document.getElementById('tts-download-btn').disabled = false;
                
                // Auto-play
                playTTS();
            } catch (error) {
                console.error('TTS Error:', error);
                alert('Failed to generate speech: ' + error.message);
            }
        }

        function playTTS() {
            if (!currentTTSBlob) return;
            
            if (currentTTSAudio) {
                currentTTSAudio.pause();
            }
            
            const audioUrl = URL.createObjectURL(currentTTSBlob);
            currentTTSAudio = new Audio(audioUrl);
            currentTTSAudio.play();
            
            currentTTSAudio.addEventListener('ended', () => {
                URL.revokeObjectURL(audioUrl);
            });
        }

        function downloadTTS() {
            if (!currentTTSBlob) return;
            
            const url = URL.createObjectURL(currentTTSBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'speech.mp3';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Update slider values
        ['tts-stability', 'tts-similarity', 'tts-style', 'settings-stability', 'settings-similarity', 'settings-style'].forEach(id => {
            const slider = document.getElementById(id);
            if (slider) {
                slider.addEventListener('input', (e) => {
                    const valueId = id + '-value';
                    const valueSpan = document.getElementById(valueId);
                    if (valueSpan) {
                        valueSpan.textContent = e.target.value;
                    }
                });
            }
        });

        function handleCloneFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('clone-file-info').textContent = `Selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
            }
        }

        async function cloneVoice() {
            const fileInput = document.getElementById('clone-audio-file');
            const name = document.getElementById('clone-voice-name').value.trim();
            
            if (!fileInput.files[0]) {
                alert('Please select an audio file');
                return;
            }
            
            if (!name) {
                alert('Please enter a voice name');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('name', name);
            formData.append('description', document.getElementById('clone-voice-desc').value);
            
            const statusDiv = document.getElementById('clone-status');
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'rgba(99, 102, 241, 0.2)';
            statusDiv.style.color = 'rgba(255, 255, 255, 0.9)';
            statusDiv.textContent = 'Cloning voice... This may take a moment.';
            
            try {
                const response = await fetch('http://localhost:5001/api/voice-clone', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to clone voice');
                }
                
                const data = await response.json();
                statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
                statusDiv.textContent = `Voice cloned successfully! Voice ID: ${data.voice_id}`;
                
                // Reload voices
                loadVoices();
            } catch (error) {
                statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
                statusDiv.textContent = 'Error: ' + error.message;
            }
        }

        function handleConvertFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('convert-file-info').textContent = `Selected: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
            }
        }

        async function convertVoice() {
            const fileInput = document.getElementById('convert-audio-file');
            const voiceId = document.getElementById('convert-voice-select').value;
            
            if (!fileInput.files[0]) {
                alert('Please select an audio file');
                return;
            }
            
            if (!voiceId) {
                alert('Please select a target voice');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('voice_id', voiceId);
            
            const statusDiv = document.getElementById('convert-status');
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'rgba(99, 102, 241, 0.2)';
            statusDiv.style.color = 'rgba(255, 255, 255, 0.9)';
            statusDiv.textContent = 'Converting voice...';
            
            try {
                const response = await fetch('http://localhost:5001/api/voice-convert', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to convert voice');
                }
                
                const blob = await response.blob();
                const audioUrl = URL.createObjectURL(blob);
                const audioPlayer = document.getElementById('convert-audio-player');
                audioPlayer.src = audioUrl;
                
                document.getElementById('convert-result').style.display = 'block';
                statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
                statusDiv.textContent = 'Voice converted successfully!';
                
                window.convertedAudioBlob = blob;
            } catch (error) {
                statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
                statusDiv.textContent = 'Error: ' + error.message;
            }
        }

        function downloadConvertedAudio() {
            if (!window.convertedAudioBlob) return;
            
            const url = URL.createObjectURL(window.convertedAudioBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'converted-voice.mp3';
            a.click();
            URL.revokeObjectURL(url);
        }

        async function testVoice(voiceId) {
            const testText = "Hello, this is a test of the voice.";
            try {
                const response = await fetch('http://localhost:5001/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: testText,
                        voice_id: voiceId
                    })
                });
                
                if (!response.ok) throw new Error('Failed to generate test');
                
                const blob = await response.blob();
                const audioUrl = URL.createObjectURL(blob);
                const audio = new Audio(audioUrl);
                audio.play();
                
                audio.addEventListener('ended', () => {
                    URL.revokeObjectURL(audioUrl);
                });
            } catch (error) {
                console.error('Test voice error:', error);
            }
        }

        async function deleteVoice(voiceId) {
            if (!confirm('Are you sure you want to delete this voice?')) return;
            
            try {
                const response = await fetch('http://localhost:5001/api/delete-voice', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ voice_id: voiceId })
                });
                
                if (!response.ok) throw new Error('Failed to delete voice');
                
                loadVoices();
            } catch (error) {
                console.error('Delete voice error:', error);
                alert('Failed to delete voice: ' + error.message);
            }
        }

        async function saveVoiceSettings() {
            const voiceId = document.getElementById('settings-voice-select').value;
            if (!voiceId) {
                alert('Please select a voice');
                return;
            }
            
            const settings = {
                stability: parseFloat(document.getElementById('settings-stability').value),
                similarity_boost: parseFloat(document.getElementById('settings-similarity').value),
                style: parseFloat(document.getElementById('settings-style').value),
                use_speaker_boost: true
            };
            
            try {
                const response = await fetch('http://localhost:5001/api/voice-settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        voice_id: voiceId,
                        settings: settings
                    })
                });
                
                if (!response.ok) throw new Error('Failed to save settings');
                
                alert('Settings saved successfully!');
            } catch (error) {
                console.error('Save settings error:', error);
                alert('Failed to save settings: ' + error.message);
            }
        }

        // Music Generation Functions
        let currentMusicBlob = null;

        async function generateMusic() {
            const prompt = document.getElementById('music-prompt').value.trim();
            const voiceId = document.getElementById('music-voice-select').value;
            const style = document.getElementById('music-style').value;
            const duration = parseInt(document.getElementById('music-duration').value);
            
            if (!prompt) {
                alert('Please enter a music description');
                return;
            }
            
            if (!voiceId) {
                alert('Please select a voice');
                return;
            }
            
            const statusDiv = document.getElementById('music-status');
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'rgba(99, 102, 241, 0.2)';
            statusDiv.style.color = 'rgba(255, 255, 255, 0.9)';
            statusDiv.textContent = 'Generating music... This may take a moment.';
            
            try {
                // Create a musical description text that can be converted to speech
                // This is a creative use of TTS to generate musical content
                const musicText = createMusicDescription(prompt, style, duration);
                
                const response = await fetch('http://localhost:5001/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: musicText,
                        voice_id: voiceId,
                        settings: {
                            stability: 0.6,
                            similarity_boost: 0.8,
                            style: 0.3,
                            use_speaker_boost: true
                        }
                    })
                });
                
                if (!response.ok) {
                    // Try the music generation endpoint
                    const musicResponse = await fetch('http://localhost:5001/api/music-generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            duration: duration,
                            style: style
                        })
                    });
                    
                    if (!musicResponse.ok) {
                        const errorData = await musicResponse.json().catch(() => ({}));
                        throw new Error(errorData.error || 'Failed to generate music');
                    }
                    
                    const musicData = await musicResponse.json();
                    statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
                    statusDiv.textContent = musicData.error || musicData.suggestion || 'Music generation not available. Using TTS alternative.';
                    
                    // Fallback to TTS
                    return generateMusicWithTTS(musicText, voiceId);
                }
                
                currentMusicBlob = await response.blob();
                const audioUrl = URL.createObjectURL(currentMusicBlob);
                const audioPlayer = document.getElementById('music-audio-player');
                audioPlayer.src = audioUrl;
                
                document.getElementById('music-result').style.display = 'block';
                statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
                statusDiv.textContent = 'Music generated successfully!';
                
                // Auto-play
                audioPlayer.play();
                
            } catch (error) {
                console.error('Music generation error:', error);
                statusDiv.style.background = 'rgba(239, 68, 68, 0.2)';
                statusDiv.textContent = 'Error: ' + error.message;
            }
        }

        function createMusicDescription(prompt, style, duration) {
            // Create a rich musical description that can be spoken
            const styleDescriptions = {
                'ambient': 'calm, atmospheric, ethereal',
                'electronic': 'synthesized, digital, rhythmic',
                'jazz': 'smooth, improvisational, sophisticated',
                'classical': 'orchestral, elegant, timeless',
                'rock': 'energetic, powerful, driving',
                'hip-hop': 'urban, rhythmic, beat-driven',
                'acoustic': 'organic, warm, natural',
                'cinematic': 'dramatic, emotional, epic'
            };
            
            const styleDesc = styleDescriptions[style] || style;
            return `This is a ${duration} second ${style} music composition. ${prompt}. The music features ${styleDesc} elements. The composition creates a musical atmosphere that matches the description: ${prompt}.`;
        }

        async function generateMusicWithTTS(text, voiceId) {
            try {
                const response = await fetch('http://localhost:5001/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: text,
                        voice_id: voiceId,
                        settings: {
                            stability: 0.6,
                            similarity_boost: 0.8,
                            style: 0.3,
                            use_speaker_boost: true
                        }
                    })
                });
                
                if (!response.ok) throw new Error('Failed to generate');
                
                currentMusicBlob = await response.blob();
                const audioUrl = URL.createObjectURL(currentMusicBlob);
                const audioPlayer = document.getElementById('music-audio-player');
                audioPlayer.src = audioUrl;
                
                document.getElementById('music-result').style.display = 'block';
                const statusDiv = document.getElementById('music-status');
                statusDiv.style.background = 'rgba(16, 185, 129, 0.2)';
                statusDiv.textContent = 'Musical composition generated using voice synthesis!';
                
                audioPlayer.play();
            } catch (error) {
                console.error('TTS music generation error:', error);
            }
        }

        function downloadMusic() {
            if (!currentMusicBlob) return;
            
            const url = URL.createObjectURL(currentMusicBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'generated-music.mp3';
            a.click();
            URL.revokeObjectURL(url);
        }

        // oneData Functions
        let oneDataCharts = {};
        const cloudProviders = [
            { id: 'gdrive', name: 'Google Drive', icon: '', total: 15, used: 8.5, color: '#4285F4', connected: true, files: 1245 },
            { id: 'dropbox', name: 'Dropbox', icon: '', total: 2, used: 1.2, color: '#0061FF', connected: true, files: 342 },
            { id: 'aws', name: 'AWS S3', icon: '', total: 100, used: 45.8, color: '#FF9900', connected: true, files: 5678 },
            { id: 'onedrive', name: 'OneDrive', icon: '', total: 5, used: 3.1, color: '#0078D4', connected: true, files: 892 },
            { id: 'icloud', name: 'iCloud', icon: '', total: 2, used: 1.5, color: '#007AFF', connected: true, files: 456 }
        ];

        const fileTypes = [
            { type: 'Documents', size: 12.5, count: 2340 },
            { type: 'Images', size: 28.3, count: 4567 },
            { type: 'Videos', size: 45.2, count: 123 },
            { type: 'Audio', size: 8.7, count: 890 },
            { type: 'Archives', size: 3.1, count: 234 },
            { type: 'Other', size: 2.2, count: 567 }
        ];

        function switchOneDataTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.onedata-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.onedata-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`onedata-${tabName}`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Initialize tab-specific content
            if (tabName === 'clouds') {
                renderCloudCards();
            } else if (tabName === 'analytics') {
                setTimeout(() => {
                    renderAnalytics();
                }, 100);
            } else if (tabName === 'browser') {
                renderFileBrowser();
            }
        }

        function switchOneMemoryTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.onememory-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.onememory-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            const tabContent = document.getElementById(`onememory-${tabName}`);
            const tabButton = document.getElementById(`tab-${tabName}`);
            
            if (tabContent) {
                tabContent.classList.add('active');
                tabContent.style.display = 'flex'; // Ensure it's visible
            } else {
                console.error(` switchOneMemoryTab: Tab content not found: onememory-${tabName}`);
            }
            
            if (tabButton) {
                tabButton.classList.add('active');
            } else {
                console.error(` switchOneMemoryTab: Tab button not found: tab-${tabName}`);
            }

            // Render graph if switching to graph tab
            if (tabName === 'graph' && typeof renderMemoryGraph === 'function') {
                setTimeout(() => {
                    // Make sure memory data is initialized
                    if (typeof memoryData !== 'undefined' && memoryData.MEMORIES.length === 0) {
                        if (typeof initializeMemoryData === 'function') {
                            console.log(' switchOneMemoryTab: Initializing memory data...');
                            initializeMemoryData();
                        }
                    }
                    renderMemoryGraph();
                }, 100);
            }
            
            // Initialize analytics if switching to analytics tab
            if (tabName === 'analytics') {
                console.log(' switchOneMemoryTab: Switching to analytics tab...');
                
                // Make sure memory data is initialized
                if (typeof memoryData === 'undefined') {
                    console.error(' switchOneMemoryTab: memoryData is undefined');
                } else if (memoryData.MEMORIES.length === 0) {
                    if (typeof initializeMemoryData === 'function') {
                        console.log(' switchOneMemoryTab: Initializing memory data for analytics...');
                        initializeMemoryData();
                    } else {
                        console.error(' switchOneMemoryTab: initializeMemoryData function not found');
                    }
                }
                
                // Render analytics
                if (typeof renderMemoryAnalytics === 'function') {
                    setTimeout(() => {
                        console.log(' switchOneMemoryTab: Calling renderMemoryAnalytics...');
                        try {
                            renderMemoryAnalytics();
                            console.log(' switchOneMemoryTab: Analytics rendered successfully');
                        } catch (error) {
                            console.error(' switchOneMemoryTab: Error rendering analytics:', error);
                        }
                    }, 100);
                } else {
                    console.error(' switchOneMemoryTab: renderMemoryAnalytics function not found');
                }
            }
        }

        function renderCloudCards() {
            const container = document.getElementById('clouds-list');
            container.innerHTML = '';
            
            cloudProviders.forEach(cloud => {
                const percentage = (cloud.used / cloud.total) * 100;
                const card = document.createElement('div');
                card.className = `cloud-card ${cloud.connected ? 'connected' : ''}`;
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 32px;">${cloud.icon}</span>
                            <div>
                                <div style="font-size: 16px; font-weight: 600; color: #fff; margin-bottom: 4px;">${cloud.name}</div>
                                <span class="cloud-status ${cloud.connected ? 'connected' : 'disconnected'}">
                                    ${cloud.connected ? ' Connected' : ' Disconnected'}
                                </span>
                            </div>
                        </div>
                        <button onclick="disconnectCloud('${cloud.id}')" style="padding: 6px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.4); border-radius: 6px; color: #ef4444; font-size: 12px; cursor: pointer;">Disconnect</button>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">
                        <span>Storage: ${cloud.used.toFixed(1)} TB / ${cloud.total} TB</span>
                        <span>${percentage.toFixed(1)}% used</span>
                    </div>
                    <div class="storage-bar">
                        <div class="storage-fill" style="width: ${percentage}%; background: ${cloud.color};"></div>
                    </div>
                    <div style="margin-top: 10px; font-size: 11px; color: rgba(255, 255, 255, 0.5);">
                        ${cloud.files} files  ${(cloud.total - cloud.used).toFixed(1)} TB available
                    </div>
                `;
                container.appendChild(card);
            });
            
            // Update cloud select in browser
            const select = document.getElementById('browser-cloud-select');
            select.innerHTML = '<option value="all">All Clouds</option>';
            cloudProviders.forEach(cloud => {
                const option = document.createElement('option');
                option.value = cloud.id;
                option.textContent = cloud.name;
                select.appendChild(option);
            });
        }

        function renderFileBrowser() {
            const container = document.getElementById('files-list');
            container.innerHTML = '';
            
            const mockFiles = [
                { name: 'Project Report.pdf', size: '2.3 MB', type: 'pdf', cloud: 'gdrive', date: '2024-11-05' },
                { name: 'Vacation Photos', size: '145 MB', type: 'folder', cloud: 'dropbox', date: '2024-11-03' },
                { name: 'Database Backup.sql', size: '1.2 GB', type: 'sql', cloud: 'aws', date: '2024-11-08' },
                { name: 'Presentation.pptx', size: '8.5 MB', type: 'pptx', cloud: 'onedrive', date: '2024-11-07' },
                { name: 'Music Collection', size: '2.1 GB', type: 'folder', cloud: 'icloud', date: '2024-11-06' },
                { name: 'Design Assets.psd', size: '45 MB', type: 'psd', cloud: 'gdrive', date: '2024-11-04' },
                { name: 'Video Project.mp4', size: '3.2 GB', type: 'mp4', cloud: 'aws', date: '2024-11-02' },
                { name: 'Documents Archive.zip', size: '125 MB', type: 'zip', cloud: 'dropbox', date: '2024-11-01' }
            ];
            
            mockFiles.forEach(file => {
                const cloud = cloudProviders.find(c => c.id === file.cloud);
                const fileCard = document.createElement('div');
                fileCard.style.cssText = 'background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s;';
                fileCard.onmouseenter = () => {
                    fileCard.style.background = 'rgba(255, 255, 255, 0.08)';
                    fileCard.style.transform = 'translateY(-2px)';
                };
                fileCard.onmouseleave = () => {
                    fileCard.style.background = 'rgba(255, 255, 255, 0.05)';
                    fileCard.style.transform = 'translateY(0)';
                };
                fileCard.innerHTML = `
                    <div style="font-size: 32px; margin-bottom: 8px;">${file.type === 'folder' ? '' : ''}</div>
                    <div style="font-size: 13px; font-weight: 600; color: #fff; margin-bottom: 4px; word-break: break-word;">${file.name}</div>
                    <div style="font-size: 11px; color: rgba(255, 255, 255, 0.5); margin-bottom: 4px;">${file.size}</div>
                    <div style="font-size: 10px; color: ${cloud ? cloud.color : '#fff'};">${cloud ? cloud.name : 'Unknown'}</div>
                `;
                container.appendChild(fileCard);
            });
        }

        function renderAnalytics() {
            updateStats();
            createStorageDistributionChart();
            createFileTypesChart();
            createUsageTimelineChart();
            createPerformanceChart();
        }

        function updateStats() {
            const total = cloudProviders.reduce((sum, c) => sum + c.total, 0);
            const used = cloudProviders.reduce((sum, c) => sum + c.used, 0);
            const available = total - used;
            
            document.getElementById('stat-total').textContent = total.toFixed(1) + ' TB';
            document.getElementById('stat-used').textContent = used.toFixed(1) + ' TB';
            document.getElementById('stat-available').textContent = available.toFixed(1) + ' TB';
            document.getElementById('stat-clouds').textContent = cloudProviders.filter(c => c.connected).length;
        }

        function createStorageDistributionChart() {
            const ctx = document.getElementById('chart-storage-distribution');
            if (oneDataCharts.storageDistribution) {
                oneDataCharts.storageDistribution.destroy();
            }
            
            oneDataCharts.storageDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: cloudProviders.map(c => c.name),
                    datasets: [{
                        data: cloudProviders.map(c => c.used),
                        backgroundColor: cloudProviders.map(c => c.color),
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        function createFileTypesChart() {
            const ctx = document.getElementById('chart-file-types');
            if (oneDataCharts.fileTypes) {
                oneDataCharts.fileTypes.destroy();
            }
            
            oneDataCharts.fileTypes = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: fileTypes.map(f => f.type),
                    datasets: [{
                        data: fileTypes.map(f => f.size),
                        backgroundColor: ['#6366f1', '#8b5cf6', '#ec4899', '#f59e0b', '#10b981', '#6b7280'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        function createUsageTimelineChart() {
            const ctx = document.getElementById('chart-usage-timeline');
            if (oneDataCharts.usageTimeline) {
                oneDataCharts.usageTimeline.destroy();
            }
            
            const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov'];
            const data = [35, 38, 42, 45, 48, 50, 52, 55, 58, 60, 62];
            
            oneDataCharts.usageTimeline = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Storage Used (TB)',
                        data: data,
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                font: { size: 11 }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.5)',
                                font: { size: 10 }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.5)',
                                font: { size: 10 }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            }
                        }
                    }
                }
            });
        }

        function createPerformanceChart() {
            const ctx = document.getElementById('chart-performance');
            if (oneDataCharts.performance) {
                oneDataCharts.performance.destroy();
            }
            
            oneDataCharts.performance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: cloudProviders.map(c => c.name),
                    datasets: [{
                        label: 'Performance Score',
                        data: [95, 88, 92, 85, 90],
                        backgroundColor: cloudProviders.map(c => c.color),
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.5)',
                                font: { size: 10 }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.5)',
                                font: { size: 10 }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            }
                        }
                    }
                }
            });
        }

        function addCloudProvider() {
            alert('Cloud provider connection dialog would open here. This is a demo interface.');
        }

        function disconnectCloud(cloudId) {
            const cloud = cloudProviders.find(c => c.id === cloudId);
            if (cloud && confirm(`Disconnect ${cloud.name}?`)) {
                cloud.connected = false;
                renderCloudCards();
                updateStats();
            }
        }

        function runOptimization() {
            alert('Running optimization... This would clean up duplicate files, optimize storage, and improve performance.');
        }

        // Todo App Functions
        let todos = JSON.parse(localStorage.getItem('todos') || '[]');
        let currentFilter = 'all';
        
        // Initialize with default todos if empty
        if (todos.length === 0) {
            todos = [
                { id: 1, text: 'Review project proposal', completed: false, createdAt: new Date().toISOString(), priority: 'high', category: 'work' },
                { id: 2, text: 'Team meeting at 3 PM', completed: false, createdAt: new Date().toISOString(), priority: 'medium', category: 'work' },
                { id: 3, text: 'Buy groceries', completed: true, createdAt: new Date().toISOString(), priority: 'low', category: 'personal' },
                { id: 4, text: 'Finish presentation slides', completed: false, createdAt: new Date().toISOString(), priority: 'high', category: 'work' },
                { id: 5, text: 'Call dentist for appointment', completed: false, createdAt: new Date().toISOString(), priority: 'medium', category: 'personal' }
            ];
            saveTodos();
        }

        function addTodo() {
            const input = document.getElementById('todo-input');
            const text = input.value.trim();
            if (!text) return;
            
            const todo = {
                id: Date.now(),
                text: text,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            todos.push(todo);
            saveTodos();
            input.value = '';
            renderTodos();
        }

        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                saveTodos();
                renderTodos();
            }
        }

        function deleteTodo(id) {
            todos = todos.filter(t => t.id !== id);
            saveTodos();
            renderTodos();
        }

        function filterTodos(filter) {
            currentFilter = filter;
            document.querySelectorAll('.todo-filter').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-${filter}`).classList.add('active');
            renderTodos();
        }

        function clearCompleted() {
            todos = todos.filter(t => !t.completed);
            saveTodos();
            renderTodos();
        }

        function renderTodos() {
            const container = document.getElementById('todo-list');
            const count = document.getElementById('todo-count');
            
            let filtered = todos;
            if (currentFilter === 'active') {
                filtered = todos.filter(t => !t.completed);
            } else if (currentFilter === 'completed') {
                filtered = todos.filter(t => t.completed);
            }
            
            container.innerHTML = '';
            filtered.forEach(todo => {
                const item = document.createElement('div');
                item.className = `todo-item ${todo.completed ? 'completed' : ''}`;
                item.innerHTML = `
                    <div class="todo-checkbox ${todo.completed ? 'checked' : ''}" onclick="toggleTodo(${todo.id})"></div>
                    <div class="todo-text" style="flex: 1; color: rgba(255, 255, 255, 0.9); font-size: 14px;">${escapeHtml(todo.text)}</div>
                    <button onclick="deleteTodo(${todo.id})" style="padding: 6px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; color: #ef4444; font-size: 12px; cursor: pointer;">Delete</button>
                `;
                container.appendChild(item);
            });
            
            count.textContent = `${todos.length} task${todos.length !== 1 ? 's' : ''}`;
        }

        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
        }

        async function askAITodo() {
            const input = document.getElementById('todo-input');
            const prompt = input.value.trim() || 'Suggest some tasks for today';
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Based on this: "${prompt}", suggest 3-5 specific tasks I should add to my todo list. Format as a simple list, one task per line.`
                    })
                });
                
                const data = await response.json();
                const suggestions = data.response.split('\n').filter(line => line.trim() && !line.match(/^\d+\./));
                if (suggestions.length > 0) {
                    const task = suggestions[0].replace(/^[-*]\s*/, '').trim();
                    input.value = task;
                    input.focus();
                }
            } catch (error) {
                console.error('AI Todo error:', error);
                alert('AI suggestions temporarily unavailable. Please try again.');
            }
        }
        
        async function askAIToPrioritizeTodos() {
            if (todos.length === 0) {
                alert('No tasks to prioritize');
                return;
            }
            
            try {
                const taskList = todos.map(t => `- ${t.text} (${t.completed ? 'completed' : 'pending'})`).join('\n');
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Here are my current tasks:\n${taskList}\n\nSuggest which tasks I should prioritize and in what order. Also suggest any tasks I might be missing.`
                    })
                });
                
                const data = await response.json();
                alert(`AI Prioritization Suggestions:\n\n${data.response}`);
            } catch (error) {
                console.error('AI Prioritize error:', error);
                alert('AI prioritization temporarily unavailable.');
            }
        }
        
        async function askAIToAnalyzeTodos() {
            if (todos.length === 0) {
                alert('No tasks to analyze');
                return;
            }
            
            const completed = todos.filter(t => t.completed).length;
            const pending = todos.filter(t => !t.completed).length;
            const completionRate = todos.length > 0 ? (completed / todos.length * 100).toFixed(1) : 0;
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `I have ${todos.length} tasks total: ${completed} completed, ${pending} pending. My completion rate is ${completionRate}%. Give me insights and suggestions to improve my productivity.`
                    })
                });
                
                const data = await response.json();
                alert(`AI Productivity Analysis:\n\n${data.response}`);
            } catch (error) {
                console.error('AI Analyze error:', error);
                alert('AI analysis temporarily unavailable.');
            }
        }

        // Sticky Notes Functions - Desktop Widgets
        let stickyNotes = JSON.parse(localStorage.getItem('stickyNotes') || '[]');
        
        // Initialize with default sticky notes if empty
        if (stickyNotes.length === 0) {
            stickyNotes = [
                { id: 1, text: 'Remember to submit the report by Friday', color: '#fef3c7', position: { x: 100, y: 100 } },
                { id: 2, text: 'Meeting with client at 2 PM', color: '#fde68a', position: { x: 300, y: 150 } }
            ];
            saveStickyNotes();
        }

        function createStickyNote() {
            const note = {
                id: Date.now(),
                text: '',
                color: '#fef3c7',
                position: { x: Math.random() * 300 + 100, y: Math.random() * 300 + 100 },
                width: 250,
                height: 200
            };
            stickyNotes.push(note);
            saveStickyNotes();
            renderStickyNotes();
            closeApp('stickynotes');
        }

        function deleteStickyNote(id) {
            stickyNotes = stickyNotes.filter(n => n.id !== id);
            saveStickyNotes();
            renderStickyNotes();
        }

        function updateStickyNote(id, text) {
            const note = stickyNotes.find(n => n.id === id);
            if (note) {
                note.text = text;
                saveStickyNotes();
            }
        }

        function renderStickyNotes() {
            // Remove existing sticky notes from desktop
            document.querySelectorAll('.desktop-sticky-note').forEach(el => el.remove());
            
            // Render sticky notes on desktop
            stickyNotes.forEach(note => {
                const noteEl = document.createElement('div');
                noteEl.className = 'sticky-note desktop-sticky-note';
                noteEl.id = `sticky-note-${note.id}`;
                noteEl.style.left = note.position.x + 'px';
                noteEl.style.top = note.position.y + 'px';
                noteEl.style.width = (note.width || 250) + 'px';
                noteEl.style.minHeight = (note.height || 200) + 'px';
                noteEl.style.background = note.color || '#fef3c7';
                
                noteEl.innerHTML = `
                    <div class="note-actions" style="position: absolute; top: 8px; right: 8px; display: flex; gap: 5px; z-index: 10;">
                        <button class="note-action-btn" onclick="askAIEnhanceStickyNote(${note.id})" title="AI Enhance"></button>
                        <button class="note-action-btn" onclick="deleteStickyNote(${note.id})" title="Delete"></button>
                    </div>
                    <textarea onblur="updateStickyNote(${note.id}, this.value)" oninput="updateStickyNote(${note.id}, this.value)" placeholder="Write your note here..." style="width: 100%; min-height: 150px; background: transparent; border: none; color: #1f2937; font-size: 14px; resize: none; font-family: inherit; padding-top: 30px;">${escapeHtml(note.text)}</textarea>
                `;
                
                // Make draggable
                makeStickyNoteDraggable(noteEl, note.id);
                
                // Add to desktop
                document.body.appendChild(noteEl);
            });
        }
        
        function makeStickyNoteDraggable(element, noteId) {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            
            element.addEventListener('mousedown', (e) => {
                if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON') return;
                
                isDragging = true;
                element.classList.add('dragging');
                initialX = e.clientX - element.offsetLeft;
                initialY = e.clientY - element.offsetTop;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                
                element.style.left = currentX + 'px';
                element.style.top = currentY + 'px';
            });
            
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    element.classList.remove('dragging');
                    
                    // Save position
                    const note = stickyNotes.find(n => n.id === noteId);
                    if (note) {
                        note.position.x = parseInt(element.style.left);
                        note.position.y = parseInt(element.style.top);
                        note.width = parseInt(element.style.width);
                        note.height = parseInt(element.style.minHeight);
                        saveStickyNotes();
                    }
                }
            });
        }

        function saveStickyNotes() {
            localStorage.setItem('stickyNotes', JSON.stringify(stickyNotes));
        }

        async function askAIStickyNote() {
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: 'Suggest a helpful sticky note idea or reminder I should write down. Keep it concise (1-2 sentences).'
                    })
                });
                
                const data = await response.json();
                const note = {
                    id: Date.now(),
                    text: data.response.substring(0, 200),
                    color: '#fef3c7',
                    position: { x: Math.random() * 300 + 100, y: Math.random() * 300 + 100 },
                    width: 250,
                    height: 200
                };
                stickyNotes.push(note);
                saveStickyNotes();
                renderStickyNotes();
                closeApp('stickynotes');
            } catch (error) {
                console.error('AI Sticky Note error:', error);
                alert('AI suggestions temporarily unavailable.');
            }
        }
        
        async function askAIEnhanceStickyNote(noteId) {
            const note = stickyNotes.find(n => n.id === noteId);
            if (!note) return;
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Enhance and improve this sticky note: "${note.text}". Make it more helpful and actionable.`
                    })
                });
                
                const data = await response.json();
                note.text = data.response.substring(0, 300);
                saveStickyNotes();
                renderStickyNotes();
            } catch (error) {
                console.error('AI Enhance Sticky Note error:', error);
                alert('AI enhancement temporarily unavailable.');
            }
        }

        // Reminders Functions
        let reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
        
        // Initialize with default reminders if empty
        if (reminders.length === 0) {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const nextWeek = new Date(now);
            nextWeek.setDate(nextWeek.getDate() + 7);
            
            reminders = [
                { id: 1, title: 'Team Standup Meeting', date: tomorrow.toISOString().slice(0, 16), completed: false, createdAt: new Date().toISOString(), priority: 'high' },
                { id: 2, title: 'Project Deadline', date: nextWeek.toISOString().slice(0, 16), completed: false, createdAt: new Date().toISOString(), priority: 'high' },
                { id: 3, title: 'Doctor Appointment', date: tomorrow.toISOString().slice(0, 16), completed: false, createdAt: new Date().toISOString(), priority: 'medium' }
            ];
            saveReminders();
        }

        function addReminder() {
            const title = document.getElementById('reminder-title').value.trim();
            const date = document.getElementById('reminder-date').value;
            
            if (!title || !date) {
                alert('Please enter both title and date');
                return;
            }
            
            const reminder = {
                id: Date.now(),
                title: title,
                date: date,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            reminders.push(reminder);
            saveReminders();
            document.getElementById('reminder-title').value = '';
            document.getElementById('reminder-date').value = '';
            renderReminders();
        }

        function deleteReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            saveReminders();
            renderReminders();
        }

        function filterReminders(filter) {
            currentReminderFilter = filter;
            document.querySelectorAll('#reminder-filter-all, #reminder-filter-upcoming, #reminder-filter-past').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`reminder-filter-${filter}`).classList.add('active');
            renderReminders();
        }

        let currentReminderFilter = 'all';

        function renderReminders() {
            const container = document.getElementById('reminders-list');
            container.innerHTML = '';
            
            let filtered = reminders;
            const now = new Date();
            
            if (currentReminderFilter === 'upcoming') {
                filtered = reminders.filter(r => new Date(r.date) > now);
            } else if (currentReminderFilter === 'past') {
                filtered = reminders.filter(r => new Date(r.date) <= now);
            }
            
            filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            filtered.forEach(reminder => {
                const date = new Date(reminder.date);
                const isPast = date <= now;
                const item = document.createElement('div');
                item.className = `reminder-item ${isPast ? 'past' : 'upcoming'}`;
                item.innerHTML = `
                    <div style="flex: 1;">
                        <div style="font-size: 14px; font-weight: 600; color: #fff; margin-bottom: 4px;">${escapeHtml(reminder.title)}</div>
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6);">${date.toLocaleString()}</div>
                    </div>
                    <button onclick="deleteReminder(${reminder.id})" style="padding: 6px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; color: #ef4444; font-size: 12px; cursor: pointer;">Delete</button>
                `;
                container.appendChild(item);
            });
        }

        function saveReminders() {
            localStorage.setItem('reminders', JSON.stringify(reminders));
        }

        async function askAIReminder() {
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: 'Suggest a helpful reminder I should set. Include what it should remind me about and when.'
                    })
                });
                
                const data = await response.json();
                document.getElementById('reminder-title').value = data.response.substring(0, 100);
                document.getElementById('reminder-title').focus();
            } catch (error) {
                console.error('AI Reminder error:', error);
                alert('AI suggestions temporarily unavailable.');
            }
        }
        
        async function askAIToSmartScheduleReminders() {
            if (reminders.length === 0) {
                alert('No reminders to schedule');
                return;
            }
            
            try {
                const reminderList = reminders.map(r => `- ${r.title} (${new Date(r.date).toLocaleString()})`).join('\n');
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Here are my current reminders:\n${reminderList}\n\nAnalyze my schedule and suggest if I need to adjust any reminders or add new ones.`
                    })
                });
                
                const data = await response.json();
                alert(`AI Schedule Analysis:\n\n${data.response}`);
            } catch (error) {
                console.error('AI Schedule error:', error);
                alert('AI scheduling temporarily unavailable.');
            }
        }

        // Notes App Functions
        let notes = JSON.parse(localStorage.getItem('notes') || '[]');
        let currentNoteId = null;
        
        // Initialize with default notes if empty
        if (notes.length === 0) {
            notes = [
                { id: 1, title: 'Project Ideas', content: 'Brainstorm new features for the project\n- AI integration\n- Better UI/UX\n- Performance optimization', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
                { id: 2, title: 'Meeting Notes', content: 'Team meeting discussion points:\n1. Q4 goals\n2. Resource allocation\n3. Timeline adjustments', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() }
            ];
            saveNotes();
        }

        function createNote() {
            const note = {
                id: Date.now(),
                title: 'Untitled Note',
                content: '',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            notes.push(note);
            saveNotes();
            selectNote(note.id);
            renderNotesList();
        }

        function selectNote(id) {
            currentNoteId = id;
            const note = notes.find(n => n.id === id);
            if (note) {
                document.getElementById('note-title').value = note.title;
                document.getElementById('note-content').value = note.content;
            }
            renderNotesList();
        }

        function saveCurrentNote() {
            if (!currentNoteId) return;
            const note = notes.find(n => n.id === currentNoteId);
            if (note) {
                note.title = document.getElementById('note-title').value || 'Untitled Note';
                note.content = document.getElementById('note-content').value;
                note.updatedAt = new Date().toISOString();
                saveNotes();
                renderNotesList();
            }
        }

        function deleteCurrentNote() {
            if (!currentNoteId) return;
            if (confirm('Delete this note?')) {
                notes = notes.filter(n => n.id !== currentNoteId);
                saveNotes();
                currentNoteId = null;
                document.getElementById('note-title').value = '';
                document.getElementById('note-content').value = '';
                renderNotesList();
            }
        }

        function renderNotesList() {
            const container = document.getElementById('notes-list');
            container.innerHTML = '';
            
            notes.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            
            notes.forEach(note => {
                const item = document.createElement('div');
                item.className = `note-item ${note.id === currentNoteId ? 'active' : ''}`;
                item.onclick = () => selectNote(note.id);
                item.innerHTML = `
                    <div style="font-size: 14px; font-weight: 600; color: #fff; margin-bottom: 4px;">${escapeHtml(note.title)}</div>
                    <div style="font-size: 11px; color: rgba(255, 255, 255, 0.5);">${new Date(note.updatedAt).toLocaleDateString()}</div>
                `;
                container.appendChild(item);
            });
        }

        function saveNotes() {
            localStorage.setItem('notes', JSON.stringify(notes));
        }

        async function askAINote() {
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: 'Suggest a helpful note topic or idea I should write about.'
                    })
                });
                
                const data = await response.json();
                createNote();
                document.getElementById('note-title').value = data.response.substring(0, 50);
                document.getElementById('note-content').value = data.response;
                saveCurrentNote();
            } catch (error) {
                console.error('AI Note error:', error);
                alert('AI suggestions temporarily unavailable.');
            }
        }

        async function askAIToEnhanceNote() {
            if (!currentNoteId) {
                alert('Please select a note first');
                return;
            }
            
            const note = notes.find(n => n.id === currentNoteId);
            if (!note) return;
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Enhance and improve this note: "${note.title}"\n\n${note.content}\n\nMake it more detailed and helpful.`
                    })
                });
                
                const data = await response.json();
                document.getElementById('note-content').value = data.response;
                saveCurrentNote();
            } catch (error) {
                console.error('AI Enhance error:', error);
                alert('AI enhancement temporarily unavailable.');
            }
        }
        
        async function askAIToSummarizeNote() {
            if (!currentNoteId) {
                alert('Please select a note first');
                return;
            }
            
            const note = notes.find(n => n.id === currentNoteId);
            if (!note || !note.content) return;
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Summarize this note in 2-3 sentences:\n\n"${note.title}"\n\n${note.content}`
                    })
                });
                
                const data = await response.json();
                alert(`Note Summary:\n\n${data.response}`);
            } catch (error) {
                console.error('AI Summarize error:', error);
                alert('AI summarization temporarily unavailable.');
            }
        }
        
        async function askAIToFormatNote() {
            if (!currentNoteId) {
                alert('Please select a note first');
                return;
            }
            
            const note = notes.find(n => n.id === currentNoteId);
            if (!note) return;
            
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Format and organize this note better with proper structure, headings, and bullet points:\n\n"${note.title}"\n\n${note.content}`
                    })
                });
                
                const data = await response.json();
                document.getElementById('note-content').value = data.response;
                saveCurrentNote();
            } catch (error) {
                console.error('AI Format error:', error);
                alert('AI formatting temporarily unavailable.');
            }
        }

        // Weather Functions
        function getWeather() {
            const location = document.getElementById('weather-location').value || 'Amherst, MA';
            // Mock weather data - in real app, would fetch from weather API
            const weatherData = {
                temp: 72,
                feelsLike: 75,
                condition: 'Partly Cloudy',
                humidity: 65,
                wind: 8,
                icon: ''
            };
            
            document.getElementById('weather-content').innerHTML = `
                <div style="font-size: 64px; margin-bottom: 20px;">${weatherData.icon}</div>
                <div style="font-size: 48px; font-weight: 700; color: #fff; margin-bottom: 10px;">${weatherData.temp}F</div>
                <div style="font-size: 24px; color: rgba(255, 255, 255, 0.7); margin-bottom: 20px;">${weatherData.condition}</div>
                <div style="font-size: 16px; color: rgba(255, 255, 255, 0.6); margin-bottom: 30px;">${location}</div>
                <div style="width: 100%; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px;">
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">Feels Like</div>
                        <div style="font-size: 20px; font-weight: 600; color: #fff;">${weatherData.feelsLike}F</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">Humidity</div>
                        <div style="font-size: 20px; font-weight: 600; color: #fff;">${weatherData.humidity}%</div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 15px; text-align: center;">
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-bottom: 5px;">Wind</div>
                        <div style="font-size: 20px; font-weight: 600; color: #fff;">${weatherData.wind} mph</div>
                    </div>
                </div>
            `;
        }

        async function askAIWeather() {
            const location = document.getElementById('weather-location').value || 'Amherst, MA';
            try {
                const response = await fetch('http://localhost:5001/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Give me weather insights and recommendations for ${location}. What should I wear? Any weather-related activities I should do?`
                    })
                });
                
                const data = await response.json();
                alert(`AI Weather Insights:\n\n${data.response}`);
            } catch (error) {
                console.error('AI Weather error:', error);
                alert('AI weather insights temporarily unavailable.');
            }
        }

        // Clock Functions
        let alarms = JSON.parse(localStorage.getItem('alarms') || '[]');
        let clockInterval = null;
        
        // Initialize with default alarms if empty
        if (alarms.length === 0) {
            const now = new Date();
            const morning = new Date(now);
            morning.setHours(7, 0, 0, 0);
            const afternoon = new Date(now);
            afternoon.setHours(14, 30, 0, 0);
            
            alarms = [
                { id: 1, time: '07:00', label: 'Morning Wake Up', enabled: true },
                { id: 2, time: '14:30', label: 'Afternoon Meeting', enabled: true }
            ];
            saveAlarms();
        }

        function updateClock() {
            const timeEl = document.getElementById('clock-time');
            const dateEl = document.getElementById('clock-date');
            if (!timeEl || !dateEl) return;
            
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour12: false });
            const date = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            timeEl.textContent = time;
            dateEl.textContent = date;
            
            // World times
            const nyEl = document.getElementById('time-ny');
            const londonEl = document.getElementById('time-london');
            const tokyoEl = document.getElementById('time-tokyo');
            
            if (nyEl && londonEl && tokyoEl) {
                const ny = now.toLocaleTimeString('en-US', { timeZone: 'America/New_York', hour: '2-digit', minute: '2-digit', hour12: true });
                const london = now.toLocaleTimeString('en-US', { timeZone: 'Europe/London', hour: '2-digit', minute: '2-digit', hour12: true });
                const tokyo = now.toLocaleTimeString('en-US', { timeZone: 'Asia/Tokyo', hour: '2-digit', minute: '2-digit', hour12: true });
                
                nyEl.textContent = ny;
                londonEl.textContent = london;
                tokyoEl.textContent = tokyo;
            }
            
            // Check alarms
            checkAlarms();
        }

        function addAlarm() {
            const time = document.getElementById('alarm-time').value;
            const label = document.getElementById('alarm-label').value.trim() || 'Alarm';
            
            if (!time) {
                alert('Please select a time');
                return;
            }
            
            const alarm = {
                id: Date.now(),
                time: time,
                label: label,
                enabled: true
            };
            
            alarms.push(alarm);
            saveAlarms();
            document.getElementById('alarm-time').value = '';
            document.getElementById('alarm-label').value = '';
            renderAlarms();
        }

        function deleteAlarm(id) {
            alarms = alarms.filter(a => a.id !== id);
            saveAlarms();
            renderAlarms();
        }

        function toggleAlarm(id) {
            const alarm = alarms.find(a => a.id === id);
            if (alarm) {
                alarm.enabled = !alarm.enabled;
                saveAlarms();
                renderAlarms();
            }
        }

        function checkAlarms() {
            const now = new Date();
            const currentTime = now.toTimeString().substring(0, 5);
            
            alarms.forEach(alarm => {
                if (alarm.enabled && alarm.time === currentTime) {
                    alert(` Alarm: ${alarm.label}`);
                    alarm.enabled = false;
                    saveAlarms();
                    renderAlarms();
                }
            });
        }

        function renderAlarms() {
            const container = document.getElementById('alarms-list');
            container.innerHTML = '';
            
            alarms.forEach(alarm => {
                const item = document.createElement('div');
                item.className = 'alarm-item';
                item.innerHTML = `
                    <div>
                        <div style="font-size: 14px; font-weight: 600; color: #fff; margin-bottom: 4px;">${escapeHtml(alarm.label)}</div>
                        <div style="font-size: 12px; color: rgba(255, 255, 255, 0.6);">${alarm.time}</div>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button onclick="toggleAlarm(${alarm.id})" style="padding: 6px 12px; background: ${alarm.enabled ? 'rgba(16, 185, 129, 0.2)' : 'rgba(255, 255, 255, 0.1)'}; border: 1px solid ${alarm.enabled ? 'rgba(16, 185, 129, 0.4)' : 'rgba(255, 255, 255, 0.2)'}; border-radius: 6px; color: ${alarm.enabled ? '#10b981' : 'rgba(255, 255, 255, 0.5)'}; font-size: 12px; cursor: pointer;">${alarm.enabled ? 'ON' : 'OFF'}</button>
                        <button onclick="deleteAlarm(${alarm.id})" style="padding: 6px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; color: #ef4444; font-size: 12px; cursor: pointer;">Delete</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function saveAlarms() {
            localStorage.setItem('alarms', JSON.stringify(alarms));
        }

        // Initialize clock on page load
        if (!clockInterval) {
            clockInterval = setInterval(updateClock, 1000);
        }
        updateClock();
        
        // Initialize sticky notes on desktop when page loads
        setTimeout(() => {
            renderStickyNotes();
        }, 500);
    </script>
    <script src="oneMemory.js"></script>
</body>
</html>
